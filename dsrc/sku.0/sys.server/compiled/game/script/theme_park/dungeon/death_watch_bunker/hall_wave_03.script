/***** INCLUDES ***********************************/

include library.ai_lib;
include library.chat;
include library.create;


/***** CONSTANTS **********************************/

const string TBL_STORAGE_WAVE							= "datatables/dungeon/death_watch/storage_wave.iff";

const string_id CALL_BACK_UP				= new string_id("dungeon/death_watch", "call_back_up");

/***** TRIGGERS ***************************************/
trigger OnAttach()
{
	messageTo (self, "handleAttackerCleanUp", null, 300f, false);
	messageTo (self, "handleInvestigate", null, 5f, false);
	return SCRIPT_CONTINUE;
}

messageHandler handleAttackerCleanUp()
{
	if ( ai_lib.isInCombat(self) )
	{
		messageTo(self, "handleAttackerCleanUp", null, 300f, false);
		return SCRIPT_CONTINUE;
	}

	destroyObject(self);
	return SCRIPT_CONTINUE;
}

messageHandler handleInvestigate()
{
	obj_id structure = getTopMostContainer (self);
	obj_id top = getTopMostContainer (self );
	obj_id room = getCellId (top, "largeroom");
	location here = getLocation (self);
	string planet = here.area;
	location attack = new location (-92.5f, 0, -45.5f, planet, room);
	ai_lib.aiPathTo (self, attack);
	addLocationTarget ("checkPoint", attack, 1);
	return SCRIPT_CONTINUE;
}


