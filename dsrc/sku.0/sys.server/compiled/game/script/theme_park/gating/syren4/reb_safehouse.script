include library.groundquests;
include library.group;

trigger OnAboutToReceiveItem (obj_id destinationCell, obj_id transferrer, obj_id item)
{
	if ( !isPlayer(item) || isIdValid(destinationCell))
	{
		return SCRIPT_CONTINUE;
	}			
	string_id warning = new string_id ("theme_park/messages","access_denied");	

	if ( group.isGrouped(item) )
	{
		obj_id groupObj = getGroupObject(item);
		if ( isIdValid(groupObj) )
		{
			obj_id[] groupMembers = getGroupMemberIds(groupObj);
			int numGroupMembers = groupMembers.length;
			for (int f = 0; f < numGroupMembers; f++)
			{
				obj_id groupie = groupMembers[f];
				if ( isIdValid(groupie) )
				{
					if ( groundquests.isQuestActive(item, "c_story1_4b_rebel")&&!groundquests.hasCompletedTask(groupie, "c_story1_4b_rebel", "reb_choice") )
					{
						return SCRIPT_CONTINUE;
					}
				}
			}
			sendSystemMessage (item, warning);
			return SCRIPT_OVERRIDE;
		}
		
	}		
	else if ( groundquests.isQuestActive(item, "c_story1_4b_rebel")&&!groundquests.hasCompletedTask(item, "c_story1_4b_rebel", "reb_choice") )
	{
		return SCRIPT_CONTINUE;
	}	
	else
	{
		sendSystemMessage (item, warning);
		return SCRIPT_OVERRIDE;
	}
	return SCRIPT_CONTINUE;
}