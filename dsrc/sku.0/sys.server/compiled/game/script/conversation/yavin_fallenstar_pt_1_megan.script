// ======================================================================
//
// yavin_fallenstar_pt_1_megan.script
// Copyright 2004, Sony Online Entertainment
// All Rights Reserved.
//
// Created with SwgConversationEditor 1.35 - DO NOT EDIT THIS AUTO-GENERATED FILE!
//
// ======================================================================

// ======================================================================
// Library Includes
// ======================================================================

include library.ai_lib;
include library.chat;
include library.features;
include library.groundquests;
include library.utils;

// ======================================================================
// Script Constants
// ======================================================================

string c_stringFile = "conversation/yavin_fallenstar_pt_1_megan";

// ======================================================================
// Script Conditions
// ======================================================================

boolean yavin_fallenstar_pt_1_megan_condition__defaultCondition (obj_id player, obj_id npc)
{
	return true;
}

// ----------------------------------------------------------------------

boolean yavin_fallenstar_pt_1_megan_condition_onquestWarn (obj_id player, obj_id npc)
{
	int questId = questGetQuestId("quest/yavin_fallenstar_pt1");
	int yavin_fallenstar_e3_warn_megan = groundquests.getTaskId(questId, "yavin_fallenstar_e3_warn_megan"); 
	
	boolean onTask = (questIsTaskActive(questId, yavin_fallenstar_e3_warn_megan, player));
	
	return onTask;
}

// ----------------------------------------------------------------------

boolean yavin_fallenstar_pt_1_megan_condition_defeatYak (obj_id player, obj_id npc)
{	
	int questId1 = questGetQuestId("quest/yavin_fallenstar_pt1");
	int yavin_fallenstar_e5_threaten_megan = groundquests.getTaskId(questId1, "yavin_fallenstar_e5_threaten_megan"); 
	
	boolean onTask = questIsTaskActive(questId1, yavin_fallenstar_e5_threaten_megan, player);
	
	return onTask;

}

// ----------------------------------------------------------------------

boolean yavin_fallenstar_pt_1_megan_condition_escortcomplete (obj_id player, obj_id npc)
{	
	int questId1 = questGetQuestId("quest/yavin_meganjobs_lostworker");
	int finishEscort = groundquests.getTaskId(questId1, "yavin_meganjobs_e6_worker_megan"); 
	
	boolean onTask = questIsTaskActive(questId1, finishEscort, player);
	
	return onTask;

}

// ----------------------------------------------------------------------

boolean yavin_fallenstar_pt_1_megan_condition_lostWorker_Complete (obj_id player, obj_id npc)
{
	int questId1 = questGetQuestId("quest/yavin_meganjobs_lostworker");
	
	boolean OnTask = 	(questIsQuestComplete(questId1, player));
	
	return OnTask;

}

// ----------------------------------------------------------------------

boolean yavin_fallenstar_pt_1_megan_condition_hyperdriveRecovered (obj_id player, obj_id npc)
{	
	int questId1 = questGetQuestId("quest/yavin_meganjobs_hyperdrive");
	int recovered = groundquests.getTaskId(questId1, "yavin_meganjobs_e13_hyperdrive_megan"); 
	
	boolean onTask = questIsTaskActive(questId1, recovered, player);
	
	return onTask;

}

// ----------------------------------------------------------------------

boolean yavin_fallenstar_pt_1_megan_condition_hyperdrive_Complete (obj_id player, obj_id npc)
{
	int questId1 = questGetQuestId("quest/yavin_meganjobs_hyperdrive");
	
	boolean OnTask = 	(questIsQuestComplete(questId1, player));
	
	return OnTask;

}

// ----------------------------------------------------------------------

boolean yavin_fallenstar_pt_1_megan_condition_MeganJobs_Complete (obj_id player, obj_id npc)
{
	int questId1 = questGetQuestId("quest/yavin_meganjobs_lostworker");
	int questId2 = questGetQuestId("quest/yavin_meganjobs_hyperdrive");
	int questId3 = questGetQuestId("quest/yavin_meganjobs_killrival");
	int questId4 = questGetQuestId("quest/yavin_fallenstar_pt1");
	
	boolean OnTask= 	(questIsQuestComplete(questId1, player))&&
						(questIsQuestComplete(questId2, player))&&
						(questIsQuestComplete(questId3, player))&&
						(!(questIsQuestActive(questId4, player)));
						
	return OnTask;					
						
	
}

// ----------------------------------------------------------------------

boolean yavin_fallenstar_pt_1_megan_condition_rivalsKilled (obj_id player, obj_id npc)
{
	int questId1 = questGetQuestId("quest/yavin_meganjobs_killrival");
	int rivalskilled = groundquests.getTaskId(questId1, "yavin_meganjobs_e20_scavangers_megan"); 
	
	boolean onTask = questIsTaskActive(questId1, rivalskilled, player);
	
	return onTask;

}

// ----------------------------------------------------------------------

boolean yavin_fallenstar_pt_1_megan_condition_MeganJobs_Onquests_rivals (obj_id player, obj_id npc)
{

	int questId1 = questGetQuestId("quest/yavin_meganjobs_killrival");
	
	boolean OnTask= 	(questIsQuestActive(questId1, player));
						
	return OnTask;					
						
	
}

// ----------------------------------------------------------------------

boolean yavin_fallenstar_pt_1_megan_condition_MeganJobs_Onquests_hyperdrive (obj_id player, obj_id npc)
{

	int questId1 = questGetQuestId("quest/yavin_meganjobs_hyperdrive");
	
	boolean OnTask= 	(questIsQuestActive(questId1, player));
						
	return OnTask;					
						
	
}

// ----------------------------------------------------------------------

boolean yavin_fallenstar_pt_1_megan_condition_MeganJobs_Onquests_lostworker (obj_id player, obj_id npc)
{

	int questId1 = questGetQuestId("quest/yavin_meganjobs_lostworker");
	
	boolean OnTask= 	(questIsQuestActive(questId1, player));
						
	return OnTask;					
						
	
}

// ======================================================================
// Script Actions
// ======================================================================

void yavin_fallenstar_pt_1_megan_action_yavin_fallenStar_launch_e4 (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "yavin_fallenstar_launch_e4");	
}

// ----------------------------------------------------------------------

void yavin_fallenstar_pt_1_megan_action_yavin_fallenStar_launch_e7 (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "yavin_fallenstar_launch_e7");
}

// ----------------------------------------------------------------------

void yavin_fallenstar_pt_1_megan_action_facePlayer (obj_id player, obj_id npc)
{
	faceTo(npc, player);
}

// ----------------------------------------------------------------------

void yavin_fallenstar_pt_1_megan_action_giveQuest_lostWorker (obj_id player, obj_id npc)
{	
	int questId = questGetQuestId("quest/yavin_meganjobs_lostworker");

	groundquests.grantQuest(questId, player, npc, true);

}

// ----------------------------------------------------------------------

void yavin_fallenstar_pt_1_megan_action_rewardSignal_lostWorker (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "yavin_meganjobs_launch_e7");
}

// ----------------------------------------------------------------------

void yavin_fallenstar_pt_1_megan_action_giveQuest_hyperdrive (obj_id player, obj_id npc)
{	
	int questId = questGetQuestId("quest/yavin_meganjobs_hyperdrive");

	groundquests.grantQuest(questId, player, npc, true);

}

// ----------------------------------------------------------------------

void yavin_fallenstar_pt_1_megan_action_rewardSignal_hyperDrive (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "yavin_meganjobs_launch_e14");
}

// ----------------------------------------------------------------------

void yavin_fallenstar_pt_1_megan_action_giveQuest_killRivals (obj_id player, obj_id npc)
{	
	int questId = questGetQuestId("quest/yavin_meganjobs_killrival");

	groundquests.grantQuest(questId, player, npc, true);

}

// ----------------------------------------------------------------------

void yavin_fallenstar_pt_1_megan_action_rewardSignal_killRival (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "yavin_meganjobs_launch_e21");
}

// ======================================================================
// Script %TO Tokens
// ======================================================================

// ======================================================================
// Script %DI Tokens
// ======================================================================

// ======================================================================
// Script %DF Tokens
// ======================================================================

// ======================================================================
// handleBranch<n> Functions 
// ======================================================================

int yavin_fallenstar_pt_1_megan_handleBranch2 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Can I help you with something? 

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Osae Meilea sent us. She wants you to stop interfering with her operations. 
	if (response == "s_1489")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_yavin_fallenStar_launch_e4 (player, npc);

			//-- NPC: That poodoo is not going to move in on my operations. I have been taking her survey teams out for weeks now and I will do the same to you. Yakasoba... show these people what we do to Hutt operatives. 	
			string_id message = new string_id (c_stringFile, "s_1491");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Depends. What are you doing here?
	if (response == "s_1493")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition_onquestWarn (player, npc))
		{
			//-- NPC: I am Megan Dr'Lar. I am a contractor in charge of Imperial salvage operations here. And who are you?
			string_id message = new string_id (c_stringFile, "s_1495");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: No one in particular. Osae Meilea is upset with your recent actions. You should stop.
			boolean hasResponse0 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_1497");

				utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 4);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch4 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I am Megan Dr'Lar. I am a contractor in charge of Imperial salvage operations here. And who are you?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: No one in particular. Osae Meilea is upset with your recent actions. You should stop.
	if (response == "s_1497")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_yavin_fallenStar_launch_e4 (player, npc);

			//-- NPC: That poodoo is not going to move in on my operations. I have been taking her survey teams out for weeks now and I will do the same to you. Yakasoba... show these people what we do to Hutt operatives. 	
			string_id message = new string_id (c_stringFile, "s_1491");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch5 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Alright...Alright. I see I can't do much about this. Tell Osae that I will stop interfering with her Hutt operations. But tell her the other independents are still open season, OK?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Other independents?
	if (response == "s_1501")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			//-- NPC: Sure. You don't think it's just me and Osae out here trying to get rich from all this lovely wreckage? There are hundreds of independent operators running around trying to salvage tech and info to sell back to the Imperials or the Alliance. 
			string_id message = new string_id (c_stringFile, "s_1503");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Where did they all come from?
			boolean hasResponse0 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: Interesting.  So remember what we talked about.
			boolean hasResponse1 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_1505");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_1511");

				utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 6);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: See that you do. 
	if (response == "s_1513")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_yavin_fallenStar_launch_e7 (player, npc);

			//-- NPC: I will. 
			string_id message = new string_id (c_stringFile, "s_1515");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch6 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Sure. You don't think it's just me and Osae out here trying to get rich from all this lovely wreckage? There are hundreds of independent operators running around trying to salvage tech and info to sell back to the Imperials or the Alliance. 

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Where did they all come from?
	if (response == "s_1505")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			//-- NPC: Most of them were here before the battle. Just running small smuggling operations in Sith artifacts, or doing some illegal mining. Most of those have turned to salvaging as much Death Star tech or abandoned equipment from the Alliance bases. Both sides pay well. Me? I got a nice deal with the Imps for salvaging this bit of wreckage.  
			string_id message = new string_id (c_stringFile, "s_1507");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Well just make sure you remember to stop interfering with Osae's people.
			boolean hasResponse0 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_1509");

				utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 7);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Interesting.  So remember what we talked about.
	if (response == "s_1511")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_yavin_fallenStar_launch_e7 (player, npc);

			//-- NPC: I will. 
			string_id message = new string_id (c_stringFile, "s_1515");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch7 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Most of them were here before the battle. Just running small smuggling operations in Sith artifacts, or doing some illegal mining. Most of those have turned to salvaging as much Death Star tech or abandoned equipment from the Alliance bases. Both sides pay well. Me? I got a nice deal with the Imps for salvaging this bit of wreckage.  

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Well just make sure you remember to stop interfering with Osae's people.
	if (response == "s_1509")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_yavin_fallenStar_launch_e7 (player, npc);

			//-- NPC: I will. 
			string_id message = new string_id (c_stringFile, "s_1515");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch9 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Great job. Most of the independent criminals have scattered to the winds. The Hutts are a problem still, but the Imps are off my back so it's all good. Thanks so much.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Wasn't any problem. So what about some compensation?
	if (response == "s_99")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_rewardSignal_killRival (player, npc);

			//-- NPC: Of course. Here you go. Thanks again. Now maybe we can concentrate on opening this hatchway up. 
			string_id message = new string_id (c_stringFile, "s_103");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch12 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Things are getting a bit heated around here. Interested in helping?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Sure. What's the job?
	if (response == "s_74")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			//-- NPC: A group of criminal leaders are meeting a few kilometers of here.  Wipe them out fast. That will send a message to other criminals to stay out of my quadrant, and it will let the Imperials know I can handle the job. 
			string_id message = new string_id (c_stringFile, "s_82");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Not sure I want to get involved. 
			boolean hasResponse0 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: Ok just let me know where they are.
			boolean hasResponse1 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_84");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_86");

				utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 14);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What do you mean heated?
	if (response == "s_76")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "adjust");

			yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

			//-- NPC: There is a concerted effort by a gang of criminals to grab all of the salvage that they can find. My Imperial employers are not happy, but can't give me any troops to stop the thieves.  They want me to put a stop to it, or they are going to pull my contract.  Are you interested in helping me put an end to this?
			string_id message = new string_id (c_stringFile, "s_78");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Sure what do I need to do?
			boolean hasResponse0 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: No it sounds a bit dangerous. 
			boolean hasResponse1 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_80");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_90");

				utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 13);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Sorry not interested right now. 
	if (response == "s_92")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

			//-- NPC: Well I could really use your help. Let me know if you change your mind.
			string_id message = new string_id (c_stringFile, "s_94");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch13 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: There is a concerted effort by a gang of criminals to grab all of the salvage that they can find. My Imperial employers are not happy, but can't give me any troops to stop the thieves.  They want me to put a stop to it, or they are going to pull my contract.  Are you interested in helping me put an end to this?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Sure what do I need to do?
	if (response == "s_80")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			//-- NPC: A group of criminal leaders are meeting a few kilometers of here.  Wipe them out fast. That will send a message to other criminals to stay out of my quadrant, and it will let the Imperials know I can handle the job. 
			string_id message = new string_id (c_stringFile, "s_82");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Not sure I want to get involved. 
			boolean hasResponse0 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: Ok just let me know where they are.
			boolean hasResponse1 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_84");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_86");

				utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 14);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: No it sounds a bit dangerous. 
	if (response == "s_90")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

			//-- NPC: Well I could really use your help. Let me know if you change your mind.
			string_id message = new string_id (c_stringFile, "s_94");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch14 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: A group of criminal leaders are meeting a few kilometers of here.  Wipe them out fast. That will send a message to other criminals to stay out of my quadrant, and it will let the Imperials know I can handle the job. 

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Not sure I want to get involved. 
	if (response == "s_84")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

			//-- NPC: Well I could really use your help. Let me know if you change your mind.
			string_id message = new string_id (c_stringFile, "s_94");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Ok just let me know where they are.
	if (response == "s_86")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_giveQuest_killRivals (player, npc);

			//-- NPC: Here is the latest intel I got from my probe droid. Hurry. 
			string_id message = new string_id (c_stringFile, "s_88");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch17 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You got back quick. Any problems?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Ran into a small firefight, but we got through it alright. 
	if (response == "s_68")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_rewardSignal_hyperDrive (player, npc);

			//-- NPC: Good to hear that. Here is a finder's fee for your services. Call if you need more work.
			string_id message = new string_id (c_stringFile, "s_70");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch20 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Good to see you again.  I need some more help. Interested?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Yes I would be pleased to help out.
	if (response == "s_54")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			//-- NPC: A probe droid of mine found part of the hyperdrive intermix chamber still intact. But it's a few kilometers from here. The problem is that the Imps can't provide any extra security for me so I need to keep my people at the main work site. You interested in recovering it for me?
			string_id message = new string_id (c_stringFile, "s_56");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Just give me the coordinates and I'll be off.
			boolean hasResponse0 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_58");

				utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 21);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: No sorry. I just stopped by to say hello.
	if (response == "s_62")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			//-- NPC: Well let me know if you are interested. Things are heating up. 
			string_id message = new string_id (c_stringFile, "s_64");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch21 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: A probe droid of mine found part of the hyperdrive intermix chamber still intact. But it's a few kilometers from here. The problem is that the Imps can't provide any extra security for me so I need to keep my people at the main work site. You interested in recovering it for me?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Just give me the coordinates and I'll be off.
	if (response == "s_58")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_giveQuest_hyperdrive (player, npc);

			//-- NPC: Here you go. Be careful. The same scavengers that got Jonna are still on the loose. Take care of them if they get in your way.
			string_id message = new string_id (c_stringFile, "s_60");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch24 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Did you find him? 

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I found his body. Looks like he got in someone's way.
	if (response == "s_48")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_rewardSignal_lostWorker (player, npc);

			//-- NPC: I was afraid of that. Looks like I need to get an Imperial security detail to safeguard my work site. But I appreciate your help. Here is something for your trouble.
			string_id message = new string_id (c_stringFile, "s_50");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: No, I am still looking.
	if (response == "s_106")
	{
		doAnimationAction (player, "shake_head_no");

		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

			//-- NPC: I am really concerned about him. Please find him.
			string_id message = new string_id (c_stringFile, "s_107");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch27 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: This is a restricted area. You need to move along.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Restricted. By whom?
	if (response == "s_61")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

			//-- NPC: The Imperials. I am in charge of recovery operations around here. Lots of sensitive technology survived re-entry and I have been hired to recover as much as possible in this area.
			string_id message = new string_id (c_stringFile, "s_65");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Sounds like a big job. Anything I can help with?
			boolean hasResponse0 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: How much of a problem can it be? I mean not much could have survived.
			boolean hasResponse1 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_69");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_93");

				utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 28);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch28 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: The Imperials. I am in charge of recovery operations around here. Lots of sensitive technology survived re-entry and I have been hired to recover as much as possible in this area.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Sounds like a big job. Anything I can help with?
	if (response == "s_69")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			//-- NPC:  I have a worker who wandered off into the jungle. His name is Jonna.  If you can find him and bring him back I would be grateful. 
			string_id message = new string_id (c_stringFile, "s_73");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Sure. Any idea of where he would go?
			boolean hasResponse0 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: On second thought I think I will pass. 
			boolean hasResponse1 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_77");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_85");

				utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 29);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: How much of a problem can it be? I mean not much could have survived.
	if (response == "s_93")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

			//-- NPC: We are talking about a fully armored moon! There are literally tons of parts scattered all over the planet.  I barely have enough people to try and dig out an entrance to access the segment that caused this impact crater. But I am in charge of this whole quadrant. Between my people wandering off and criminals looking to make a quick credit scavenging the rest of the debris, I don't know how I am going to fulfill my contract.
			string_id message = new string_id (c_stringFile, "s_97");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Can I help with anything?
			boolean hasResponse0 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: Sounds tough. But I have got a few problems of my own. Take care.
			boolean hasResponse1 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_101");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_105");

				utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 32);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch29 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC:  I have a worker who wandered off into the jungle. His name is Jonna.  If you can find him and bring him back I would be grateful. 

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Sure. Any idea of where he would go?
	if (response == "s_77")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			yavin_fallenstar_pt_1_megan_action_giveQuest_lostWorker (player, npc);

			//-- NPC: Thanks so much. You might want to start at an old work site of ours. He said he lost a family heirloom and he wanted to go back and search the old camp. Here are the coordinates. 
			string_id message = new string_id (c_stringFile, "s_81");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: On second thought I think I will pass. 
	if (response == "s_85")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			//-- NPC: OK but if you change your mind give me a yell. 
			string_id message = new string_id (c_stringFile, "s_89");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int yavin_fallenstar_pt_1_megan_handleBranch32 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: We are talking about a fully armored moon! There are literally tons of parts scattered all over the planet.  I barely have enough people to try and dig out an entrance to access the segment that caused this impact crater. But I am in charge of this whole quadrant. Between my people wandering off and criminals looking to make a quick credit scavenging the rest of the debris, I don't know how I am going to fulfill my contract.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Can I help with anything?
	if (response == "s_101")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			//-- NPC:  I have a worker who wandered off into the jungle. His name is Jonna.  If you can find him and bring him back I would be grateful. 
			string_id message = new string_id (c_stringFile, "s_73");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Sure. Any idea of where he would go?
			boolean hasResponse0 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: On second thought I think I will pass. 
			boolean hasResponse1 = false;
			if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_77");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_85");

				utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 29);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Sounds tough. But I have got a few problems of my own. Take care.
	if (response == "s_105")
	{
		//-- [NOTE] 
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			//-- NPC: Yeah, you need to clear out. Don't want the Imperials to grab you for entering a restricted area. 
			string_id message = new string_id (c_stringFile, "s_110");
			utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

// ======================================================================
// User Script Triggers
// ======================================================================

trigger OnInitialize ()
{
	if ((!isMob (self)) || (isPlayer (self)))
		detachScript(self, "conversation.yavin_fallenstar_pt_1_megan");

	setCondition (self, CONDITION_CONVERSABLE);
	setCondition (self, CONDITION_INTERESTING);
	setInvulnerable (self, true);
	setName (self, "Nagem Dr' Lar");
	ai_lib.setDefaultCalmBehavior( self, ai_lib.BEHAVIOR_SENTINEL );

	return SCRIPT_CONTINUE;
}

trigger OnAttach ()
{
	setCondition (self, CONDITION_CONVERSABLE);
	setCondition (self, CONDITION_INTERESTING);
	setInvulnerable (self, true);
	setName (self, "Nagem Dr' Lar");
	ai_lib.setDefaultCalmBehavior( self, ai_lib.BEHAVIOR_SENTINEL );

	return SCRIPT_CONTINUE;
}

trigger OnObjectMenuRequest (obj_id player, menu_info menuInfo)
{
	int menu = menuInfo.addRootMenu (menu_info_types.CONVERSE_START, null);
	menu_info_data menuInfoData = menuInfo.getMenuItemById (menu);
	menuInfoData.setServerNotify (false);
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnIncapacitated (obj_id killer)
{
	clearCondition (self, CONDITION_CONVERSABLE);
	detachScript (self, "conversation.yavin_fallenstar_pt_1_megan");

	return SCRIPT_CONTINUE;
}

// ======================================================================
// Script Triggers
// ======================================================================

//-- This function should move to base_class.java
boolean npcStartConversation(obj_id player, obj_id npc, string convoName, string_id greetingId, prose_package greetingProse, string_id[] responses)
{
	Object[] objects = new Object[responses.length];
	System.arraycopy(responses, 0, objects, 0, responses.length);
	return npcStartConversation(player, npc, convoName, greetingId, greetingProse, objects);
}

// ----------------------------------------------------------------------

trigger OnStartNpcConversation (obj_id player)
{
	obj_id npc = self;

	if (ai_lib.isInCombat (npc) || ai_lib.isInCombat (player))
		return SCRIPT_OVERRIDE;

	//-- [NOTE] 
	if (yavin_fallenstar_pt_1_megan_condition_MeganJobs_Complete (player, npc))
	{
		doAnimationAction (npc, "tap_foot");

		yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

		//-- NPC: Good to see you again. Recovery efforts are going great. We think a major segment of the Death Star survived re-entry and crashed here. We are still working on getting this hatchway open.  
		string_id message = new string_id (c_stringFile, "s_102");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (yavin_fallenstar_pt_1_megan_condition_onquestWarn (player, npc))
	{
		yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

		//-- NPC: Can I help you with something? 
		string_id message = new string_id (c_stringFile, "s_1487");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Osae Meilea sent us. She wants you to stop interfering with her operations. 
		boolean hasResponse0 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: Depends. What are you doing here?
		boolean hasResponse1 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_1489");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_1493");

			utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 2);

			npcStartConversation (player, npc, "yavin_fallenstar_pt_1_megan", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (yavin_fallenstar_pt_1_megan_condition_defeatYak (player, npc))
	{
		doAnimationAction (npc, "apologize");

		yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

		//-- NPC: Alright...Alright. I see I can't do much about this. Tell Osae that I will stop interfering with her Hutt operations. But tell her the other independents are still open season, OK?
		string_id message = new string_id (c_stringFile, "s_1499");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Other independents?
		boolean hasResponse0 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: See that you do. 
		boolean hasResponse1 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_1501");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_1513");

			utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 5);

			npcStartConversation (player, npc, "yavin_fallenstar_pt_1_megan", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (yavin_fallenstar_pt_1_megan_condition_rivalsKilled (player, npc))
	{
		yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

		//-- NPC: Great job. Most of the independent criminals have scattered to the winds. The Hutts are a problem still, but the Imps are off my back so it's all good. Thanks so much.
		string_id message = new string_id (c_stringFile, "s_96");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Wasn't any problem. So what about some compensation?
		boolean hasResponse0 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_99");

			utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 9);

			npcStartConversation (player, npc, "yavin_fallenstar_pt_1_megan", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (yavin_fallenstar_pt_1_megan_condition_MeganJobs_Onquests_rivals (player, npc))
	{
		yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

		//-- NPC: You need to wipe out those criminals right now. 
		string_id message = new string_id (c_stringFile, "s_108");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (yavin_fallenstar_pt_1_megan_condition_hyperdrive_Complete (player, npc))
	{
		yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

		//-- NPC: Things are getting a bit heated around here. Interested in helping?
		string_id message = new string_id (c_stringFile, "s_72");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Sure. What's the job?
		boolean hasResponse0 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: What do you mean heated?
		boolean hasResponse1 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		//-- PLAYER: Sorry not interested right now. 
		boolean hasResponse2 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse2 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_74");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_76");

			if (hasResponse2)
				responses [responseIndex++] = new string_id (c_stringFile, "s_92");

			utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 12);

			npcStartConversation (player, npc, "yavin_fallenstar_pt_1_megan", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (yavin_fallenstar_pt_1_megan_condition_hyperdriveRecovered (player, npc))
	{
		yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

		//-- NPC: You got back quick. Any problems?
		string_id message = new string_id (c_stringFile, "s_66");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Ran into a small firefight, but we got through it alright. 
		boolean hasResponse0 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_68");

			utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 17);

			npcStartConversation (player, npc, "yavin_fallenstar_pt_1_megan", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (yavin_fallenstar_pt_1_megan_condition_MeganJobs_Onquests_hyperdrive (player, npc))
	{
		yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

		//-- NPC: I need that drive component now, before someone else gets to it.
		string_id message = new string_id (c_stringFile, "s_100");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (yavin_fallenstar_pt_1_megan_condition_lostWorker_Complete (player, npc))
	{
		yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

		//-- NPC: Good to see you again.  I need some more help. Interested?
		string_id message = new string_id (c_stringFile, "s_52");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Yes I would be pleased to help out.
		boolean hasResponse0 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: No sorry. I just stopped by to say hello.
		boolean hasResponse1 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_54");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_62");

			utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 20);

			npcStartConversation (player, npc, "yavin_fallenstar_pt_1_megan", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (yavin_fallenstar_pt_1_megan_condition_MeganJobs_Onquests_lostworker (player, npc))
	{
		doAnimationAction (npc, "greet");

		yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

		//-- NPC: Did you find him? 
		string_id message = new string_id (c_stringFile, "s_46");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I found his body. Looks like he got in someone's way.
		boolean hasResponse0 = false;
		if (yavin_fallenstar_pt_1_megan_condition_escortcomplete (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: No, I am still looking.
		boolean hasResponse1 = false;
		if (!yavin_fallenstar_pt_1_megan_condition_escortcomplete (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_48");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_106");

			utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 24);

			npcStartConversation (player, npc, "yavin_fallenstar_pt_1_megan", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
	{
		doAnimationAction (npc, "greet");

		yavin_fallenstar_pt_1_megan_action_facePlayer (player, npc);

		//-- NPC: This is a restricted area. You need to move along.
		string_id message = new string_id (c_stringFile, "s_57");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Restricted. By whom?
		boolean hasResponse0 = false;
		if (yavin_fallenstar_pt_1_megan_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_61");

			utils.setScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId", 27);

			npcStartConversation (player, npc, "yavin_fallenstar_pt_1_megan", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	chat.chat (npc, "Error:  All conditions for OnStartNpcConversation were false.");

	return SCRIPT_CONTINUE;
}

// ----------------------------------------------------------------------

trigger OnNpcConversationResponse (string conversationId, obj_id player, string_id response)
{
	if (conversationId != "yavin_fallenstar_pt_1_megan")
		return SCRIPT_CONTINUE;

	obj_id npc = self;

	int branchId = utils.getIntScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

	if (branchId == 2 && yavin_fallenstar_pt_1_megan_handleBranch2 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 4 && yavin_fallenstar_pt_1_megan_handleBranch4 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 5 && yavin_fallenstar_pt_1_megan_handleBranch5 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 6 && yavin_fallenstar_pt_1_megan_handleBranch6 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 7 && yavin_fallenstar_pt_1_megan_handleBranch7 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 9 && yavin_fallenstar_pt_1_megan_handleBranch9 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 12 && yavin_fallenstar_pt_1_megan_handleBranch12 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 13 && yavin_fallenstar_pt_1_megan_handleBranch13 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 14 && yavin_fallenstar_pt_1_megan_handleBranch14 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 17 && yavin_fallenstar_pt_1_megan_handleBranch17 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 20 && yavin_fallenstar_pt_1_megan_handleBranch20 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 21 && yavin_fallenstar_pt_1_megan_handleBranch21 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 24 && yavin_fallenstar_pt_1_megan_handleBranch24 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 27 && yavin_fallenstar_pt_1_megan_handleBranch27 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 28 && yavin_fallenstar_pt_1_megan_handleBranch28 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 29 && yavin_fallenstar_pt_1_megan_handleBranch29 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 32 && yavin_fallenstar_pt_1_megan_handleBranch32 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	chat.chat (npc, "Error:  Fell through all branches and responses for OnNpcConversationResponse.");

	utils.removeScriptVar (player, "conversation.yavin_fallenstar_pt_1_megan.branchId");

	return SCRIPT_CONTINUE;
}

// ======================================================================

