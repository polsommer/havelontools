// ======================================================================
//
// coa3wcoordinator.script
// Copyright 2004, Sony Online Entertainment
// All Rights Reserved.
//
// Created with SwgConversationEditor 1.36 - DO NOT EDIT THIS AUTO-GENERATED FILE!
//
// ======================================================================

// ======================================================================
// Library Includes
// ======================================================================

include library.ai_lib;
include library.badge;
include library.chat;
include library.factions;
include library.utils;

// ======================================================================
// Script Constants
// ======================================================================

string c_stringFile = "conversation/coa3wcoordinator";

// ======================================================================
// Script Conditions
// ======================================================================

boolean coa3wcoordinator_condition__defaultCondition (obj_id player, obj_id npc)
{
	return true;
}

// ----------------------------------------------------------------------

boolean coa3wcoordinator_condition_hasSpokeCoordinatorOnce (obj_id player, obj_id npc)
{
	return (getIntObjVar (player, "coa3.convTracker") == -101);
}

// ----------------------------------------------------------------------

boolean coa3wcoordinator_condition_hasSpokeInfoOfficer (obj_id player, obj_id npc)
{
	return (getIntObjVar (player, "coa3.convTracker") == -102);
}

// ----------------------------------------------------------------------

boolean coa3wcoordinator_condition_sentToTactOfficer (obj_id player, obj_id npc)
{
	return (getIntObjVar (player, "coa3.convTracker") == -301 || getIntObjVar (player, "coa3.convTracker") == -302);
}

// ----------------------------------------------------------------------

boolean coa3wcoordinator_condition_completedFloraStoryMission (obj_id player, obj_id npc)
{
	return (getIntObjVar (player, "coa3.convTracker") == -303);
}

// ----------------------------------------------------------------------

boolean coa3wcoordinator_condition_hasOffworldWaypoint (obj_id player, obj_id npc)
{
	return (getIntObjVar (player, "coa3.convTracker") < -400);
}

// ----------------------------------------------------------------------

boolean coa3wcoordinator_condition_playerHasDisk (obj_id player, obj_id npc)
{
	if (getIntObjVar(player, "coa3.convTracker") > 205 && getIntObjVar(player, "coa3.ConvTracker") < 209)
	{
		obj_id device = utils.getItemPlayerHasByTemplate(player, "object/tangible/theme_park/alderaan/act3/encoded_data_disk.iff");

		if (isIdValid(device)) 
		{
			destroyObject(device);
			return true;
		}
	}
	
	return false;
}

// ----------------------------------------------------------------------

boolean coa3wcoordinator_condition_lookoutMissionActive (obj_id player, obj_id npc)
{
	return ((getIntObjVar(player, "coa3.convTracker") > 199) && (getIntObjVar(player, "coa3.convTracker") < 209) && (hasObjVar(player, "coa3.rebel")));
}

// ----------------------------------------------------------------------

boolean coa3wcoordinator_condition_hasFinishedStory (obj_id player, obj_id npc)
{
// Player has the COA3 badge, # TBA;
	return (badge.hasBadge(player, "event_coa3_rebel"));
}

// ----------------------------------------------------------------------

boolean coa3wcoordinator_condition_hasCOA2Badge (obj_id player, obj_id npc)
{
// Player has the COA2 Badge #40;
	return (badge.hasBadge(player, "event_coa2_rebel"));
}

// ----------------------------------------------------------------------

boolean coa3wcoordinator_condition_isNotEnemyFaction (obj_id player, obj_id npc)
{
	string pvpFaction = factions.getFaction(player);

	return (pvpFaction == null || !pvpFaction.equals("Imperial"));
}

// ======================================================================
// Script Actions
// ======================================================================

void coa3wcoordinator_action_getLookoutMission (obj_id player, obj_id npc)
{
	setObjVar (player, "coa3.convTracker", 200);
	removeObjVar (player, "coa3.lookoutLikeMeter");

	// Start lookout mission
	dictionary params = new dictionary();
	params.put("player", player);
	params.put("npc", npc);
	params.put("value", 1);
	
	messageTo(npc, "messageStartMission", params, 0, false);	
}

// ----------------------------------------------------------------------

void coa3wcoordinator_action_getOffworldWaypoint (obj_id player, obj_id npc)
{
	setObjVar (player, "coa3.convTracker", -401);

	// Give random waypoint to one of the 5 advanced planet HQs
	dictionary params = new dictionary();
	params.put("player", player);
	params.put("npc", npc);
	params.put("value", 4);
	
	messageTo(npc, "messageStartMission", params, 0, false);	
}

// ----------------------------------------------------------------------

void coa3wcoordinator_action_refreshOffworldWaypoint (obj_id player, obj_id npc)
{
	setObjVar (player, "coa3.convTracker", -401);

	// Give the player a new waypoint to one of 5 adv planet HQs
	dictionary params = new dictionary();
	params.put("player", player);
	params.put("npc", npc);
	params.put("value", 4);

	messageTo(npc, "messageStartMission", params, 0, false);	
}

// ----------------------------------------------------------------------

void coa3wcoordinator_action_abortOffworldWaypoint (obj_id player, obj_id npc)
{
	setObjVar (player, "coa3.convTracker", -303);

	// Delete waypoint from player's datapad
	dictionary params = new dictionary();
	params.put("player", player);
	params.put("npc", npc);
	params.put("value", 4);

	messageTo(player, "handleAbortMission", params, 0, false);
}

// ----------------------------------------------------------------------

void coa3wcoordinator_action_diskToCoordinator (obj_id player, obj_id npc)
{
	setObjVar (player, "coa3.convTracker", -301);
	removeObjVar (player, "coa3.lookoutLikeMeter");
}

// ----------------------------------------------------------------------

void coa3wcoordinator_action_refreshLookoutMission (obj_id player, obj_id npc)
{
	setObjVar (player, "coa3.convTracker", 200);
	removeObjVar (player, "coa3.lookoutLikeMeter");

	// Restart the LookoutMission
	dictionary params = new dictionary();
	params.put("player", player);
	params.put("npc", npc);
	params.put("value", 1);

	messageTo(npc, "messageStartMission", params, 0, false);	
}

// ----------------------------------------------------------------------

void coa3wcoordinator_action_abortLookoutMission (obj_id player, obj_id npc)
{
	setObjVar (player, "coa3.convTracker", 200);
	removeObjVar (player, "coa3.lookoutLikeMeter");

	// Remove lookout mission from player.
	dictionary params = new dictionary();
	params.put("player", player);
	params.put("npc", npc);
	params.put("value", 1);

	messageTo(player, "handleAbortMission", params, 0, false);
}

// ----------------------------------------------------------------------

void coa3wcoordinator_action_spokeCoordinatorOnce (obj_id player, obj_id npc)
{
	setObjVar (player, "coa3.convTracker", -101);
}

// ======================================================================
// Script %TO Tokens
// ======================================================================

// ======================================================================
// Script %DI Tokens
// ======================================================================

// ======================================================================
// Script %DF Tokens
// ======================================================================

// ======================================================================
// handleBranch<n> Functions 
// ======================================================================

int coa3wcoordinator_handleBranch2 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] The player has spoken to the information officer and has gotten the story.
	//-- NPC: Ah good, you're back! I've finished analyzing the data from our most recent intelligence and it looks pretty promising. I think we are ready to proceed with our plan. I'll need you to go undercover. If you're successful you probably won't need to fire a single shot. If you fail, that's a different story and we're back to square one. Do you have any questions?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What are the details of this mission?
	if (response == "s_b4f92479")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: As I'm sure you know various underworld organizations have all but cornered the market on this Alderaanian Flora. As to be expected, Jabba the Hutt has come out ahead in this game and he seems to be the one doing the most business. This flora is enormously valuable so obviously Jabba's rivals are taking every opportunity to hijack any shipments they come across. Knowing this, Jabba is using a decentralized system of storage and transport to cut down on losses.
			string_id message = new string_id (c_stringFile, "s_ad11a99b");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Ok, go on.
			boolean hasResponse0 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I can't do this right now.
			boolean hasResponse1 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			//-- PLAYER: Enough details, I'm ready to go.
			boolean hasResponse2 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse2 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_efdb954e");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_31");

				if (hasResponse2)
					responses [responseIndex++] = new string_id (c_stringFile, "s_35");

				utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 3);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I can't do this right now.
	if (response == "s_39")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: I understand. I wouldn't want you to take on this mission unless you are completely prepared. Come back when you are ready.
			string_id message = new string_id (c_stringFile, "s_41");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] objvar set to 200 and player gets lookout mission.
	//-- PLAYER: Enough details, I'm ready to go.
	if (response == "s_43")
	{
		coa3wcoordinator_action_getLookoutMission (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Pose as one of them and do whatever you can to get your hands on some hard data about that caravan. Things like papers, manifests or disks. Come back as soon as you find something. Be careful and remember to think like a thug. If things go bad, you'll have no choice but to fight. Should that happen, come back and we can try it again.
			string_id message = new string_id (c_stringFile, "s_45");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch3 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: As I'm sure you know various underworld organizations have all but cornered the market on this Alderaanian Flora. As to be expected, Jabba the Hutt has come out ahead in this game and he seems to be the one doing the most business. This flora is enormously valuable so obviously Jabba's rivals are taking every opportunity to hijack any shipments they come across. Knowing this, Jabba is using a decentralized system of storage and transport to cut down on losses.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Ok, go on.
	if (response == "s_efdb954e")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: He's using land vehicles to traffic the flora to and from the storehouses with a complex system of lookouts scattered along the routes. If any trouble is spotted, the caravans are alerted and they use a different route. It's all very organized. The intelligence I just analyzed reveals the location of all the lookouts on the planet and it indicates a caravan is to make a delivery today. Predicting the caravan's destination is simply impossible. This is where you come in.
			string_id message = new string_id (c_stringFile, "s_4724fd7d");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Interesting. Please continue.
			boolean hasResponse0 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I can't do this right now.
			boolean hasResponse1 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			//-- PLAYER: Enough details, I'm ready to go.
			boolean hasResponse2 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse2 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_19d2e135");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_23");

				if (hasResponse2)
					responses [responseIndex++] = new string_id (c_stringFile, "s_27");

				utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 4);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I can't do this right now.
	if (response == "s_31")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: I understand. I wouldn't want you to take on this mission unless you are completely prepared. Come back when you are ready.
			string_id message = new string_id (c_stringFile, "s_33");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] objvar set to 200 and player gets lookout mission.
	//-- PLAYER: Enough details, I'm ready to go.
	if (response == "s_35")
	{
		coa3wcoordinator_action_getLookoutMission (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Pose as one of them and do whatever you can to get your hands on some hard data about that caravan. Things like papers, manifests or disks. Come back as soon as you find something. Be careful and remember to think like a thug. If things go bad, you'll have no choice but to fight. Should that happen, come back and we can try it again.
			string_id message = new string_id (c_stringFile, "s_37");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch4 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: He's using land vehicles to traffic the flora to and from the storehouses with a complex system of lookouts scattered along the routes. If any trouble is spotted, the caravans are alerted and they use a different route. It's all very organized. The intelligence I just analyzed reveals the location of all the lookouts on the planet and it indicates a caravan is to make a delivery today. Predicting the caravan's destination is simply impossible. This is where you come in.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Interesting. Please continue.
	if (response == "s_19d2e135")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: They are so cautious that caravans have been known to zig zag and circle for hours before finally heading to their destination unless things are completely safe. Simple observation won't tell us anything, so we need you to pose as a member of their organization and try to gather information about where that caravan is headed. We need hard information; disks, papers, whatever you can find. As you can imagine, this will be dangerous.
			string_id message = new string_id (c_stringFile, "s_1fd11fc5");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: How so?
			boolean hasResponse0 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I can't do this right now.
			boolean hasResponse1 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			//-- PLAYER: Enough details, I'm ready to go.
			boolean hasResponse2 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse2 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_4ca03ddb");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_17");

				if (hasResponse2)
					responses [responseIndex++] = new string_id (c_stringFile, "s_28de3a91");

				utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 5);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I can't do this right now.
	if (response == "s_23")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: I understand. I wouldn't want you to take on this mission unless you are completely prepared. Come back when you are ready.
			string_id message = new string_id (c_stringFile, "s_25");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] objvar set to 200 and player gets lookout mission.
	//-- PLAYER: Enough details, I'm ready to go.
	if (response == "s_27")
	{
		coa3wcoordinator_action_getLookoutMission (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Pose as one of them and do whatever you can to get your hands on some hard data about that caravan. Things like papers, manifests or disks. Come back as soon as you find something. Be careful and remember to think like a thug. If things go bad, you'll have no choice but to fight. Should that happen, come back and we can try it again.
			string_id message = new string_id (c_stringFile, "s_29");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch5 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: They are so cautious that caravans have been known to zig zag and circle for hours before finally heading to their destination unless things are completely safe. Simple observation won't tell us anything, so we need you to pose as a member of their organization and try to gather information about where that caravan is headed. We need hard information; disks, papers, whatever you can find. As you can imagine, this will be dangerous.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: How so?
	if (response == "s_4ca03ddb")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: These people are incredibly suspicious so you'll need to be very convincing. If they suspect you they won't hesitate to attack. If that happens, then I'm afraid we'll have to start over and try it again. Are you prepared to take on this task?
			string_id message = new string_id (c_stringFile, "s_1f81bc3c");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I'm ready to go.
			boolean hasResponse0 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I can't do this right now.
			boolean hasResponse1 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_d55f2579");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_36142d2b");

				utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 6);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I can't do this right now.
	if (response == "s_17")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: I understand. I wouldn't want you to take on this mission unless you are completely prepared. Come back when you are ready.
			string_id message = new string_id (c_stringFile, "s_19");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] objvar set to 200 and player gets lookout mission.
	//-- PLAYER: Enough details, I'm ready to go.
	if (response == "s_28de3a91")
	{
		coa3wcoordinator_action_getLookoutMission (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Pose as one of them and do whatever you can to get your hands on some hard data about that caravan. Things like papers, manifests or disks. Come back as soon as you find something. Be careful and remember to think like a thug. If things go bad, you'll have no choice but to fight. Should that happen, come back and we can try it again.
			string_id message = new string_id (c_stringFile, "s_26b400f9");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch6 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: These people are incredibly suspicious so you'll need to be very convincing. If they suspect you they won't hesitate to attack. If that happens, then I'm afraid we'll have to start over and try it again. Are you prepared to take on this task?

	//-- [RESPONSE NOTE] objvar set to 200 and player gets lookout mission.
	//-- PLAYER: I'm ready to go.
	if (response == "s_d55f2579")
	{
		coa3wcoordinator_action_getLookoutMission (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Great! I've uploaded the location of one of their lookouts to your datapad. Pose as one of them and do whatever you can to get your hands on some hard data about that caravan. Things like papers, manifests or disks. Come back as soon as you find something. Be careful and remember to think like a thug. If things go bad, you'll have no choice but to fight. Should that happen, come back and we can try it again.
			string_id message = new string_id (c_stringFile, "s_eae61031");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I can't do this right now.
	if (response == "s_36142d2b")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: I understand. I wouldn't want you to take on this mission unless you are completely prepared. Come back when you are ready.
			string_id message = new string_id (c_stringFile, "s_37281366");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch18 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] The player has completed the flora story mission. Note that on completion of the flora story mission, the player's objvar needs to be set to -303.
	//-- NPC: Great to see you again. Those disks you acquired have been of great help to our Tactical Officer. He'll be able to assign as many assault missions as you can take, but there is something of more importance if you're up for it.

	//-- [RESPONSE NOTE] Set objvar to -401 and give the waypoint to one of the five offworld advanced planet locations.
	//-- PLAYER: I'm up for anything.
	if (response == "s_f35aaa26")
	{
		coa3wcoordinator_action_getOffworldWaypoint (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: I thought you'd say that. You've made a big impression and the Princess has decided to oversee the operation herself. She said she wanted to speak with you personally about it. I've added a waypoint to your datapad with the location of the off-world headquarters. I'd head there at once so you don't keep her waiting.
			string_id message = new string_id (c_stringFile, "s_a97e415d");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I'm not able to do this now.
	if (response == "s_d819b34e")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: That's too bad, I was hoping I could count on your support with this. The offer still stands if you change your mind.
			string_id message = new string_id (c_stringFile, "s_740fcda6");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch22 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] The player has been given the offworld waypoint already and his objvar is less the -400
	//-- NPC: Have you been to see the Princess yet? You probably don't want to keep her waiting. Anyway, was there something I can help you with right now?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Nothing for right now, thanks.
	if (response == "s_bc0e9972")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Ok, carry on. You should probably leave soon though.
			string_id message = new string_id (c_stringFile, "s_ecae16e7");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] Regardless is progress, set the objvar back to -401. Give them a new waypoint.
	//-- PLAYER: Are you sure that waypoint was correct?
	if (response == "s_52cc7bda")
	{
		coa3wcoordinator_action_refreshOffworldWaypoint (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: I thought that it was correct. I'll update your datapad again just to be safe.
			string_id message = new string_id (c_stringFile, "s_cd603241");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] Set the objvar back to -303 (completed flora story mission) and delete waypoint.
	//-- PLAYER: I can't make it there right now.
	if (response == "s_315ff574")
	{
		coa3wcoordinator_action_abortOffworldWaypoint (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Well that's a shame. If you change your mind, please let me know.
			string_id message = new string_id (c_stringFile, "s_45cbfb7d");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch27 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] The player is somewhere within the lookout/carvan missions. Player obviously did not have the disk either.
	//-- NPC: Well, how did things go?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What were the details of the mission again?
	if (response == "s_a6f2327f")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: As I'm sure you know various underworld organizations have all but cornered the market on this Alderaanian Flora. As to be expected, Jabba the Hutt has come out ahead in this game and he seems to be the one doing the most business. This flora is enormously valuable so obviously Jabba's rivals are taking every opportunity to hijack any shipments they come across. Knowing this, Jabba is using a decentralized system of storage and transport to cut down on losses.
			string_id message = new string_id (c_stringFile, "s_64");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Ok, go on.
			boolean hasResponse0 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_66");

				utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 28);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] Set the player's progress back to the beginning, objvar 200. Give them a new waypoint to lookout.
	//-- PLAYER: Can I have another waypoint?
	if (response == "s_7b9e2f5e")
	{
		coa3wcoordinator_action_refreshLookoutMission (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Ran into trouble did you? Well there are plenty of lookouts out there still. Here is the location of another one. Come back as soon as you find any sort of hard data about that caravan and maybe we can determine where it was heading. Good luck to you!
			string_id message = new string_id (c_stringFile, "s_8ee9343e");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Any hints?
	if (response == "s_75565d5a")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: A direct approach might get you killed. You'll need to get friendly with them first and then maybe they will trust you and open up. Think like a thug. Thugs are generally greedy, selfish, out for themselves. They like things like drinking, gambling, cheating, carousing; that sort of thing.
			string_id message = new string_id (c_stringFile, "s_cf35e3d5");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] Set the player's progress back to the beginning of the lookout mission, objvar 200. Abort the mission.
	//-- PLAYER: I can't do this right now.
	if (response == "s_81")
	{
		coa3wcoordinator_action_abortLookoutMission (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: I'm sorry to hear that. Come back later if you change your mind.
			string_id message = new string_id (c_stringFile, "s_a3ea7bf6");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch28 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: As I'm sure you know various underworld organizations have all but cornered the market on this Alderaanian Flora. As to be expected, Jabba the Hutt has come out ahead in this game and he seems to be the one doing the most business. This flora is enormously valuable so obviously Jabba's rivals are taking every opportunity to hijack any shipments they come across. Knowing this, Jabba is using a decentralized system of storage and transport to cut down on losses.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Ok, go on.
	if (response == "s_66")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: He's using land vehicles to traffic the flora to and from the storehouses with a complex system of lookouts scattered along the routes. If any trouble is spotted, the caravans are alerted and they use a different route. It's all very organized. The intelligence I just analyzed reveals the location of all the lookouts on the planet and it indicates a caravan is to make a delivery today. Predicting the caravan's destination is simply impossible. This is where you come in.
			string_id message = new string_id (c_stringFile, "s_68");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Interesting. Please continue.
			boolean hasResponse0 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_70");

				utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 29);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch29 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: He's using land vehicles to traffic the flora to and from the storehouses with a complex system of lookouts scattered along the routes. If any trouble is spotted, the caravans are alerted and they use a different route. It's all very organized. The intelligence I just analyzed reveals the location of all the lookouts on the planet and it indicates a caravan is to make a delivery today. Predicting the caravan's destination is simply impossible. This is where you come in.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Interesting. Please continue.
	if (response == "s_70")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: They are so cautious that caravans have been known to zig zag and circle for hours before finally heading to their destination unless things are completely safe. Simple observation won't tell us anything, so we need you to pose as a member of their organization and try to gather information about where that caravan is headed. We need hard information; disks, papers, whatever you can find. As you can imagine, this will be dangerous.
			string_id message = new string_id (c_stringFile, "s_72");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: How so?
			boolean hasResponse0 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_74");

				utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 30);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch30 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: They are so cautious that caravans have been known to zig zag and circle for hours before finally heading to their destination unless things are completely safe. Simple observation won't tell us anything, so we need you to pose as a member of their organization and try to gather information about where that caravan is headed. We need hard information; disks, papers, whatever you can find. As you can imagine, this will be dangerous.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: How so?
	if (response == "s_74")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: These people are incredibly suspicious so you'll need to be very convincing. If they suspect you they won't hesitate to attack. If that happens, then I'm afraid we'll have to start over and try it again. 
			string_id message = new string_id (c_stringFile, "s_86f67673");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch35 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] The player has the Event: Vacca's Allegiance Rebel badge. The coordinator kisses up to the player.
	//-- NPC: I see you're back. Good job. Everyone's talking about how you were able to break into that relay station and send the Princess' message. Quite a feat. I haven't been fully briefed yet, but I hear Vacca's made his decision. Whichever side he picks, things are going to get interesting. You want to stick around and help? We could use you.

	//-- [RESPONSE NOTE] objvar set to -101. The information officer will speak to the player now.
	//-- PLAYER: I'll do what I can to help.
	if (response == "s_afc313e6")
	{
		coa3wcoordinator_action_spokeCoordinatorOnce (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Excellent! If you do as well as last time, we will definitely come out on top. I haven't been briefed on the details so you'll have to go speak with the Information Officer, he'll fill you in. You can find him in the Commerce Guild Hall in this city.
			string_id message = new string_id (c_stringFile, "s_e0227bd9");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Ok, I'll go see what he has to say.
			boolean hasResponse0 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_f595b0cb");

				utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 36);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I need to do something else right now.
	if (response == "s_20eec74a")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: I understand. You must be a very busy person. We haven't forgotten about what you did for us last time and we don't want to put you out. We really could use your help though. Come back if you change your mind and see me. I'm sure we can use your talents.
			string_id message = new string_id (c_stringFile, "s_fb75278f");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch36 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Excellent! If you do as well as last time, we will definitely come out on top. I haven't been briefed on the details so you'll have to go speak with the Information Officer, he'll fill you in. You can find him in the Commerce Guild Hall in this city.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Ok, I'll go see what he has to say.
	if (response == "s_f595b0cb")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Good. He'll give you a status report. By the time you return from the Commerce Guild Hall I should have updated intel on our next move. See you soon.
			string_id message = new string_id (c_stringFile, "s_4f6ac618");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch39 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] None of the above are true.
	//-- NPC: Hello.  I don't recall if we've worked together before. No matter, if you're loyal to the ideals of freedom and against the tyranny of the Empire, we can use you. And now is as good a time as any to get involved and help us out. Are you interested?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What's going on?
	if (response == "s_62241cb7")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: You haven't heard? Let me take a moment to fill you in. Dead Eye is the code name for what was an Imperial research project. It is a pharmaceutical that grants the user deadly aim. It can make even the greenest recruit a potential threat. It was developed by a scientist named Dr. Vacca. The situation looks sort of grim for us right now but we aren't without hope. That's where you come in.
			string_id message = new string_id (c_stringFile, "s_dcc13dd0");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I'd like to get involved.
			boolean hasResponse0 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I need to do something else right now.
			boolean hasResponse1 = false;
			if (coa3wcoordinator_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_6922db62");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_96");

				utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 40);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] objvar set to -101. Info officer will speak to player now.
	//-- PLAYER: I'd like to get involved.
	if (response == "s_99")
	{
		coa3wcoordinator_action_spokeCoordinatorOnce (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: I'm happy to hear you say that, now is as good a time as any! We have an Information Officer who we have stationed in Commerce Guild of this city. Find the Commerce Guild and speak to the Information Officer there and ask him to fill you on all that has happened so far.
			string_id message = new string_id (c_stringFile, "s_101");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I need to do something else right now.
	if (response == "s_103")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Oh, well that's too bad. I we'd found another person we could rely on for help in our time of need. I hope you change your mind later on. If you do, please let me know.
			string_id message = new string_id (c_stringFile, "s_d8988a1e");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int coa3wcoordinator_handleBranch40 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You haven't heard? Let me take a moment to fill you in. Dead Eye is the code name for what was an Imperial research project. It is a pharmaceutical that grants the user deadly aim. It can make even the greenest recruit a potential threat. It was developed by a scientist named Dr. Vacca. The situation looks sort of grim for us right now but we aren't without hope. That's where you come in.

	//-- [RESPONSE NOTE] objvar set to -101. Info officer will speak to player now.
	//-- PLAYER: I'd like to get involved.
	if (response == "s_6922db62")
	{
		coa3wcoordinator_action_spokeCoordinatorOnce (player, npc);

		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: I'm happy to hear you say that, now is as good a time as any! We have an Information Officer who we have stationed in Commerce Guild of this city. Find the Commerce Guild and speak to the Information Officer there and ask him to fill you on all that has happened so far.
			string_id message = new string_id (c_stringFile, "s_1b4eff7e");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I need to do something else right now.
	if (response == "s_96")
	{
		//-- [NOTE] 
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			//-- NPC: Oh, well that's too bad. I'd thought we'd found another person we could rely on for help in our time of need. I hope you change your mind later on. If you do, please let me know.
			string_id message = new string_id (c_stringFile, "s_4aecac09");
			utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

// ======================================================================
// User Script Triggers
// ======================================================================

trigger OnInitialize ()
{
	if ((!isMob (self)) || (isPlayer (self)))
		detachScript(self, "conversation.coa3wcoordinator");

	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnAttach ()
{
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnObjectMenuRequest (obj_id player, menu_info menuInfo)
{
	int menu = menuInfo.addRootMenu (menu_info_types.CONVERSE_START, null);
	menu_info_data menuInfoData = menuInfo.getMenuItemById (menu);
	menuInfoData.setServerNotify (false);
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnIncapacitated (obj_id killer)
{
	clearCondition (self, CONDITION_CONVERSABLE);
	detachScript (self, "conversation.coa3wcoordinator");

	return SCRIPT_CONTINUE;
}

// ======================================================================
// Script Triggers
// ======================================================================

//-- This function should move to base_class.java
boolean npcStartConversation(obj_id player, obj_id npc, string convoName, string_id greetingId, prose_package greetingProse, string_id[] responses)
{
	Object[] objects = new Object[responses.length];
	System.arraycopy(responses, 0, objects, 0, responses.length);
	return npcStartConversation(player, npc, convoName, greetingId, greetingProse, objects);
}

// ----------------------------------------------------------------------

trigger OnStartNpcConversation (obj_id player)
{
	obj_id npc = self;

	if (ai_lib.isInCombat (npc) || ai_lib.isInCombat (player))
		return SCRIPT_OVERRIDE;

	//-- [NOTE] The player has spoken with the coordinator but has not spoken with the info officer yet.
	if (coa3wcoordinator_condition_hasSpokeCoordinatorOnce (player, npc))
	{
		//-- NPC: Oh it's you again! I didn't expect to see you so soon. Unfortunately, I'm still crunching some data right now. Why don't you go and speak with our Information Officer. You can find him in the Commerce Guild in this city. Get all details from him about our current situation and by the time you're done with that, I should be done analyzing this data.
		string_id message = new string_id (c_stringFile, "s_6837ec87");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] The player has spoken to the information officer and has gotten the story.
	if (coa3wcoordinator_condition_hasSpokeInfoOfficer (player, npc))
	{
		//-- NPC: Ah good, you're back! I've finished analyzing the data from our most recent intelligence and it looks pretty promising. I think we are ready to proceed with our plan. I'll need you to go undercover. If you're successful you probably won't need to fire a single shot. If you fail, that's a different story and we're back to square one. Do you have any questions?
		string_id message = new string_id (c_stringFile, "s_4ba81cc8");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: What are the details of this mission?
		boolean hasResponse0 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: I can't do this right now.
		boolean hasResponse1 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		//-- PLAYER: Enough details, I'm ready to go.
		boolean hasResponse2 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse2 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_b4f92479");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_39");

			if (hasResponse2)
				responses [responseIndex++] = new string_id (c_stringFile, "s_43");

			utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 2);

			npcStartConversation (player, npc, "coa3wcoordinator", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] The player has been told to find the tactical officer but has not completed his mission (flora story mission) yet. The objvar could either be -301 or -302.
	if (coa3wcoordinator_condition_sentToTactOfficer (player, npc))
	{
		//-- NPC: Back so soon? I'm still trying to break the encryption on this disk. It's going to take me some time. In the mean time, go and speak with the Tactical Officer. You can find him in the Combat Guild in this city. I'm sure he has plenty that needs to be done.
		string_id message = new string_id (c_stringFile, "s_19d54dc3");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] The player has completed the flora story mission. Note that on completion of the flora story mission, the player's objvar needs to be set to -303.
	if (coa3wcoordinator_condition_completedFloraStoryMission (player, npc))
	{
		//-- NPC: Great to see you again. Those disks you acquired have been of great help to our Tactical Officer. He'll be able to assign as many assault missions as you can take, but there is something of more importance if you're up for it.
		string_id message = new string_id (c_stringFile, "s_fa0fdb09");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I'm up for anything.
		boolean hasResponse0 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: I'm not able to do this now.
		boolean hasResponse1 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_f35aaa26");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_d819b34e");

			utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 18);

			npcStartConversation (player, npc, "coa3wcoordinator", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] The player has finished Act 3 and gotten their Winners badge.
	if (coa3wcoordinator_condition_hasFinishedStory (player, npc))
	{
		//-- NPC: Good to see you again. Thanks to your efforts we stand a good chance of finding an alternative source of flora for Dead Eye. You're to be commended. I don't have anything else I need from you right now, but you might ask our Tactical Officer at the Combat Guild if he still needs helping tracking down and destroying those warehouses.
		string_id message = new string_id (c_stringFile, "s_e2c3d142");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] The player has been given the offworld waypoint already and his objvar is less the -400
	if (coa3wcoordinator_condition_hasOffworldWaypoint (player, npc))
	{
		//-- NPC: Have you been to see the Princess yet? You probably don't want to keep her waiting. Anyway, was there something I can help you with right now?
		string_id message = new string_id (c_stringFile, "s_c9282e23");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Nothing for right now, thanks.
		boolean hasResponse0 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: Are you sure that waypoint was correct?
		boolean hasResponse1 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		//-- PLAYER: I can't make it there right now.
		boolean hasResponse2 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse2 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_bc0e9972");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_52cc7bda");

			if (hasResponse2)
				responses [responseIndex++] = new string_id (c_stringFile, "s_315ff574");

			utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 22);

			npcStartConversation (player, npc, "coa3wcoordinator", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] The player is somewhere between accepting the mission from the lookout (206) and fixing the part (208) and has the disk. They can either get the disk by killing the caravan leader or by fixing the part.
	if (coa3wcoordinator_condition_playerHasDisk (player, npc))
	{
		coa3wcoordinator_action_diskToCoordinator (player, npc);

		//-- NPC: Excellent work! To be honest, I didn't think you could pull it off. You must have done some real smooth talking! I'll start analyzing the disk right away but it is going to take some time. Why don't you go and speak with the Tactical Officer, I believe he has something for you to do. You can find him in the Combat Guild of this city.
		string_id message = new string_id (c_stringFile, "s_fec795");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] The player is somewhere within the lookout/carvan missions. Player obviously did not have the disk either.
	if (coa3wcoordinator_condition_lookoutMissionActive (player, npc))
	{
		//-- NPC: Well, how did things go?
		string_id message = new string_id (c_stringFile, "s_882bc6e0");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: What were the details of the mission again?
		boolean hasResponse0 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: Can I have another waypoint?
		boolean hasResponse1 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		//-- PLAYER: Any hints?
		boolean hasResponse2 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse2 = true;
		}

		//-- PLAYER: I can't do this right now.
		boolean hasResponse3 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse3 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_a6f2327f");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_7b9e2f5e");

			if (hasResponse2)
				responses [responseIndex++] = new string_id (c_stringFile, "s_75565d5a");

			if (hasResponse3)
				responses [responseIndex++] = new string_id (c_stringFile, "s_81");

			utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 27);

			npcStartConversation (player, npc, "coa3wcoordinator", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] The player has the Event: Vacca's Allegiance Rebel badge. The coordinator kisses up to the player.
	if (coa3wcoordinator_condition_hasCOA2Badge (player, npc))
	{
		//-- NPC: I see you're back. Good job. Everyone's talking about how you were able to break into that relay station and send the Princess' message. Quite a feat. I haven't been fully briefed yet, but I hear Vacca's made his decision. Whichever side he picks, things are going to get interesting. You want to stick around and help? We could use you.
		string_id message = new string_id (c_stringFile, "s_8d99c71a");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I'll do what I can to help.
		boolean hasResponse0 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: I need to do something else right now.
		boolean hasResponse1 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_afc313e6");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_20eec74a");

			utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 35);

			npcStartConversation (player, npc, "coa3wcoordinator", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] None of the above are true.
	if (coa3wcoordinator_condition_isNotEnemyFaction (player, npc))
	{
		//-- NPC: Hello.  I don't recall if we've worked together before. No matter, if you're loyal to the ideals of freedom and against the tyranny of the Empire, we can use you. And now is as good a time as any to get involved and help us out. Are you interested?
		string_id message = new string_id (c_stringFile, "s_afa4d099");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: What's going on?
		boolean hasResponse0 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: I'd like to get involved.
		boolean hasResponse1 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		//-- PLAYER: I need to do something else right now.
		boolean hasResponse2 = false;
		if (coa3wcoordinator_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse2 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_62241cb7");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_99");

			if (hasResponse2)
				responses [responseIndex++] = new string_id (c_stringFile, "s_103");

			utils.setScriptVar (player, "conversation.coa3wcoordinator.branchId", 39);

			npcStartConversation (player, npc, "coa3wcoordinator", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (coa3wcoordinator_condition__defaultCondition (player, npc))
	{
		//-- NPC: Don't you have anything better to do then to harass a law abiding citizen? Get lost!
		string_id message = new string_id (c_stringFile, "s_e19d057c");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	chat.chat (npc, "Error:  All conditions for OnStartNpcConversation were false.");

	return SCRIPT_CONTINUE;
}

// ----------------------------------------------------------------------

trigger OnNpcConversationResponse (string conversationId, obj_id player, string_id response)
{
	if (conversationId != "coa3wcoordinator")
		return SCRIPT_CONTINUE;

	obj_id npc = self;

	int branchId = utils.getIntScriptVar (player, "conversation.coa3wcoordinator.branchId");

	if (branchId == 2 && coa3wcoordinator_handleBranch2 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 3 && coa3wcoordinator_handleBranch3 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 4 && coa3wcoordinator_handleBranch4 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 5 && coa3wcoordinator_handleBranch5 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 6 && coa3wcoordinator_handleBranch6 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 18 && coa3wcoordinator_handleBranch18 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 22 && coa3wcoordinator_handleBranch22 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 27 && coa3wcoordinator_handleBranch27 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 28 && coa3wcoordinator_handleBranch28 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 29 && coa3wcoordinator_handleBranch29 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 30 && coa3wcoordinator_handleBranch30 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 35 && coa3wcoordinator_handleBranch35 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 36 && coa3wcoordinator_handleBranch36 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 39 && coa3wcoordinator_handleBranch39 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 40 && coa3wcoordinator_handleBranch40 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	chat.chat (npc, "Error:  Fell through all branches and responses for OnNpcConversationResponse.");

	utils.removeScriptVar (player, "conversation.coa3wcoordinator.branchId");

	return SCRIPT_CONTINUE;
}

// ======================================================================

