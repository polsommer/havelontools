// ======================================================================
//
// c_newbie_melee_combat.script
// Copyright 2004, Sony Online Entertainment
// All Rights Reserved.
//
// Created with SwgConversationEditor 1.35 - DO NOT EDIT THIS AUTO-GENERATED FILE!
//
// ======================================================================

// ======================================================================
// Library Includes
// ======================================================================

include library.ai_lib;
include library.chat;
include library.groundquests;
include library.utils;

// ======================================================================
// Script Constants
// ======================================================================

string c_stringFile = "conversation/c_newbie_melee_combat";

// ======================================================================
// Script Conditions
// ======================================================================

boolean c_newbie_melee_combat_condition__defaultCondition (obj_id player, obj_id npc)
{
	return true;
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_sentByMayor (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "c_melee_combat_trainer", "newbie_goto_peawp_02") ||
	groundquests.hasCompletedQuest(player, "c_melee_combat_trainer");
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_completedPeawpQuests (obj_id player, obj_id npc)
{
	return (groundquests.isTaskActive(player, "newbie_mayor_vaigon_shinn", "mayor_vaigon_shinn_03") ||
			groundquests.isTaskActive(player, "newbie_mayor_vaigon_shinn", "mayor_vaigon_shinn_04") ||
			groundquests.hasCompletedQuest(player, "newbie_mayor_vaigon_shinn"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_returningViagonShinn (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "newbie_mayor_vaigon_shinn", "mayor_vaigon_shinn_02") ||
	groundquests.hasCompletedQuest(player, "newbie_mayor_vaigon_shinn");
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_onSwoopers (obj_id player, obj_id npc)
{
	return (groundquests.isQuestActive(player, "newbie_mayor_hooligans_swoopers") ||
			groundquests.isQuestActive(player, "newbie_mayor_hooligans_swoopers_2"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_returningSwoopers (obj_id player, obj_id npc)
{
	return (groundquests.isTaskActive(player, "newbie_mayor_hooligans_swoopers", "mayor_hooligans_swoopers_02") ||
			groundquests.hasCompletedQuest(player, "newbie_mayor_hooligans_swoopers") ||
			groundquests.hasCompletedQuest(player, "newbie_mayor_hooligans_swoopers_2"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_onScavengers (obj_id player, obj_id npc)
{
	return (groundquests.isTaskActive(player, "newbie_mayor_hooligans_water_thief", "mayor_water_thief_00") ||
			groundquests.isTaskActive(player, "newbie_mayor_hooligans_water_thief_2", "mayor_water_thief_00"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_returningWaterThief (obj_id player, obj_id npc)
{
	return (groundquests.isTaskActive(player, "newbie_mayor_hooligans_water_thief", "mayor_water_thief_02") ||
			groundquests.hasCompletedQuest(player, "newbie_mayor_hooligans_water_thief") ||
			groundquests.hasCompletedQuest(player, "newbie_mayor_hooligans_water_thief_2"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_onWaterThief (obj_id player, obj_id npc)
{
	return (groundquests.hasCompletedTask(player, "newbie_mayor_hooligans_water_thief", "mayor_water_thief_00") ||
			groundquests.hasCompletedTask(player, "newbie_mayor_hooligans_water_thief_2", "mayor_water_thief_00"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_returningGunrunners (obj_id player, obj_id npc)
{
	return (groundquests.isTaskActive(player, "newbie_mayor_hooligans_gunrunners", "mayor_gunrunner_02") ||
			groundquests.hasCompletedQuest(player, "newbie_mayor_hooligans_gunrunners") ||
			groundquests.hasCompletedQuest(player, "newbie_mayor_hooligans_gunrunners_2"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_onGunrunners (obj_id player, obj_id npc)
{
	return (groundquests.isQuestActive(player, "newbie_mayor_hooligans_gunrunners") ||
			groundquests.isQuestActive(player, "newbie_mayor_hooligans_gunrunners_2"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_onDroids (obj_id player, obj_id npc)
{
	return (groundquests.isTaskActive(player, "newbie_mayor_hooligans_criminals", "mayor_criminals_00") ||
			groundquests.isTaskActive(player, "newbie_mayor_hooligans_criminals_2", "mayor_criminals_00"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_returningCriminals (obj_id player, obj_id npc)
{
	return (groundquests.isTaskActive(player, "newbie_mayor_hooligans_criminals", "mayor_criminals_02") ||
			groundquests.hasCompletedQuest(player, "newbie_mayor_hooligans_criminals_2") ||
			groundquests.hasCompletedQuest(player, "newbie_mayor_hooligans_criminals"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_onCriminals (obj_id player, obj_id npc)
{
	return (groundquests.hasCompletedTask(player, "newbie_mayor_hooligans_criminals", "mayor_criminals_00") ||
			groundquests.hasCompletedTask(player, "newbie_mayor_hooligans_criminals_2", "mayor_criminals_00"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_returningMuggers (obj_id player, obj_id npc)
{
	return (groundquests.isTaskActive(player, "newbie_mayor_shinn_muggers", "mayor_shinn_mugger_02") ||
			groundquests.hasCompletedQuest(player, "newbie_mayor_shinn_muggers") ||
			groundquests.hasCompletedQuest(player, "newbie_mayor_shinn_muggers_2"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_onMuggers (obj_id player, obj_id npc)
{
	return (groundquests.isQuestActive(player, "newbie_mayor_shinn_muggers") ||
			groundquests.isQuestActive(player, "newbie_mayor_shinn_muggers_2"));
}

// ----------------------------------------------------------------------

boolean c_newbie_melee_combat_condition_onVaigonShinn (obj_id player, obj_id npc)
{
	return groundquests.isQuestActive(player, "newbie_mayor_vaigon_shinn");
}

// ======================================================================
// Script Actions
// ======================================================================

void c_newbie_melee_combat_action_sendToMayor (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "mayor_vaigon_shinn_02");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_signal_pickingPocket (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "peawpsPocketPicked");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_grantSwoopers (obj_id player, obj_id npc)
{
	groundquests.requestGrantQuest(player, "newbie_mayor_hooligans_swoopers_2");
	//groundquests.requestGrantQuest(player, "newbie_mayor_hooligans_swoopers");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_grantScavengers (obj_id player, obj_id npc)
{
	groundquests.requestGrantQuest(player, "newbie_mayor_hooligans_scavengers");	
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_grantWaterThief (obj_id player, obj_id npc)
{
	groundquests.requestGrantQuest(player, "newbie_mayor_hooligans_water_thief_2");
	//groundquests.requestGrantQuest(player, "newbie_mayor_hooligans_water_thief");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_grantGunrunners (obj_id player, obj_id npc)
{
	groundquests.requestGrantQuest(player, "newbie_mayor_hooligans_gunrunners_2");
	//groundquests.requestGrantQuest(player, "newbie_mayor_hooligans_gunrunners");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_grantCriminals (obj_id player, obj_id npc)
{
	groundquests.requestGrantQuest(player, "newbie_mayor_hooligans_criminals_2");
	//groundquests.requestGrantQuest(player, "newbie_mayor_hooligans_criminals");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_grantMuggers (obj_id player, obj_id npc)
{
	groundquests.requestGrantQuest(player, "newbie_mayor_shinn_muggers_2");
	//groundquests.requestGrantQuest(player, "newbie_mayor_shinn_muggers");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_grantVaigonShin (obj_id player, obj_id npc)
{
	groundquests.requestGrantQuest(player, "newbie_mayor_vaigon_shinn");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_endSwoopers (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "mayor_hooligans_swoopers_02");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_endWaterThief (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "mayor_water_thief_02");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_endGunrunners (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "mayor_gunrunner_02");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_endCriminals (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "mayor_criminals_02");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_endMuggers (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "mayor_shinn_mugger_02");
}

// ----------------------------------------------------------------------

void c_newbie_melee_combat_action_endFromMayor (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "newbie_goto_peawp_02");
}

// ======================================================================
// Script %TO Tokens
// ======================================================================

// ======================================================================
// Script %DI Tokens
// ======================================================================

// ======================================================================
// Script %DF Tokens
// ======================================================================

// ======================================================================
// handleBranch<n> Functions 
// ======================================================================

int c_newbie_melee_combat_handleBranch1 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You did well. I wish I could hire you on full time. The mayor won't give me the budget for that, though. Ah well, I'll find a way somehow. Probably by using warriors such as yourself whenever possible.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I'm glad I could help.
	if (response == "s_13")
	{
		//-- [NOTE] 
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			//-- NPC: Thank you.
			string_id message = new string_id (c_stringFile, "s_14");
			utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int c_newbie_melee_combat_handleBranch3 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You did well. I wish I could hire you on full time. The mayor won't give me the budget for that, though. Ah well, I'll find a way somehow. Mostly by using warriors such as yourself whenever possible, I'd imagine.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I'm glad I could help.
	if (response == "s_20")
	{
		//-- [NOTE] 
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			c_newbie_melee_combat_action_sendToMayor (player, npc);

			//-- NPC: Thank you.
			string_id message = new string_id (c_stringFile, "s_21");
			utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int c_newbie_melee_combat_handleBranch6 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Now that those muggers have been dealt with, we need to go after their leader, Vaigon Shinn. Go to his hideout, fight your way through his guards, and take him down.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I'm on my way. I'll take down Vaigon Shinn.
	if (response == "s_58")
	{
		//-- [NOTE] 
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			c_newbie_melee_combat_action_grantVaigonShin (player, npc);

			//-- NPC: Excellent. This is my last task for you. Fight well.
			string_id message = new string_id (c_stringFile, "s_59");
			utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int c_newbie_melee_combat_handleBranch9 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I'm glad those battle droids have been disabled. Being so unstable could have led to them becoming dangerous. Did anything else happen out there? You seemed to take longer on this than I had expected?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: No, nothing. Just the droids. What else could happen?
	if (response == "s_96")
	{
		doAnimationAction (player, "nervous");

		//-- [NOTE] 
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "shrug_shoulders");

			//-- NPC: Hmm. Okay, a local band of muggers lead by Vaigon Shinn has been stealing ID cards from people. Recover those stolen cards from Shinn's muggers.
			string_id message = new string_id (c_stringFile, "s_97");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I'll get those ID cards back.
			boolean hasResponse0 = false;
			if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_99");

				utils.setScriptVar (player, "conversation.c_newbie_melee_combat.branchId", 10);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int c_newbie_melee_combat_handleBranch10 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Hmm. Okay, a local band of muggers lead by Vaigon Shinn has been stealing ID cards from people. Recover those stolen cards from Shinn's muggers.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I'll get those ID cards back.
	if (response == "s_99")
	{
		//-- [NOTE] 
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			c_newbie_melee_combat_action_grantMuggers (player, npc);

			//-- NPC: Thank you. Now go to it.
			string_id message = new string_id (c_stringFile, "s_101");
			utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int c_newbie_melee_combat_handleBranch12 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Have you disabled those battle droids yet? What's holding things up?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Er. Something came up. I'll be finished soon.
	if (response == "s_93")
	{
		//-- [NOTE] 
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			//-- NPC: Good. Please let me know when you're done, because there's a rumor that a crew of muggers is stealing ID cards from citizens of Mos Eisley. I think we'll need to do something about that.
			string_id message = new string_id (c_stringFile, "s_95");
			utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int c_newbie_melee_combat_handleBranch15 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I've received word of some battle droids that landed in an escape pod near Mos Eisley. Their behavior is erratic. Go disable them before they harm someone.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Battle droids on Tatooine? Nothing I can't handle.
	if (response == "s_45")
	{
		//-- [NOTE] 
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			c_newbie_melee_combat_action_grantCriminals (player, npc);

			//-- NPC: That's right. Go take care of them.
			string_id message = new string_id (c_stringFile, "s_46");
			utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int c_newbie_melee_combat_handleBranch18 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Thank you for recovering those moisture harvester keypads. Next up, go to the camp of gunrunners outside of Mos Eisley and convince them to peddle their weapons elsewhere.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I'll run off those gunrunners.
	if (response == "s_43")
	{
		//-- [NOTE] 
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			c_newbie_melee_combat_action_grantGunrunners (player, npc);

			//-- NPC: Hey, that's kind of catchy. Run off those gunrunners. I like it.
			string_id message = new string_id (c_stringFile, "s_44");
			utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int c_newbie_melee_combat_handleBranch22 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: That should quell the desert swoopers for a while. Next, go deal with a camp of scavengers. Human vermin, if you ask me.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I'm on it.
	if (response == "s_67")
	{
		//-- [NOTE] 
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			c_newbie_melee_combat_action_grantWaterThief (player, npc);

			//-- NPC: And I'm glad you are.
			string_id message = new string_id (c_stringFile, "s_69");
			utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int c_newbie_melee_combat_handleBranch25 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: So the mayor finally consented to send me some assistance, did he? Better late than never. There's no point in wasting time. Let's take down some of the thugs that plague our city.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What do you want me to do?
	if (response == "s_81")
	{
		//-- [NOTE] 
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			//-- NPC: To get started, there's a camp of desert swoopers just outside of town. Go defeat some of the swoopers.
			string_id message = new string_id (c_stringFile, "s_83");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Desert swoopers? They don't stand a chance.
			boolean hasResponse0 = false;
			if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_85");

				utils.setScriptVar (player, "conversation.c_newbie_melee_combat.branchId", 26);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int c_newbie_melee_combat_handleBranch26 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: To get started, there's a camp of desert swoopers just outside of town. Go defeat some of the swoopers.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Desert swoopers? They don't stand a chance.
	if (response == "s_85")
	{
		//-- [NOTE] 
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "clap_rousing");

			c_newbie_melee_combat_action_grantSwoopers (player, npc);

			//-- NPC: Indeed they don't. Go to it.
			string_id message = new string_id (c_stringFile, "s_87");
			utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

// ======================================================================
// User Script Triggers
// ======================================================================

trigger OnInitialize ()
{
	if ((!isMob (self)) || (isPlayer (self)))
		detachScript(self, "conversation.c_newbie_melee_combat");
	setInvulnerable (self, true);
	setCondition (self, CONDITION_CONVERSABLE);
	setCondition (self, CONDITION_INTERESTING);
	
	ai_lib.setDefaultCalmBehavior(self, ai_lib.BEHAVIOR_SENTINEL);
	
	setName(self, new string_id( "npc_name", "peawp_rdawc" ));
	return SCRIPT_CONTINUE;
}

trigger OnAttach ()
{
	setInvulnerable (self, true);
	setCondition (self, CONDITION_CONVERSABLE);
	setCondition (self, CONDITION_INTERESTING);
	
	ai_lib.setDefaultCalmBehavior(self, ai_lib.BEHAVIOR_SENTINEL);
	
	setName(self, new string_id( "npc_name", "peawp_rdawc" ));
	return SCRIPT_CONTINUE;
}

trigger OnObjectMenuRequest (obj_id player, menu_info menuInfo)
{
	int menu = menuInfo.addRootMenu (menu_info_types.CONVERSE_START, null);
	menu_info_data menuInfoData = menuInfo.getMenuItemById (menu);
	menuInfoData.setServerNotify (false);
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnIncapacitated (obj_id killer)
{
	clearCondition (self, CONDITION_CONVERSABLE);
	detachScript (self, "conversation.c_newbie_melee_combat");

	return SCRIPT_CONTINUE;
}

// ======================================================================
// Script Triggers
// ======================================================================

//-- This function should move to base_class.java
boolean npcStartConversation(obj_id player, obj_id npc, string convoName, string_id greetingId, prose_package greetingProse, string_id[] responses)
{
	Object[] objects = new Object[responses.length];
	System.arraycopy(responses, 0, objects, 0, responses.length);
	return npcStartConversation(player, npc, convoName, greetingId, greetingProse, objects);
}

// ----------------------------------------------------------------------

trigger OnStartNpcConversation (obj_id player)
{
	obj_id npc = self;

	if (ai_lib.isInCombat (npc) || ai_lib.isInCombat (player))
		return SCRIPT_OVERRIDE;

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_completedPeawpQuests (player, npc))
	{
		doAnimationAction (npc, "greet");

		doAnimationAction (player, "greet");

		//-- NPC: You did well. I wish I could hire you on full time. The mayor won't give me the budget for that, though. Ah well, I'll find a way somehow. Probably by using warriors such as yourself whenever possible.
		string_id message = new string_id (c_stringFile, "s_204");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I'm glad I could help.
		boolean hasResponse0 = false;
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_13");

			utils.setScriptVar (player, "conversation.c_newbie_melee_combat.branchId", 1);

			npcStartConversation (player, npc, "c_newbie_melee_combat", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_returningViagonShinn (player, npc))
	{
		//-- NPC: You did well. I wish I could hire you on full time. The mayor won't give me the budget for that, though. Ah well, I'll find a way somehow. Mostly by using warriors such as yourself whenever possible, I'd imagine.
		string_id message = new string_id (c_stringFile, "s_19");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I'm glad I could help.
		boolean hasResponse0 = false;
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_20");

			utils.setScriptVar (player, "conversation.c_newbie_melee_combat.branchId", 3);

			npcStartConversation (player, npc, "c_newbie_melee_combat", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_onVaigonShinn (player, npc))
	{
		//-- NPC:  Go to Vaigon Shinn's hideout, fight your way through his guards, and take him down.
		string_id message = new string_id (c_stringFile, "s_48");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_returningMuggers (player, npc))
	{
		c_newbie_melee_combat_action_endMuggers (player, npc);

		//-- NPC: Now that those muggers have been dealt with, we need to go after their leader, Vaigon Shinn. Go to his hideout, fight your way through his guards, and take him down.
		string_id message = new string_id (c_stringFile, "s_47");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I'm on my way. I'll take down Vaigon Shinn.
		boolean hasResponse0 = false;
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_58");

			utils.setScriptVar (player, "conversation.c_newbie_melee_combat.branchId", 6);

			npcStartConversation (player, npc, "c_newbie_melee_combat", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_onMuggers (player, npc))
	{
		//-- NPC: A local band of muggers lead by Vaigon Shinn has been stealing ID cards from people. Recover those stolen cards from Shinn's muggers.
		string_id message = new string_id (c_stringFile, "s_49");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_returningCriminals (player, npc))
	{
		c_newbie_melee_combat_action_endCriminals (player, npc);

		//-- NPC: I'm glad those battle droids have been disabled. Being so unstable could have led to them becoming dangerous. Did anything else happen out there? You seemed to take longer on this than I had expected?
		string_id message = new string_id (c_stringFile, "s_50");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: No, nothing. Just the droids. What else could happen?
		boolean hasResponse0 = false;
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_96");

			utils.setScriptVar (player, "conversation.c_newbie_melee_combat.branchId", 9);

			npcStartConversation (player, npc, "c_newbie_melee_combat", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_onCriminals (player, npc))
	{
		//-- NPC: Have you disabled those battle droids yet? What's holding things up?
		string_id message = new string_id (c_stringFile, "s_51");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Er. Something came up. I'll be finished soon.
		boolean hasResponse0 = false;
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_93");

			utils.setScriptVar (player, "conversation.c_newbie_melee_combat.branchId", 12);

			npcStartConversation (player, npc, "c_newbie_melee_combat", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_onDroids (player, npc))
	{
		//-- NPC: Some battle droids landed in an escape pod near Mos Eisley. They are behaving erratically. Go disable them before they harm someone.
		string_id message = new string_id (c_stringFile, "s_53");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_returningGunrunners (player, npc))
	{
		c_newbie_melee_combat_action_endGunrunners (player, npc);

		//-- NPC: I've received word of some battle droids that landed in an escape pod near Mos Eisley. Their behavior is erratic. Go disable them before they harm someone.
		string_id message = new string_id (c_stringFile, "s_29");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Battle droids on Tatooine? Nothing I can't handle.
		boolean hasResponse0 = false;
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_45");

			utils.setScriptVar (player, "conversation.c_newbie_melee_combat.branchId", 15);

			npcStartConversation (player, npc, "c_newbie_melee_combat", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_onGunrunners (player, npc))
	{
		//-- NPC: Go to the camp of gunrunners outside of Mos Eisley and convince them to peddle their weapons elsewhere.
		string_id message = new string_id (c_stringFile, "s_38");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_returningWaterThief (player, npc))
	{
		c_newbie_melee_combat_action_endWaterThief (player, npc);

		//-- NPC: Thank you for recovering those moisture harvester keypads. Next up, go to the camp of gunrunners outside of Mos Eisley and convince them to peddle their weapons elsewhere.
		string_id message = new string_id (c_stringFile, "s_39");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I'll run off those gunrunners.
		boolean hasResponse0 = false;
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_43");

			utils.setScriptVar (player, "conversation.c_newbie_melee_combat.branchId", 18);

			npcStartConversation (player, npc, "c_newbie_melee_combat", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_onWaterThief (player, npc))
	{
		//-- NPC: Some water thieves stole the keypads off of some moisture harvesters. Go get those keypads back.
		string_id message = new string_id (c_stringFile, "s_40");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_onScavengers (player, npc))
	{
		//-- NPC: Go deal with a camp of scavengers. Nothing more than human vermin, if you ask me.
		string_id message = new string_id (c_stringFile, "s_63");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_returningSwoopers (player, npc))
	{
		c_newbie_melee_combat_action_endSwoopers (player, npc);

		//-- NPC: That should quell the desert swoopers for a while. Next, go deal with a camp of scavengers. Human vermin, if you ask me.
		string_id message = new string_id (c_stringFile, "s_65");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I'm on it.
		boolean hasResponse0 = false;
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_67");

			utils.setScriptVar (player, "conversation.c_newbie_melee_combat.branchId", 22);

			npcStartConversation (player, npc, "c_newbie_melee_combat", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_onSwoopers (player, npc))
	{
		//-- NPC: Keep at it. If we can reduce the population of these low-life thugs, the citizens of Mos Eisley will be able to walk the streets more safely.
		string_id message = new string_id (c_stringFile, "s_205");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition_sentByMayor (player, npc))
	{
		c_newbie_melee_combat_action_endFromMayor (player, npc);

		//-- NPC: So the mayor finally consented to send me some assistance, did he? Better late than never. There's no point in wasting time. Let's take down some of the thugs that plague our city.
		string_id message = new string_id (c_stringFile, "s_206");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: What do you want me to do?
		boolean hasResponse0 = false;
		if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_81");

			utils.setScriptVar (player, "conversation.c_newbie_melee_combat.branchId", 25);

			npcStartConversation (player, npc, "c_newbie_melee_combat", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (c_newbie_melee_combat_condition__defaultCondition (player, npc))
	{
		//-- NPC: It's getting out of hand. At least Jabba is smart enough to leave most people alone most of the time, but most of these other thugs have no restraint. Something should be done.
		string_id message = new string_id (c_stringFile, "s_64");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	chat.chat (npc, "Error:  All conditions for OnStartNpcConversation were false.");

	return SCRIPT_CONTINUE;
}

// ----------------------------------------------------------------------

trigger OnNpcConversationResponse (string conversationId, obj_id player, string_id response)
{
	if (conversationId != "c_newbie_melee_combat")
		return SCRIPT_CONTINUE;

	obj_id npc = self;

	int branchId = utils.getIntScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

	if (branchId == 1 && c_newbie_melee_combat_handleBranch1 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 3 && c_newbie_melee_combat_handleBranch3 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 6 && c_newbie_melee_combat_handleBranch6 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 9 && c_newbie_melee_combat_handleBranch9 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 10 && c_newbie_melee_combat_handleBranch10 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 12 && c_newbie_melee_combat_handleBranch12 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 15 && c_newbie_melee_combat_handleBranch15 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 18 && c_newbie_melee_combat_handleBranch18 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 22 && c_newbie_melee_combat_handleBranch22 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 25 && c_newbie_melee_combat_handleBranch25 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 26 && c_newbie_melee_combat_handleBranch26 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	chat.chat (npc, "Error:  Fell through all branches and responses for OnNpcConversationResponse.");

	utils.removeScriptVar (player, "conversation.c_newbie_melee_combat.branchId");

	return SCRIPT_CONTINUE;
}

// ======================================================================

