// ======================================================================
//
// som_storm_lord_jural.script
// Copyright 2004, Sony Online Entertainment
// All Rights Reserved.
//
// Created with SwgConversationEditor 1.36 - DO NOT EDIT THIS AUTO-GENERATED FILE!
//
// ======================================================================

// ======================================================================
// Library Includes
// ======================================================================

include library.ai_lib;
include library.chat;
include library.groundquests;
include library.utils;

// ======================================================================
// Script Constants
// ======================================================================

string c_stringFile = "conversation/som_storm_lord_jural";

// ======================================================================
// Script Conditions
// ======================================================================

boolean som_storm_lord_jural_condition__defaultCondition (obj_id player, obj_id npc)
{
	return true;
}

// ----------------------------------------------------------------------

boolean som_storm_lord_jural_condition_isOnTaskOne (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_storm_lord", "storm_lord_one");
}

// ----------------------------------------------------------------------

boolean som_storm_lord_jural_condition_finishedTaskOne (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_storm_lord", "storm_lord_two");
}

// ----------------------------------------------------------------------

boolean som_storm_lord_jural_condition_isOnTaskTwo (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_storm_lord", "storm_lord_three");
}

// ----------------------------------------------------------------------

boolean som_storm_lord_jural_condition_finishedTaskTwo (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_storm_lord", "storm_lord_four");
}

// ----------------------------------------------------------------------

boolean som_storm_lord_jural_condition_isOnTaskThree (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_storm_lord", "storm_lord_five");
}

// ----------------------------------------------------------------------

boolean som_storm_lord_jural_condition_finishedTaskThree (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_storm_lord", "storm_lord_six");
}

// ----------------------------------------------------------------------

boolean som_storm_lord_jural_condition_isOnTaskFour (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_storm_lord", "storm_lord_seven");
}

// ----------------------------------------------------------------------

boolean som_storm_lord_jural_condition_finishedTaskFour (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_storm_lord", "storm_lord_eight");
}

// ----------------------------------------------------------------------

boolean som_storm_lord_jural_condition_hasWonMission (obj_id player, obj_id npc)
{
	return groundquests.hasCompletedQuest(player, "som_storm_lord");
}

// ======================================================================
// Script Actions
// ======================================================================

void som_storm_lord_jural_action_startMission (obj_id player, obj_id npc)
{
	groundquests.grantQuest(player, "som_storm_lord");
}

// ----------------------------------------------------------------------

void som_storm_lord_jural_action_sendFirstSignal (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "storm_lord_minions_defeated");
}

// ----------------------------------------------------------------------

void som_storm_lord_jural_action_sendSecondSignal (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "storm_lord_zealots_defeated");
}

// ----------------------------------------------------------------------

void som_storm_lord_jural_action_sendThirdSignal (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "storm_lord_prophet_defeated");
}

// ----------------------------------------------------------------------

void som_storm_lord_jural_action_sendFourthSignal (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "storm_lord_defeated");
}

// ======================================================================
// Script %TO Tokens
// ======================================================================

// ======================================================================
// Script %DI Tokens
// ======================================================================

// ======================================================================
// Script %DF Tokens
// ======================================================================

// ======================================================================
// handleBranch<n> Functions 
// ======================================================================

int som_storm_lord_jural_handleBranch2 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You did it! Talper is already feeling better. He is still extremely weak and it will take him a while to recover, but I can tell he is going to make it. You are very brave to help us out like this.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Think nothing of it.
	if (response == "s_63")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "manipulate_medium");

			som_storm_lord_jural_action_sendFourthSignal (player, npc);

			//-- NPC: No, it was something. Please, take this as payment for saving the life of my brother. Thank you again.
			string_id message = new string_id (c_stringFile, "s_64");
			utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch5 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I was very worried about you. I know the Prophet is no ordinary thug. The good news is that Talper actually opened his eyes for a little while...that is how I knew you had won.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Yeah, I beat the Prophet. So is Talper going to be alright?
	if (response == "s_56")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "shrug_hands");

			//-- NPC: I don't know. He still has a fever and hasn't opened his eyes since that one time. I am afraid that there is only one way to be certain. I must ask you to kill the Storm Lord.
			string_id message = new string_id (c_stringFile, "s_57");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I figured it would come to this. Where is he?
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I am afraid that I have some other business to attend to first.
			boolean hasResponse1 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_58");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_59");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 6);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch6 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I don't know. He still has a fever and hasn't opened his eyes since that one time. I am afraid that there is only one way to be certain. I must ask you to kill the Storm Lord.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I figured it would come to this. Where is he?
	if (response == "s_58")
	{
		doAnimationAction (player, "nod");

		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "pound_fist_palm");

			som_storm_lord_jural_action_sendThirdSignal (player, npc);

			//-- NPC: He never leaves the temple at the top of the mountain anymore. I am sure that all your prior efforts have weakened him. Now is the perfect time to strike, before he can regain any strength. Good luck to you.
			string_id message = new string_id (c_stringFile, "s_60");
			utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I am afraid that I have some other business to attend to first.
	if (response == "s_59")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			//-- NPC: I understand. I think Talper can hold on for a while longer.
			string_id message = new string_id (c_stringFile, "s_61");
			utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch10 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I could hear the sounds of the battle all the way down here. I was afraid that you wouldn't make it back.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Don't worry about me. I am no stranger to a fight.
	if (response == "s_45")
	{
		doAnimationAction (player, "pose_proudly");

		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "pound_fist_palm");

			//-- NPC: Well, the good news is that Talper looks a little better today. I think our plan is working. The problem is that we are just not doing enough...which got me to thinking: if the zealots help strengthen the Storm Lord, then maybe the more fanatic the worshipper is, the more powerful he becomes.
			string_id message = new string_id (c_stringFile, "s_46");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: You want me to take out some more zealots?
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_47");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 11);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch11 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Well, the good news is that Talper looks a little better today. I think our plan is working. The problem is that we are just not doing enough...which got me to thinking: if the zealots help strengthen the Storm Lord, then maybe the more fanatic the worshipper is, the more powerful he becomes.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: You want me to take out some more zealots?
	if (response == "s_47")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "shake_head_no");

			//-- NPC: No. I was thinking of someone who is more fanatical then all of the zealots combined -- the Prophet.
			string_id message = new string_id (c_stringFile, "s_48");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: He has a prophet?
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_49");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 12);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch12 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: No. I was thinking of someone who is more fanatical then all of the zealots combined -- the Prophet.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: He has a prophet?
	if (response == "s_49")
	{
		doAnimationAction (player, "rub_chin_thoughtful");

		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "explain");

			//-- NPC: Yes. Dr. Namdaot no longer directly speaks to his followers. Instead, he only talks to his most devoted follower, who then preaches to all the others. I think if you were to defeat the Prophet, the Storm Lord would be so weak that he couldn't maintain control over Talper's sickness.
			string_id message = new string_id (c_stringFile, "s_50");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Once more into the brink...
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I wish I could help you. But I just can't right now.
			boolean hasResponse1 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_51");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_52");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 13);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch13 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Yes. Dr. Namdaot no longer directly speaks to his followers. Instead, he only talks to his most devoted follower, who then preaches to all the others. I think if you were to defeat the Prophet, the Storm Lord would be so weak that he couldn't maintain control over Talper's sickness.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Once more into the brink...
	if (response == "s_51")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "slow_down");

			som_storm_lord_jural_action_sendSecondSignal (player, npc);

			//-- NPC: Now, I must warn you. The Prophet is nearly as strong as Dr. Namdaot is and he will fight to the death to protect his master. This is no small challenge that I have asked of you. Good luck.
			string_id message = new string_id (c_stringFile, "s_54");
			utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I wish I could help you. But I just can't right now.
	if (response == "s_52")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "sigh_deeply");

			//-- NPC: I knew it was a long shot asking you in the first place. It is okay. Thank you for what you have already done.
			string_id message = new string_id (c_stringFile, "s_53");
			utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch17 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You are back! How did your mission go?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: It has been taken care of. How is your brother?
	if (response == "s_37")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "sigh_deeply");

			//-- NPC: There hasn't been any change in his condition. Maybe the minions just are not powerful enough to have any effect on Dr. Namdaot's strength. I think we are going to have to aim higher.
			string_id message = new string_id (c_stringFile, "s_38");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I am listening.
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_40");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 18);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch18 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: There hasn't been any change in his condition. Maybe the minions just are not powerful enough to have any effect on Dr. Namdaot's strength. I think we are going to have to aim higher.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I am listening.
	if (response == "s_40")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "explain");

			//-- NPC: Not all of the Storm Lord's original worshippers died. Some of them took on traits that are very similar to his. I call them zealots. They are fanatic in their worship of the doctor. Maybe their strength adds to his somehow. If they were eliminated, maybe Talper would get better.
			string_id message = new string_id (c_stringFile, "s_42");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I will hunt down these zealots for you.
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I am afraid I have done all I can for now.
			boolean hasResponse1 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_44");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_68");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 19);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch19 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Not all of the Storm Lord's original worshippers died. Some of them took on traits that are very similar to his. I call them zealots. They are fanatic in their worship of the doctor. Maybe their strength adds to his somehow. If they were eliminated, maybe Talper would get better.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I will hunt down these zealots for you.
	if (response == "s_44")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "implore");

			som_storm_lord_jural_action_sendFirstSignal (player, npc);

			//-- NPC: Be careful. When I said they took on the traits of the Storm Lord, I meant it. I have seen them do some very strange things.
			string_id message = new string_id (c_stringFile, "s_66");
			utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I am afraid I have done all I can for now.
	if (response == "s_68")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			//-- NPC: Okay. Thank you for trying.
			string_id message = new string_id (c_stringFile, "s_70");
			utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch23 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Please don't tell me that you are on your way to join up with the Dr. Namdaot...well, I suppose he calls himself the Storm Lord now.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I am afraid I don't know what you are talking about.
	if (response == "s_76")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "sweat");

			//-- NPC: Whew! Finally, someone with some sense. You shouldn't travel any further up this road. That madman and his followers have almost completely taken over the whole valley. The only people they even tolerate are this group of scavengers who pay occasional homage to the Storm Lord.
			string_id message = new string_id (c_stringFile, "s_78");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Who or what is this Storm Lord you keep mentioning?
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_80");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 24);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch24 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Whew! Finally, someone with some sense. You shouldn't travel any further up this road. That madman and his followers have almost completely taken over the whole valley. The only people they even tolerate are this group of scavengers who pay occasional homage to the Storm Lord.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Who or what is this Storm Lord you keep mentioning?
	if (response == "s_80")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "point_to_self");

			//-- NPC: I am sorry. I completely forgot my manners. I am Jural, a reporter for the Corellian Times...perhaps you have read my column on galactic exploration? No? Anyways, I was out here reporting on Dr. Namdaot's excavation of the temple ruins up the way.
			string_id message = new string_id (c_stringFile, "s_82");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: There are temple ruins up there?
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_84");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 25);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch25 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I am sorry. I completely forgot my manners. I am Jural, a reporter for the Corellian Times...perhaps you have read my column on galactic exploration? No? Anyways, I was out here reporting on Dr. Namdaot's excavation of the temple ruins up the way.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: There are temple ruins up there?
	if (response == "s_84")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "nod");

			//-- NPC: Yes, a very large complex of them. Dr. Namdaot was uncovering some amazing finds. It would seem that those ruins were once the main temple on Mustafar. He was on the trail of something big when the change occurred. He said that he had found evidence that a powerful Jedi artifact was once housed in the temple and that it might have something to do with why Mustafar is like it is today.
			string_id message = new string_id (c_stringFile, "s_86");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: You said that a change occurred?
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_88");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 26);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch26 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Yes, a very large complex of them. Dr. Namdaot was uncovering some amazing finds. It would seem that those ruins were once the main temple on Mustafar. He was on the trail of something big when the change occurred. He said that he had found evidence that a powerful Jedi artifact was once housed in the temple and that it might have something to do with why Mustafar is like it is today.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: You said that a change occurred?
	if (response == "s_88")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "whisper");

			//-- NPC: It was subtle at first, barely noticeable. Sometimes you would get the feeling someone was watching you even though you were all by yourself. Other times you would hear...well, I could swear they were voices, but they were too low to understand. Everyone was feeling it, and Dr. Namdaot, the worst of all...
			string_id message = new string_id (c_stringFile, "s_90");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Go on.
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_92");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 27);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch27 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: It was subtle at first, barely noticeable. Sometimes you would get the feeling someone was watching you even though you were all by yourself. Other times you would hear...well, I could swear they were voices, but they were too low to understand. Everyone was feeling it, and Dr. Namdaot, the worst of all...

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Go on.
	if (response == "s_92")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			//-- NPC: Dr. Namdaot started to talk back to the voices. At first, when we would ask him about it, he would just chuckle and say that it was nothing. But after a while, we would catch him having conversations with nothing. When we asked him about those, he would get very angry and tell us to mind our own business. Then one day, he just walked out of base camp and went to the summit temple ruins.
			string_id message = new string_id (c_stringFile, "s_94");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Sounds like the good doctor just snapped.
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_96");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 28);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch28 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Dr. Namdaot started to talk back to the voices. At first, when we would ask him about it, he would just chuckle and say that it was nothing. But after a while, we would catch him having conversations with nothing. When we asked him about those, he would get very angry and tell us to mind our own business. Then one day, he just walked out of base camp and went to the summit temple ruins.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Sounds like the good doctor just snapped.
	if (response == "s_96")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "explain");

			//-- NPC: Some of us thought that too. But what happened when he came back left no doubt in my mind that those voices and strange feelings were real. The doctor was gone for a few days, and then one morning, just showed back up...but he was different. He declared his divinity to the whole camp and ordered everyone to worship him as the Storm Lord.
			string_id message = new string_id (c_stringFile, "s_98");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I was right. The doctor lost his mind.
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_100");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 29);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch29 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Some of us thought that too. But what happened when he came back left no doubt in my mind that those voices and strange feelings were real. The doctor was gone for a few days, and then one morning, just showed back up...but he was different. He declared his divinity to the whole camp and ordered everyone to worship him as the Storm Lord.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I was right. The doctor lost his mind.
	if (response == "s_100")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "shush");

			//-- NPC: Hush. Let me continue. After Dr. Namdaot made this proclamation, the sky darkened, and lightning began pounding the ground around the camp. The members of the team who were feeling the effects of that place the worst immediately dropped to their knees and started praying to him. It took others a little longer to come around, but eventually, everyone was enthralled by him. Everyone but me and my brother, Talper.
			string_id message = new string_id (c_stringFile, "s_102");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I was going to ask about him. He doesn't look so good.
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_104");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 30);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch30 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Hush. Let me continue. After Dr. Namdaot made this proclamation, the sky darkened, and lightning began pounding the ground around the camp. The members of the team who were feeling the effects of that place the worst immediately dropped to their knees and started praying to him. It took others a little longer to come around, but eventually, everyone was enthralled by him. Everyone but me and my brother, Talper.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I was going to ask about him. He doesn't look so good.
	if (response == "s_104")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "sigh_deeply");

			//-- NPC: Yes, I fear he is dying. While everyone else was worshipping this Storm Lord, Talper yelled at him...calling him a fraud. Dr. Namdaot looked at my brother with such venom and called him an unbeliever. Then he did something.
			string_id message = new string_id (c_stringFile, "s_106");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: What do you mean...something?
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_108");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 31);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch31 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Yes, I fear he is dying. While everyone else was worshipping this Storm Lord, Talper yelled at him...calling him a fraud. Dr. Namdaot looked at my brother with such venom and called him an unbeliever. Then he did something.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What do you mean...something?
	if (response == "s_108")
	{
		doAnimationAction (player, "huh");

		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "shrug_hands");

			//-- NPC: I don't really know. One moment, my brother was facing down Dr. Namdaot, and the next, he was lying on the ground, writhing in pain. All the doctor did was wave his hand at him. Since then, Talper has been steadily getting worse. I don't think he will last very much longer and, as far as I can tell, there is nothing wrong with him. I can only assume that it is the doing of this Storm Lord.
			string_id message = new string_id (c_stringFile, "s_110");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Is there anything that I can do?
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_112");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 32);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch32 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I don't really know. One moment, my brother was facing down Dr. Namdaot, and the next, he was lying on the ground, writhing in pain. All the doctor did was wave his hand at him. Since then, Talper has been steadily getting worse. I don't think he will last very much longer and, as far as I can tell, there is nothing wrong with him. I can only assume that it is the doing of this Storm Lord.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Is there anything that I can do?
	if (response == "s_112")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "rub_chin_thoughtful");

			//-- NPC: Maybe. Just maybe. I have been paying close attention to the goings-on in the camp and think I have an answer. The doctor immediately began sending his worshippers out to gather up more followers and I was wondering why. Well, it would seem that none of them survive very long. Almost all of the group of original followers are dead. I have seen their bodies...they look drained.
			string_id message = new string_id (c_stringFile, "s_114");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I am not following you.
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_116");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 33);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch33 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Maybe. Just maybe. I have been paying close attention to the goings-on in the camp and think I have an answer. The doctor immediately began sending his worshippers out to gather up more followers and I was wondering why. Well, it would seem that none of them survive very long. Almost all of the group of original followers are dead. I have seen their bodies...they look drained.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I am not following you.
	if (response == "s_116")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "explain");

			//-- NPC: I think that the doctor is doing something to his followers that drains their life away from them. Perhaps this is the source of his power. If he didn't have so many people following him, maybe he would lose strength, and he would lose power over my brother. I know it is a long shot, but it is the only thing that I can think of.
			string_id message = new string_id (c_stringFile, "s_118");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I will see what I can do about taking out his followers.
			boolean hasResponse0 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I wish I could help you, but I just cannot.
			boolean hasResponse1 = false;
			if (som_storm_lord_jural_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_120");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_124");

				utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 34);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_storm_lord_jural_handleBranch34 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I think that the doctor is doing something to his followers that drains their life away from them. Perhaps this is the source of his power. If he didn't have so many people following him, maybe he would lose strength, and he would lose power over my brother. I know it is a long shot, but it is the only thing that I can think of.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I will see what I can do about taking out his followers.
	if (response == "s_120")
	{
		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "nod_head_multiple");

			som_storm_lord_jural_action_startMission (player, npc);

			//-- NPC: Thank you. Try taking out some of his minions. I am sure that if he loses enough of them, he will become weaker.
			string_id message = new string_id (c_stringFile, "s_122");
			utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I wish I could help you, but I just cannot.
	if (response == "s_124")
	{
		doAnimationAction (player, "stop");

		//-- [NOTE] 
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "sigh_deeply");

			//-- NPC: I understand. Thank you for listening to my plight. Safe journey to you.
			string_id message = new string_id (c_stringFile, "s_126");
			utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

// ======================================================================
// User Script Triggers
// ======================================================================

trigger OnInitialize ()
{
	if ((!isMob (self)) || (isPlayer (self)))
		detachScript(self, "conversation.som_storm_lord_jural");

	setCondition (self, CONDITION_CONVERSABLE);
	setInvulnerable (self, true);
	setCondition( self, CONDITION_INTERESTING );
	setName (self, "Jural");

	return SCRIPT_CONTINUE;
}

trigger OnAttach ()
{
	setCondition (self, CONDITION_CONVERSABLE);
	setInvulnerable (self, true);
	setCondition( self, CONDITION_INTERESTING );
	setName (self, "Jural");

	return SCRIPT_CONTINUE;
}

trigger OnObjectMenuRequest (obj_id player, menu_info menuInfo)
{
	int menu = menuInfo.addRootMenu (menu_info_types.CONVERSE_START, null);
	menu_info_data menuInfoData = menuInfo.getMenuItemById (menu);
	menuInfoData.setServerNotify (false);
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnIncapacitated (obj_id killer)
{
	clearCondition (self, CONDITION_CONVERSABLE);
	detachScript (self, "conversation.som_storm_lord_jural");

	return SCRIPT_CONTINUE;
}

// ======================================================================
// Script Triggers
// ======================================================================

//-- This function should move to base_class.java
boolean npcStartConversation(obj_id player, obj_id npc, string convoName, string_id greetingId, prose_package greetingProse, string_id[] responses)
{
	Object[] objects = new Object[responses.length];
	System.arraycopy(responses, 0, objects, 0, responses.length);
	return npcStartConversation(player, npc, convoName, greetingId, greetingProse, objects);
}

// ----------------------------------------------------------------------

trigger OnStartNpcConversation (obj_id player)
{
	obj_id npc = self;

	if (ai_lib.isInCombat (npc) || ai_lib.isInCombat (player))
		return SCRIPT_OVERRIDE;

	//-- [NOTE] 
	if (som_storm_lord_jural_condition_hasWonMission (player, npc))
	{
		doAnimationAction (npc, "greet");

		//-- NPC: Hello again. Talper is doing much better. He is still very weak, but he is going to make it. And we owe it all to you. Thank you so much.
		string_id message = new string_id (c_stringFile, "s_62");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_storm_lord_jural_condition_finishedTaskFour (player, npc))
	{
		doAnimationAction (npc, "offer_affection");

		//-- NPC: You did it! Talper is already feeling better. He is still extremely weak and it will take him a while to recover, but I can tell he is going to make it. You are very brave to help us out like this.
		string_id message = new string_id (c_stringFile, "s_55");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Think nothing of it.
		boolean hasResponse0 = false;
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_63");

			utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 2);

			npcStartConversation (player, npc, "som_storm_lord_jural", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_storm_lord_jural_condition_isOnTaskFour (player, npc))
	{
		doAnimationAction (npc, "whisper");

		//-- NPC: Talper is starting to get worse again. The Storm Lord must be defeated or he doesn't have much of a chance.
		string_id message = new string_id (c_stringFile, "s_8");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_storm_lord_jural_condition_finishedTaskThree (player, npc))
	{
		doAnimationAction (npc, "celebrate");

		//-- NPC: I was very worried about you. I know the Prophet is no ordinary thug. The good news is that Talper actually opened his eyes for a little while...that is how I knew you had won.
		string_id message = new string_id (c_stringFile, "s_10");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Yeah, I beat the Prophet. So is Talper going to be alright?
		boolean hasResponse0 = false;
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_56");

			utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 5);

			npcStartConversation (player, npc, "som_storm_lord_jural", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_storm_lord_jural_condition_isOnTaskThree (player, npc))
	{
		doAnimationAction (npc, "hug_self");

		//-- NPC: Talper is feeling better, but I think that just gained some time. He is still very sick.
		string_id message = new string_id (c_stringFile, "s_18");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_storm_lord_jural_condition_finishedTaskTwo (player, npc))
	{
		doAnimationAction (npc, "kisscheek");

		//-- NPC: I could hear the sounds of the battle all the way down here. I was afraid that you wouldn't make it back.
		string_id message = new string_id (c_stringFile, "s_20");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Don't worry about me. I am no stranger to a fight.
		boolean hasResponse0 = false;
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_45");

			utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 10);

			npcStartConversation (player, npc, "som_storm_lord_jural", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_storm_lord_jural_condition_isOnTaskTwo (player, npc))
	{
		doAnimationAction (npc, "weeping");

		//-- NPC: Talper is fading fast. He is strong, but I don't think he can hold out for much longer.
		string_id message = new string_id (c_stringFile, "s_32");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_storm_lord_jural_condition_finishedTaskOne (player, npc))
	{
		doAnimationAction (npc, "beckon");

		//-- NPC: You are back! How did your mission go?
		string_id message = new string_id (c_stringFile, "s_34");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: It has been taken care of. How is your brother?
		boolean hasResponse0 = false;
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_37");

			utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 17);

			npcStartConversation (player, npc, "som_storm_lord_jural", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_storm_lord_jural_condition_isOnTaskOne (player, npc))
	{
		doAnimationAction (npc, "weeping");

		//-- NPC: Talper isn't doing so well. Unless you can defeat those minions of the so-called Storm Lord, he isn't going to make it.
		string_id message = new string_id (c_stringFile, "s_72");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_storm_lord_jural_condition__defaultCondition (player, npc))
	{
		doAnimationAction (npc, "shake_head_disgust");

		//-- NPC: Please don't tell me that you are on your way to join up with the Dr. Namdaot...well, I suppose he calls himself the Storm Lord now.
		string_id message = new string_id (c_stringFile, "s_74");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I am afraid I don't know what you are talking about.
		boolean hasResponse0 = false;
		if (som_storm_lord_jural_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_76");

			utils.setScriptVar (player, "conversation.som_storm_lord_jural.branchId", 23);

			npcStartConversation (player, npc, "som_storm_lord_jural", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	chat.chat (npc, "Error:  All conditions for OnStartNpcConversation were false.");

	return SCRIPT_CONTINUE;
}

// ----------------------------------------------------------------------

trigger OnNpcConversationResponse (string conversationId, obj_id player, string_id response)
{
	if (conversationId != "som_storm_lord_jural")
		return SCRIPT_CONTINUE;

	obj_id npc = self;

	int branchId = utils.getIntScriptVar (player, "conversation.som_storm_lord_jural.branchId");

	if (branchId == 2 && som_storm_lord_jural_handleBranch2 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 5 && som_storm_lord_jural_handleBranch5 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 6 && som_storm_lord_jural_handleBranch6 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 10 && som_storm_lord_jural_handleBranch10 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 11 && som_storm_lord_jural_handleBranch11 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 12 && som_storm_lord_jural_handleBranch12 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 13 && som_storm_lord_jural_handleBranch13 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 17 && som_storm_lord_jural_handleBranch17 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 18 && som_storm_lord_jural_handleBranch18 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 19 && som_storm_lord_jural_handleBranch19 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 23 && som_storm_lord_jural_handleBranch23 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 24 && som_storm_lord_jural_handleBranch24 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 25 && som_storm_lord_jural_handleBranch25 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 26 && som_storm_lord_jural_handleBranch26 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 27 && som_storm_lord_jural_handleBranch27 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 28 && som_storm_lord_jural_handleBranch28 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 29 && som_storm_lord_jural_handleBranch29 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 30 && som_storm_lord_jural_handleBranch30 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 31 && som_storm_lord_jural_handleBranch31 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 32 && som_storm_lord_jural_handleBranch32 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 33 && som_storm_lord_jural_handleBranch33 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 34 && som_storm_lord_jural_handleBranch34 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	chat.chat (npc, "Error:  Fell through all branches and responses for OnNpcConversationResponse.");

	utils.removeScriptVar (player, "conversation.som_storm_lord_jural.branchId");

	return SCRIPT_CONTINUE;
}

// ======================================================================

