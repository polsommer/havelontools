// ======================================================================
//
// ep3_kymayrr.script
// Copyright 2004, Sony Online Entertainment
// All Rights Reserved.
//
// Created with SwgConversationEditor 1.36 - DO NOT EDIT THIS AUTO-GENERATED FILE!
//
// ======================================================================

// ======================================================================
// Library Includes
// ======================================================================

include library.ai_lib;
include library.badge;
include library.chat;
include library.groundquests;
include library.space_quest;
include library.utils;

// ======================================================================
// Script Constants
// ======================================================================

string c_stringFile = "conversation/ep3_kymayrr";

// ======================================================================
// Script Conditions
// ======================================================================

boolean ep3_kymayrr_condition__defaultCondition (obj_id player, obj_id npc)
{
	return true;
}

// ----------------------------------------------------------------------

boolean ep3_kymayrr_condition_hasWonTrandoRadio (obj_id player, obj_id npc)
{
	return groundquests.hasCompletedQuest(player, "ep3_zhailaut_recover_trando_radio");
}

// ----------------------------------------------------------------------

boolean ep3_kymayrr_condition_hasWonAdjutantRecovery (obj_id player, obj_id npc)
{
	return space_quest.hasWonQuest(player, "recovery", "ep3_slaver_rhosk_recovery");
}

// ----------------------------------------------------------------------

boolean ep3_kymayrr_condition_hasRescuedRroot (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "ep3_kymayrr_rescue_rroot", "taskReturnToKymayrr");
}

// ----------------------------------------------------------------------

boolean ep3_kymayrr_condition_hasCompletedRescue (obj_id player, obj_id npc)
{
	return groundquests.hasCompletedQuest(player, "ep3_kymayrr_rescue_rroot");
}

// ----------------------------------------------------------------------

boolean ep3_kymayrr_condition_hasSlainHsskas (obj_id player, obj_id npc)
{
	return groundquests.hasCompletedQuest(player, "ep3_gursan_slay_hsskas");
}

// ----------------------------------------------------------------------

boolean ep3_kymayrr_condition_hasCysscSignalQuest (obj_id player, obj_id npc)
{
	return groundquests.isQuestActive(player, "ep3_kymayrr_send_cyssc_signal");
}

// ----------------------------------------------------------------------

boolean ep3_kymayrr_condition_canCompleteSignalQuest (obj_id player, obj_id npc)
{
	return (groundquests.isTaskActive(player, "ep3_kymayrr_send_cyssc_signal", "taskReturnToGursan") ||
			groundquests.hasCompletedQuest(player, "ep3_kymayrr_send_cyssc_signal"));
}

// ----------------------------------------------------------------------

boolean ep3_kymayrr_condition_hasDefeatedCysscSpace (obj_id player, obj_id npc)
{
	return space_quest.hasWonQuest(player, "assassinate", "ep3_slaver_lord_cyssc_final");
}

// ----------------------------------------------------------------------

boolean ep3_kymayrr_condition_isWookieeHero (obj_id player, obj_id npc)
{
	return badge.hasBadge(player, "bdg_kash_wookiee_rage");
}

// ----------------------------------------------------------------------

boolean ep3_kymayrr_condition_canDoWookieeJabba (obj_id player, obj_id npc)
{
	return utils.canSpeakWookiee(player, npc);
}

// ======================================================================
// Script Actions
// ======================================================================

void ep3_kymayrr_action_grantAdjutantRhoskMission (obj_id player, obj_id npc)
{
	space_quest.grantQuest(player, "space_battle", "ep3_slaver_rhosk_space_battle");
}

// ----------------------------------------------------------------------

void ep3_kymayrr_action_grantRescueRrootMission (obj_id player, obj_id npc)
{
	groundquests.grantQuest(player, "ep3_kymayrr_rescue_rroot");
}

// ----------------------------------------------------------------------

void ep3_kymayrr_action_rewardRrootRescue (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "signalReturnToKymayrr");
}

// ----------------------------------------------------------------------

void ep3_kymayrr_action_grantSendCysscSignalQuest (obj_id player, obj_id npc)
{
	groundquests.grantQuest(player, "ep3_kymayrr_send_cyssc_signal");
}

// ----------------------------------------------------------------------

void ep3_kymayrr_action_giveWookieeRageMedal (obj_id player, obj_id npc)
{
	if (!badge.hasBadge(player, "bdg_kash_wookiee_rage"))
		badge.grantBadge(player, "bdg_kash_wookiee_rage");
		
	if (getGender(player) == GENDER_MALE)
	{
		if (getSpecies(player) == SPECIES_ITHORIAN )
			createObjectInInventoryAllowOverload("object/tangible/wearables/necklace/ith_necklace_wookiee_freedom_m.iff", player);
		else if (getSpecies(player) == SPECIES_WOOKIEE)
			createObjectInInventoryAllowOverload("object/tangible/wearables/necklace/necklace_wookiee_freedom_wke_.iff", player);
		else
			createObjectInInventoryAllowOverload("object/tangible/wearables/necklace/necklace_wookiee_freedom_m.iff", player);
	}
	else
	{
		if (getSpecies(player) == SPECIES_ITHORIAN )
			createObjectInInventoryAllowOverload("object/tangible/wearables/necklace/ith_necklace_wookiee_freedom_f.iff", player);
		else if (getSpecies(player) == SPECIES_WOOKIEE)
			createObjectInInventoryAllowOverload("object/tangible/wearables/necklace/necklace_wookiee_freedom_wke_f.iff", player);
		else
			createObjectInInventoryAllowOverload("object/tangible/wearables/necklace/necklace_wookiee_freedom_f.iff", player);
	}
}

// ----------------------------------------------------------------------

void ep3_kymayrr_action_doDunnoEmote (obj_id player, obj_id npc)
{
	utils.emoteWookieeConfusion(player, npc);
}

// ======================================================================
// Script %TO Tokens
// ======================================================================

// ======================================================================
// Script %DI Tokens
// ======================================================================

// ======================================================================
// Script %DF Tokens
// ======================================================================

// ======================================================================
// handleBranch<n> Functions 
// ======================================================================

int ep3_kymayrr_handleBranch2 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I knew that my faith in you was well placed %NU. You have done a service for not just my people, but an entire world yearning to be free of such dark forces. I present to you this medal as a symbol of your bravery and determination in the struggles we have faced together.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: It was an honor.
	if (response == "s_279")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			ep3_kymayrr_action_giveWookieeRageMedal (player, npc);

			//-- NPC: No %NU, the honor was all mine.
			string_id message = new string_id (c_stringFile, "s_281");
			utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

			prose_package pp = new prose_package ();
			pp.stringId = message;
			pp.actor.set (player);
			pp.target.set (npc);

			npcEndConversationWithMessage (player, pp);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch5 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You have returned, this is wonderous. Go speak with Gursan quickly now, we haven't a moment to lose.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I will do so.
	if (response == "s_287")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: Yes, please hurry.
			string_id message = new string_id (c_stringFile, "s_289");
			utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch8 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You have shown your bravery time and time again %NU. The people of this land, and all those who value freedom are behind you. I am now asking you for more. I am giving you a recorded message. It will transmit the Wardens signature along with a plea for help. We must have faith that it will work.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I have faith.
	if (response == "s_295")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: Then go speak with Gursan. He can tell you about the camp.
			string_id message = new string_id (c_stringFile, "s_297");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I will return when we are done.
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_299");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 9);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch9 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Then go speak with Gursan. He can tell you about the camp.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I will return when we are done.
	if (response == "s_299")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			ep3_kymayrr_action_grantSendCysscSignalQuest (player, npc);

			//-- NPC: Return safely my friend.
			string_id message = new string_id (c_stringFile, "s_301");
			utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch11 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Thank you again for all that you have done. Please visit Gursan to find out more.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I will do that.
	if (response == "s_305")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: Forest blessings be with you.
			string_id message = new string_id (c_stringFile, "s_307");
			utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch13 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You have returned. I hope it is with good news.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Rroot is safe and wants you to know that all is well.
	if (response == "s_311")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: That is music to my ears. I am forever in your debt %NU. While you were gone we discovered a number of things from Rhosk. My friend Gursan Bryes who stays in the huts below will brief you on what our future plans are. But first I have a gift for you. In examining Rhosk's ship we discovered the purpose of his visit. A shipment of weapons for the Avatar fleet had been delivered to the Blackscale compound and he was receiving them personally.
			string_id message = new string_id (c_stringFile, "s_313");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: What type of weapons.
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_315");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 14);

				prose_package pp = new prose_package ();
				pp.stringId = message;
				pp.actor.set (player);
				pp.target.set (npc);

				npcSpeak (player, pp);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				prose_package pp = new prose_package ();
				pp.stringId = message;
				pp.actor.set (player);
				pp.target.set (npc);

				npcEndConversationWithMessage (player, pp);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch14 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: That is music to my ears. I am forever in your debt %NU. While you were gone we discovered a number of things from Rhosk. My friend Gursan Bryes who stays in the huts below will brief you on what our future plans are. But first I have a gift for you. In examining Rhosk's ship we discovered the purpose of his visit. A shipment of weapons for the Avatar fleet had been delivered to the Blackscale compound and he was receiving them personally.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What type of weapons.
	if (response == "s_315")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			ep3_kymayrr_action_rewardRrootRescue (player, npc);

			//-- NPC: Ion Cannons. Probably for their transport raiders.
			string_id message = new string_id (c_stringFile, "s_317");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I will go speak with Gursan then.
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_319");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 15);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch15 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Ion Cannons. Probably for their transport raiders.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I will go speak with Gursan then.
	if (response == "s_319")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: Please do. And thank you again %NU.
			string_id message = new string_id (c_stringFile, "s_321");
			utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

			prose_package pp = new prose_package ();
			pp.stringId = message;
			pp.actor.set (player);
			pp.target.set (npc);

			npcEndConversationWithMessage (player, pp);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch17 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: %NU, I am glad you have returned. I have heard of your victory and we are grateful for your efforts. But I have had a personal tragedy while you were gone. My son Rroot travels the Rryatt Trail transporting supplies and refugees throughout the area. Earlier today I received word that he was captured by the slavers that inhabit that area. We learned this from the radio you recovered for us, it has already proved its worth.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Is there anything I can do?
	if (response == "s_326")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: Since you know of this camp already. I would ask you to go back down there and free him for me. Rroot and his sister are the only family I have left.
			string_id message = new string_id (c_stringFile, "s_330");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I will set him free.
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I understand your plight, but I have more pressing matters to attend.
			boolean hasResponse1 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_332");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_340");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 18);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch18 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Since you know of this camp already. I would ask you to go back down there and free him for me. Rroot and his sister are the only family I have left.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I will set him free.
	if (response == "s_332")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: Thank you so very much. I will oversee the interrogation of Adjutant Rhosk now that you have lifted this burden from me.
			string_id message = new string_id (c_stringFile, "s_334");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Your son will be home soon.
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_336");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 19);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I understand your plight, but I have more pressing matters to attend.
	if (response == "s_340")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: I understand. Maybe there is another who can help me.
			string_id message = new string_id (c_stringFile, "s_342");
			utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch19 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Thank you so very much. I will oversee the interrogation of Adjutant Rhosk now that you have lifted this burden from me.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Your son will be home soon.
	if (response == "s_336")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			ep3_kymayrr_action_grantRescueRrootMission (player, npc);

			//-- NPC: Blessings of the forest be with you.
			string_id message = new string_id (c_stringFile, "s_338");
			utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch22 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: %NU, I was looking forward to meeting you. Zhailaut tells me you provided a great service for us. Being able to track the Trandoshans movements in the Trail will allow us to move refugees and supplies more easily. But there is more we would ask of you if you are willing.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I am willing.
	if (response == "s_346")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: That is good to hear. The occupation of Kashyyyk has never been a blessing, but what was once an endurable situation has ended with the coming of the Blackscale. When the Empire made their declaration of destruction or servitude, many of our elders and warriors immediately surrendered to their rule and those that were left behind knew a form of peace.
			string_id message = new string_id (c_stringFile, "s_348");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: And the Blackscale?
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_350");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 23);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I have my own set of problems to deal with, I'll be on my way.
	if (response == "s_378")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: That is unfortunate.
			string_id message = new string_id (c_stringFile, "s_380");
			utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch23 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: That is good to hear. The occupation of Kashyyyk has never been a blessing, but what was once an endurable situation has ended with the coming of the Blackscale. When the Empire made their declaration of destruction or servitude, many of our elders and warriors immediately surrendered to their rule and those that were left behind knew a form of peace.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: And the Blackscale?
	if (response == "s_350")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: This territory was handed over to them when the Empire pulled back its forces. The Blackscale are killers and brutes. Their herding of my people caught us unaware at first. But their plan has backfired on them for we resisted. As was feared they appealed to the Empire to carry through on their threat to lay waste to our lands but Commander Richards has denied their request.
			string_id message = new string_id (c_stringFile, "s_352");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Why would the Imperial not support the Trandoshans as promised?
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_354");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 24);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch24 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: This territory was handed over to them when the Empire pulled back its forces. The Blackscale are killers and brutes. Their herding of my people caught us unaware at first. But their plan has backfired on them for we resisted. As was feared they appealed to the Empire to carry through on their threat to lay waste to our lands but Commander Richards has denied their request.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Why would the Imperial not support the Trandoshans as promised?
	if (response == "s_354")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: A few believe he takes delight in seeing the Trandoshans fail where the Empire had such success. Personally I think he is afraid to call for aid because it would be admitting that he has lost control of this region. Commander Richards's authority ends at the borders of this village. Warden Tosk rules the clan here on Kashyyyk. And Tosk answers directly to Lord Cyssc, patriarch of the Blackscale, back on Hss'Kas.
			string_id message = new string_id (c_stringFile, "s_356");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: What sort of plan do you have then?
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_358");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 25);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch25 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: A few believe he takes delight in seeing the Trandoshans fail where the Empire had such success. Personally I think he is afraid to call for aid because it would be admitting that he has lost control of this region. Commander Richards's authority ends at the borders of this village. Warden Tosk rules the clan here on Kashyyyk. And Tosk answers directly to Lord Cyssc, patriarch of the Blackscale, back on Hss'Kas.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What sort of plan do you have then?
	if (response == "s_358")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: Trandoshans are noted for their regenerative abilities. They are willing to lose an arm in battle as they know it will grow back. This makes them fierce fighters. No, if you truly want to kill a Trandoshan you are best to remove the head.
			string_id message = new string_id (c_stringFile, "s_360");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Lord Cyssc. But you say he is far from here.
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_362");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 26);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch26 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Trandoshans are noted for their regenerative abilities. They are willing to lose an arm in battle as they know it will grow back. This makes them fierce fighters. No, if you truly want to kill a Trandoshan you are best to remove the head.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Lord Cyssc. But you say he is far from here.
	if (response == "s_362")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: That is true, and he is not known to leave his citadel. It is here where you become important to our efforts. Adjutant Rhosk runs Avatar Platform, that cancerous station dug into an asteroid field surrounding Kashyyyk. He is currently here on Kashyyyk to meet with Tosk but will be returning shortly to the Avatar. We want him captured, and during his return flight is our best chance.
			string_id message = new string_id (c_stringFile, "s_364");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: What do I need to do?
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_366");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 27);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch27 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: That is true, and he is not known to leave his citadel. It is here where you become important to our efforts. Adjutant Rhosk runs Avatar Platform, that cancerous station dug into an asteroid field surrounding Kashyyyk. He is currently here on Kashyyyk to meet with Tosk but will be returning shortly to the Avatar. We want him captured, and during his return flight is our best chance.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What do I need to do?
	if (response == "s_366")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: There will be a squad of Blackscale fighters sweeping the flight path ahead of Rhosk. A wing of our fighters will engage them, if we win Rhosk will send in his personal guard. When this happens you can slip in and capture his transport. We will jam long range communications, so you will be on your own out there but more importantly so will they.
			string_id message = new string_id (c_stringFile, "s_368");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: The mission sounds easy. But what of their reprisal?
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_370");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 28);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch28 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: There will be a squad of Blackscale fighters sweeping the flight path ahead of Rhosk. A wing of our fighters will engage them, if we win Rhosk will send in his personal guard. When this happens you can slip in and capture his transport. We will jam long range communications, so you will be on your own out there but more importantly so will they.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: The mission sounds easy. But what of their reprisal?
	if (response == "s_370")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			//-- NPC: If all goes well, they will believe it was mining pirates. Be wary up there %NU. The Blackscale employ mercenaries to bolster their ranks, but the house guard are all expert pilots.
			string_id message = new string_id (c_stringFile, "s_372");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Understood.
			boolean hasResponse0 = false;
			if (ep3_kymayrr_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_374");

				utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 29);

				prose_package pp = new prose_package ();
				pp.stringId = message;
				pp.actor.set (player);
				pp.target.set (npc);

				npcSpeak (player, pp);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

				prose_package pp = new prose_package ();
				pp.stringId = message;
				pp.actor.set (player);
				pp.target.set (npc);

				npcEndConversationWithMessage (player, pp);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int ep3_kymayrr_handleBranch29 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: If all goes well, they will believe it was mining pirates. Be wary up there %NU. The Blackscale employ mercenaries to bolster their ranks, but the house guard are all expert pilots.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Understood.
	if (response == "s_374")
	{
		//-- [NOTE] 
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			ep3_kymayrr_action_grantAdjutantRhoskMission (player, npc);

			//-- NPC: Then go with honor.
			string_id message = new string_id (c_stringFile, "s_376");
			utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

// ======================================================================
// User Script Triggers
// ======================================================================

trigger OnInitialize ()
{
	if ((!isMob (self)) || (isPlayer (self)))
		detachScript(self, "conversation.ep3_kymayrr");

	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnAttach ()
{
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnObjectMenuRequest (obj_id player, menu_info menuInfo)
{
	int menu = menuInfo.addRootMenu (menu_info_types.CONVERSE_START, null);
	menu_info_data menuInfoData = menuInfo.getMenuItemById (menu);
	menuInfoData.setServerNotify (false);
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnIncapacitated (obj_id killer)
{
	clearCondition (self, CONDITION_CONVERSABLE);
	detachScript (self, "conversation.ep3_kymayrr");

	return SCRIPT_CONTINUE;
}

// ======================================================================
// Script Triggers
// ======================================================================

//-- This function should move to base_class.java
boolean npcStartConversation(obj_id player, obj_id npc, string convoName, string_id greetingId, prose_package greetingProse, string_id[] responses)
{
	Object[] objects = new Object[responses.length];
	System.arraycopy(responses, 0, objects, 0, responses.length);
	return npcStartConversation(player, npc, convoName, greetingId, greetingProse, objects);
}

// ----------------------------------------------------------------------

trigger OnStartNpcConversation (obj_id player)
{
	obj_id npc = self;

	if (ai_lib.isInCombat (npc) || ai_lib.isInCombat (player))
		return SCRIPT_OVERRIDE;

	//-- [NOTE] 
	if (ep3_kymayrr_condition_isWookieeHero (player, npc))
	{
		//-- NPC: Thank you for all that you have done %NU.
		string_id message = new string_id (c_stringFile, "s_275");
			prose_package pp = new prose_package ();
			pp.stringId = message;
			pp.actor.set (player);
			pp.target.set (npc);

			chat.chat (npc, player, null, null, pp);
		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (ep3_kymayrr_condition_hasDefeatedCysscSpace (player, npc))
	{
		//-- NPC: I knew that my faith in you was well placed %NU. You have done a service for not just my people, but an entire world yearning to be free of such dark forces. I present to you this medal as a symbol of your bravery and determination in the struggles we have faced together.
		string_id message = new string_id (c_stringFile, "s_277");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: It was an honor.
		boolean hasResponse0 = false;
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_279");

			utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 2);

			prose_package pp = new prose_package ();
			pp.stringId = message;
			pp.actor.set (player);
			pp.target.set (npc);

			npcStartConversation (player, npc, "ep3_kymayrr", null, pp, responses);
		}
		else
		{
			prose_package pp = new prose_package ();
			pp.stringId = message;
			pp.actor.set (player);
			pp.target.set (npc);

			chat.chat (npc, player, null, null, pp);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (ep3_kymayrr_condition_canDoWookieeJabba (player, npc))
	{
		ep3_kymayrr_action_doDunnoEmote (player, npc);

		//-- NPC: Haraako
		string_id message = new string_id (c_stringFile, "s_283");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (ep3_kymayrr_condition_canCompleteSignalQuest (player, npc))
	{
		//-- NPC: You have returned, this is wonderous. Go speak with Gursan quickly now, we haven't a moment to lose.
		string_id message = new string_id (c_stringFile, "s_285");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I will do so.
		boolean hasResponse0 = false;
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_287");

			utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 5);

			npcStartConversation (player, npc, "ep3_kymayrr", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (ep3_kymayrr_condition_hasCysscSignalQuest (player, npc))
	{
		//-- NPC: Go quickly, time is short.
		string_id message = new string_id (c_stringFile, "s_291");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (ep3_kymayrr_condition_hasSlainHsskas (player, npc))
	{
		//-- NPC: You have shown your bravery time and time again %NU. The people of this land, and all those who value freedom are behind you. I am now asking you for more. I am giving you a recorded message. It will transmit the Wardens signature along with a plea for help. We must have faith that it will work.
		string_id message = new string_id (c_stringFile, "s_293");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I have faith.
		boolean hasResponse0 = false;
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_295");

			utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 8);

			prose_package pp = new prose_package ();
			pp.stringId = message;
			pp.actor.set (player);
			pp.target.set (npc);

			npcStartConversation (player, npc, "ep3_kymayrr", null, pp, responses);
		}
		else
		{
			prose_package pp = new prose_package ();
			pp.stringId = message;
			pp.actor.set (player);
			pp.target.set (npc);

			chat.chat (npc, player, null, null, pp);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (ep3_kymayrr_condition_hasCompletedRescue (player, npc))
	{
		//-- NPC: Thank you again for all that you have done. Please visit Gursan to find out more.
		string_id message = new string_id (c_stringFile, "s_303");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I will do that.
		boolean hasResponse0 = false;
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_305");

			utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 11);

			npcStartConversation (player, npc, "ep3_kymayrr", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (ep3_kymayrr_condition_hasRescuedRroot (player, npc))
	{
		//-- NPC: You have returned. I hope it is with good news.
		string_id message = new string_id (c_stringFile, "s_309");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Rroot is safe and wants you to know that all is well.
		boolean hasResponse0 = false;
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_311");

			utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 13);

			npcStartConversation (player, npc, "ep3_kymayrr", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (ep3_kymayrr_condition_hasWonAdjutantRecovery (player, npc))
	{
		//-- NPC: %NU, I am glad you have returned. I have heard of your victory and we are grateful for your efforts. But I have had a personal tragedy while you were gone. My son Rroot travels the Rryatt Trail transporting supplies and refugees throughout the area. Earlier today I received word that he was captured by the slavers that inhabit that area. We learned this from the radio you recovered for us, it has already proved its worth.
		string_id message = new string_id (c_stringFile, "s_324");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Is there anything I can do?
		boolean hasResponse0 = false;
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_326");

			utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 17);

			prose_package pp = new prose_package ();
			pp.stringId = message;
			pp.actor.set (player);
			pp.target.set (npc);

			npcStartConversation (player, npc, "ep3_kymayrr", null, pp, responses);
		}
		else
		{
			prose_package pp = new prose_package ();
			pp.stringId = message;
			pp.actor.set (player);
			pp.target.set (npc);

			chat.chat (npc, player, null, null, pp);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (ep3_kymayrr_condition_hasWonTrandoRadio (player, npc))
	{
		//-- NPC: %NU, I was looking forward to meeting you. Zhailaut tells me you provided a great service for us. Being able to track the Trandoshans movements in the Trail will allow us to move refugees and supplies more easily. But there is more we would ask of you if you are willing.
		string_id message = new string_id (c_stringFile, "s_344");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I am willing.
		boolean hasResponse0 = false;
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		//-- PLAYER: I have my own set of problems to deal with, I'll be on my way.
		boolean hasResponse1 = false;
		if (ep3_kymayrr_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse1 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_346");

			if (hasResponse1)
				responses [responseIndex++] = new string_id (c_stringFile, "s_378");

			utils.setScriptVar (player, "conversation.ep3_kymayrr.branchId", 22);

			prose_package pp = new prose_package ();
			pp.stringId = message;
			pp.actor.set (player);
			pp.target.set (npc);

			npcStartConversation (player, npc, "ep3_kymayrr", null, pp, responses);
		}
		else
		{
			prose_package pp = new prose_package ();
			pp.stringId = message;
			pp.actor.set (player);
			pp.target.set (npc);

			chat.chat (npc, player, null, null, pp);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (ep3_kymayrr_condition__defaultCondition (player, npc))
	{
		//-- NPC: Enjoy your stay in Kachirho. But be watchful for the Trandoshan Slavers, they cannot be trusted.
		string_id message = new string_id (c_stringFile, "s_382");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	chat.chat (npc, "Error:  All conditions for OnStartNpcConversation were false.");

	return SCRIPT_CONTINUE;
}

// ----------------------------------------------------------------------

trigger OnNpcConversationResponse (string conversationId, obj_id player, string_id response)
{
	if (conversationId != "ep3_kymayrr")
		return SCRIPT_CONTINUE;

	obj_id npc = self;

	int branchId = utils.getIntScriptVar (player, "conversation.ep3_kymayrr.branchId");

	if (branchId == 2 && ep3_kymayrr_handleBranch2 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 5 && ep3_kymayrr_handleBranch5 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 8 && ep3_kymayrr_handleBranch8 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 9 && ep3_kymayrr_handleBranch9 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 11 && ep3_kymayrr_handleBranch11 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 13 && ep3_kymayrr_handleBranch13 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 14 && ep3_kymayrr_handleBranch14 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 15 && ep3_kymayrr_handleBranch15 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 17 && ep3_kymayrr_handleBranch17 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 18 && ep3_kymayrr_handleBranch18 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 19 && ep3_kymayrr_handleBranch19 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 22 && ep3_kymayrr_handleBranch22 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 23 && ep3_kymayrr_handleBranch23 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 24 && ep3_kymayrr_handleBranch24 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 25 && ep3_kymayrr_handleBranch25 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 26 && ep3_kymayrr_handleBranch26 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 27 && ep3_kymayrr_handleBranch27 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 28 && ep3_kymayrr_handleBranch28 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 29 && ep3_kymayrr_handleBranch29 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	chat.chat (npc, "Error:  Fell through all branches and responses for OnNpcConversationResponse.");

	utils.removeScriptVar (player, "conversation.ep3_kymayrr.branchId");

	return SCRIPT_CONTINUE;
}

// ======================================================================

