// ======================================================================
//
// som_doctor_lu.script
// Copyright 2004, Sony Online Entertainment
// All Rights Reserved.
//
// Created with SwgConversationEditor 1.35 - DO NOT EDIT THIS AUTO-GENERATED FILE!
//
// ======================================================================

// ======================================================================
// Library Includes
// ======================================================================

include library.ai_lib;
include library.chat;
include library.groundquests;
include library.utils;

// ======================================================================
// Script Constants
// ======================================================================

string c_stringFile = "conversation/som_doctor_lu";

// ======================================================================
// Script Conditions
// ======================================================================

boolean som_doctor_lu_condition__defaultCondition (obj_id player, obj_id npc)
{
	return true;
}

// ----------------------------------------------------------------------

boolean som_doctor_lu_condition_isOnFirstTask (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_blackguard_problem", "blackguard_problem_one");
}

// ----------------------------------------------------------------------

boolean som_doctor_lu_condition_hasWonFirstTask (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_blackguard_problem", "blackguard_problem_two");
}

// ----------------------------------------------------------------------

boolean som_doctor_lu_condition_isOnSecondTask (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_blackguard_problem", "blackguard_problem_three");
}

// ----------------------------------------------------------------------

boolean som_doctor_lu_condition_hasWonSecondTask (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_blackguard_problem", "blackguard_problem_four");
}

// ----------------------------------------------------------------------

boolean som_doctor_lu_condition_isOnThirdTask (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_blackguard_problem", "blackguard_problem_five");
}

// ----------------------------------------------------------------------

boolean som_doctor_lu_condition_hasWonThirdTask (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_blackguard_problem", "blackguard_problem_six");
}

// ----------------------------------------------------------------------

boolean som_doctor_lu_condition_hasWonMission (obj_id player, obj_id npc)
{
	return groundquests.hasCompletedQuest(player, "som_blackguard_problem");
}

// ======================================================================
// Script Actions
// ======================================================================

void som_doctor_lu_action_grantMission (obj_id player, obj_id npc)
{
	groundquests.grantQuest(player, "som_blackguard_problem");
}

// ----------------------------------------------------------------------

void som_doctor_lu_action_sendFirstSignal (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "blackguard_minion_defeated");
}

// ----------------------------------------------------------------------

void som_doctor_lu_action_sendSecondSignal (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "blackguard_vansk_defeated");
}

// ----------------------------------------------------------------------

void som_doctor_lu_action_sendLastSignal (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "blackguard_sansii_defeated");
}

// ======================================================================
// Script %TO Tokens
// ======================================================================

// ======================================================================
// Script %DI Tokens
// ======================================================================

// ======================================================================
// Script %DF Tokens
// ======================================================================

// ======================================================================
// handleBranch<n> Functions 
// ======================================================================

int som_doctor_lu_handleBranch2 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You appear to be a little singed. I take it by your appearance that you dealt with San'sii.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: You better believe it.
	if (response == "s_47")
	{
		doAnimationAction (player, "nod");

		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "celebrate");

			//-- NPC: Thank you, thank you, thank you. You have made this archaeologist very happy. I don't have much, but I do have some relics that I pulled out of the ruins before I was driven away by those Blackguard. I insist you take one as payment.
			string_id message = new string_id (c_stringFile, "s_48");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: You don't have to twist my arm. Thank you.
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_49");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 3);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch3 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Thank you, thank you, thank you. You have made this archaeologist very happy. I don't have much, but I do have some relics that I pulled out of the ruins before I was driven away by those Blackguard. I insist you take one as payment.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: You don't have to twist my arm. Thank you.
	if (response == "s_49")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "offer_affection");

			doAnimationAction (player, "refuse_offer_affection");

			som_doctor_lu_action_sendLastSignal (player, npc);

			//-- NPC: Thanks again.
			string_id message = new string_id (c_stringFile, "s_50");
			utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch5 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Is San'sii...you know...dead?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Nope, he is a cagey one. I will get him though.
	if (response == "s_44")
	{
		doAnimationAction (player, "shake_head_no");

		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "rub_chin_thoughtful");

			//-- NPC: I cannot wait to get a look at those ruins. The wonders that I will be able to uncover will be...great.
			string_id message = new string_id (c_stringFile, "s_45");
			utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch7 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I waited right here just like I said I would. So, what news?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Vansk will no longer be of any hassle to you.
	if (response == "s_39")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "nervous");

			//-- NPC: You took out Vansk? I was impressed before but now I am in serious awe. I...I don't mean to ask this...I have never actually asked for this sort of help before. Could you maybe take care of San'sii too? He scares me a lot, and now that Vansk is gone, he might decide to take out his rage on someone weaker...like me.
			string_id message = new string_id (c_stringFile, "s_40");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I was thinking the same thing.
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_41");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 8);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch8 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You took out Vansk? I was impressed before but now I am in serious awe. I...I don't mean to ask this...I have never actually asked for this sort of help before. Could you maybe take care of San'sii too? He scares me a lot, and now that Vansk is gone, he might decide to take out his rage on someone weaker...like me.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I was thinking the same thing.
	if (response == "s_41")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "nod_head_multiple");

			som_doctor_lu_action_sendSecondSignal (player, npc);

			//-- NPC: I cannot thank you enough. While you go do that, I am going to just wait here and hope for the best.
			string_id message = new string_id (c_stringFile, "s_42");
			utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch10 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: So did you...did you take care of your business?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Not yet. But you shouldn't worry about it.
	if (response == "s_37")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			//-- NPC: Right. I will just stay here and wait for you to come back.
			string_id message = new string_id (c_stringFile, "s_38");
			utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch12 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Good to see you again, my friend. How was your trip into the ruins? Did you see anything that I might be interested in?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I wasn't there looking around. I took care of some business.
	if (response == "s_27")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "huh");

			//-- NPC: What do you mean?
			string_id message = new string_id (c_stringFile, "s_28");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I eliminated some of those Blackguard for you.
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_30");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 13);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch13 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: What do you mean?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I eliminated some of those Blackguard for you.
	if (response == "s_30")
	{
		doAnimationAction (player, "slit_throat");

		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "wtf");

			//-- NPC: What! I must say that is most impressive. But I fear that your efforts are wasted. The real problem with the Blackguard is their leaders. Even if you took out all the Blackguard minions, they would never let me near the ruins.
			string_id message = new string_id (c_stringFile, "s_32");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: This San'sii character?
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_34");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 14);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch14 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: What! I must say that is most impressive. But I fear that your efforts are wasted. The real problem with the Blackguard is their leaders. Even if you took out all the Blackguard minions, they would never let me near the ruins.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: This San'sii character?
	if (response == "s_34")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "explain");

			//-- NPC: Him and his woman...Vansk. She is a real mean one. This is just a guess, but I don't think she was hugged enough as a child. Those two alone could easily keep me from going anywhere near those ruins.
			string_id message = new string_id (c_stringFile, "s_36");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I see. Well perhaps it is time for me to go back to work.
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_52");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 15);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch15 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Him and his woman...Vansk. She is a real mean one. This is just a guess, but I don't think she was hugged enough as a child. Those two alone could easily keep me from going anywhere near those ruins.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I see. Well perhaps it is time for me to go back to work.
	if (response == "s_52")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "nervous");

			//-- NPC: What are you going to do?
			string_id message = new string_id (c_stringFile, "s_54");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: You are better off not knowing.
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_56");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 16);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch16 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: What are you going to do?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: You are better off not knowing.
	if (response == "s_56")
	{
		doAnimationAction (player, "wave_finger_warning");

		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "point_down");

			som_doctor_lu_action_sendFirstSignal (player, npc);

			//-- NPC: Hmmmm...well, okay. I will just wait here.
			string_id message = new string_id (c_stringFile, "s_58");
			utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch18 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Hiya. I am glad to see that you are not dead. So, did you see anything in the ruins that I would be interested in?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Nope, but I am planning on going back.
	if (response == "s_62")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			//-- NPC: Okay, well, take care, my friend.
			string_id message = new string_id (c_stringFile, "s_64");
			utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch20 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Don't even bother to try to go up there. Those stinking Blackguard will not let anyone near the ruins, except for Colonel Narl's crew, of course. You might as well just turn right around and head the other way.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Why would these...Blackguard try to stop me?
	if (response == "s_68")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "shake_head_disgust");

			//-- NPC: They want the treasures that are in the ruins for themselves. I tried to explain to them that I only wanted to study those relics, but they didn't believe me. I was lucky to get out of there in one piece. At least Colonel Narl agreed to let me study anything they pull out of the ruins, before they sell them off.
			string_id message = new string_id (c_stringFile, "s_70");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: What are you? Some sort of archaeologist?
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_72");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 21);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch21 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: They want the treasures that are in the ruins for themselves. I tried to explain to them that I only wanted to study those relics, but they didn't believe me. I was lucky to get out of there in one piece. At least Colonel Narl agreed to let me study anything they pull out of the ruins, before they sell them off.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What are you? Some sort of archaeologist?
	if (response == "s_72")
	{
		doAnimationAction (player, "point_forward");

		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "bow2");

			//-- NPC: That is exactly what I am. I am Doctor Mi Fon Lu of the Theed Academy. I came here when I heard of the amazing discoveries coming from these perfectly preserved ruins. It is amazing to think that where we now stand was once a thriving temple during the period of the Old Republic. That was thousands of years ago, of course.
			string_id message = new string_id (c_stringFile, "s_74");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: So, who is this Colonel Narl?
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_76");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 22);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch22 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: That is exactly what I am. I am Doctor Mi Fon Lu of the Theed Academy. I came here when I heard of the amazing discoveries coming from these perfectly preserved ruins. It is amazing to think that where we now stand was once a thriving temple during the period of the Old Republic. That was thousands of years ago, of course.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: So, who is this Colonel Narl?
	if (response == "s_76")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "rub_chin_thoughtful");

			//-- NPC: He is a treasure hunter, like so many others all over this planet. I don't think he is a real Colonel though...I think he just likes the sound of it. He is nice enough to me, but he probably wouldn't take kindly to anyone else. He seems to be the only one that the Blackguard cannot push around.
			string_id message = new string_id (c_stringFile, "s_78");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Why is that?
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_80");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 23);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch23 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: He is a treasure hunter, like so many others all over this planet. I don't think he is a real Colonel though...I think he just likes the sound of it. He is nice enough to me, but he probably wouldn't take kindly to anyone else. He seems to be the only one that the Blackguard cannot push around.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Why is that?
	if (response == "s_80")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "explain");

			//-- NPC: Colonel Narl has a pretty big crew. The Blackguard use some pretty strange powers, but the Colonel outnumbers them. They seem to have developed a truce of sorts. The two sides have divided the ruins between them and leave each other alone. Of course, whenever anyone new shows up, they both turn on the newcomer.
			string_id message = new string_id (c_stringFile, "s_82");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I am guessing that the Blackguard have something you wish to study.
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_84");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 24);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch24 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Colonel Narl has a pretty big crew. The Blackguard use some pretty strange powers, but the Colonel outnumbers them. They seem to have developed a truce of sorts. The two sides have divided the ruins between them and leave each other alone. Of course, whenever anyone new shows up, they both turn on the newcomer.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I am guessing that the Blackguard have something you wish to study.
	if (response == "s_84")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "gesticulate_wildly");

			//-- NPC: Only the heart of the whole ruins. The primary temple is located on their side, and they won't let me anywhere near it. Their leader, San'sii, is there most of the time studying it. I told him that I could help him, but he just laughed and then I couldn't breath. He really freaks me out.
			string_id message = new string_id (c_stringFile, "s_86");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Well, perhaps I can help you.
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_88");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 25);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch25 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Only the heart of the whole ruins. The primary temple is located on their side, and they won't let me anywhere near it. Their leader, San'sii, is there most of the time studying it. I told him that I could help him, but he just laughed and then I couldn't breath. He really freaks me out.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Well, perhaps I can help you.
	if (response == "s_88")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "huh");

			//-- NPC: I don't know exactly what you can do for me. If you go up there, the Blackguard will definitely attack you, and I am pretty sure the Colonel will too. Like I said before, you should just turn around and head the other way.
			string_id message = new string_id (c_stringFile, "s_90");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Don't worry about me. I can handle myself.
			boolean hasResponse0 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: That is a sound plan. I think I will do that.
			boolean hasResponse1 = false;
			if (som_doctor_lu_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_92");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_96");

				utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 26);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int som_doctor_lu_handleBranch26 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I don't know exactly what you can do for me. If you go up there, the Blackguard will definitely attack you, and I am pretty sure the Colonel will too. Like I said before, you should just turn around and head the other way.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Don't worry about me. I can handle myself.
	if (response == "s_92")
	{
		doAnimationAction (player, "pose_proudly");

		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "goodbye");

			som_doctor_lu_action_grantMission (player, npc);

			//-- NPC: In that case, I wish you well. If you make it out of there alive, perhaps you will stop by and tell me about what you saw?
			string_id message = new string_id (c_stringFile, "s_94");
			utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: That is a sound plan. I think I will do that.
	if (response == "s_96")
	{
		//-- [NOTE] 
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "nod_head_multiple");

			//-- NPC: That is the best course of action.
			string_id message = new string_id (c_stringFile, "s_98");
			utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

// ======================================================================
// User Script Triggers
// ======================================================================

trigger OnInitialize ()
{
	if ((!isMob (self)) || (isPlayer (self)))
		detachScript(self, "conversation.som_doctor_lu");

	setCondition (self, CONDITION_CONVERSABLE);
	setInvulnerable (self, true);
	setCondition( self, CONDITION_INTERESTING );
	setName (self, "Doctor Mi Fon Lu");

	return SCRIPT_CONTINUE;
}

trigger OnAttach ()
{
	setCondition (self, CONDITION_CONVERSABLE);
	setInvulnerable (self, true);
	setCondition( self, CONDITION_INTERESTING );
	setName (self, "Doctor Mi Fon Lu");

	return SCRIPT_CONTINUE;
}

trigger OnObjectMenuRequest (obj_id player, menu_info menuInfo)
{
	int menu = menuInfo.addRootMenu (menu_info_types.CONVERSE_START, null);
	menu_info_data menuInfoData = menuInfo.getMenuItemById (menu);
	menuInfoData.setServerNotify (false);
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnIncapacitated (obj_id killer)
{
	clearCondition (self, CONDITION_CONVERSABLE);
	detachScript (self, "conversation.som_doctor_lu");

	return SCRIPT_CONTINUE;
}

// ======================================================================
// Script Triggers
// ======================================================================

//-- This function should move to base_class.java
boolean npcStartConversation(obj_id player, obj_id npc, string convoName, string_id greetingId, prose_package greetingProse, string_id[] responses)
{
	Object[] objects = new Object[responses.length];
	System.arraycopy(responses, 0, objects, 0, responses.length);
	return npcStartConversation(player, npc, convoName, greetingId, greetingProse, objects);
}

// ----------------------------------------------------------------------

trigger OnStartNpcConversation (obj_id player)
{
	obj_id npc = self;

	if (ai_lib.isInCombat (npc) || ai_lib.isInCombat (player))
		return SCRIPT_OVERRIDE;

	//-- [NOTE] 
	if (som_doctor_lu_condition_hasWonMission (player, npc))
	{
		doAnimationAction (npc, "bounce");

		//-- NPC: Hey, thanks for all your help. Those ruins are really fascinating. The evidence clearly suggests that this moon wasn't always a burning ball of fire, but a lush green planet. Something cataclysmic must have happened to leave it in this state. I am sure the truth is out there to be found. Good travels to you, my friend.
		string_id message = new string_id (c_stringFile, "s_46");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_doctor_lu_condition_hasWonThirdTask (player, npc))
	{
		doAnimationAction (npc, "wave1");

		//-- NPC: You appear to be a little singed. I take it by your appearance that you dealt with San'sii.
		string_id message = new string_id (c_stringFile, "s_43");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: You better believe it.
		boolean hasResponse0 = false;
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_47");

			utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 2);

			npcStartConversation (player, npc, "som_doctor_lu", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_doctor_lu_condition_isOnThirdTask (player, npc))
	{
		doAnimationAction (npc, "nervous");

		//-- NPC: Is San'sii...you know...dead?
		string_id message = new string_id (c_stringFile, "s_10");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Nope, he is a cagey one. I will get him though.
		boolean hasResponse0 = false;
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_44");

			utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 5);

			npcStartConversation (player, npc, "som_doctor_lu", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_doctor_lu_condition_hasWonSecondTask (player, npc))
	{
		//-- NPC: I waited right here just like I said I would. So, what news?
		string_id message = new string_id (c_stringFile, "s_14");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Vansk will no longer be of any hassle to you.
		boolean hasResponse0 = false;
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_39");

			utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 7);

			npcStartConversation (player, npc, "som_doctor_lu", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_doctor_lu_condition_isOnSecondTask (player, npc))
	{
		doAnimationAction (npc, "twitch");

		//-- NPC: So did you...did you take care of your business?
		string_id message = new string_id (c_stringFile, "s_20");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Not yet. But you shouldn't worry about it.
		boolean hasResponse0 = false;
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_37");

			utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 10);

			npcStartConversation (player, npc, "som_doctor_lu", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_doctor_lu_condition_hasWonFirstTask (player, npc))
	{
		doAnimationAction (npc, "bounce");

		//-- NPC: Good to see you again, my friend. How was your trip into the ruins? Did you see anything that I might be interested in?
		string_id message = new string_id (c_stringFile, "s_24");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I wasn't there looking around. I took care of some business.
		boolean hasResponse0 = false;
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_27");

			utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 12);

			npcStartConversation (player, npc, "som_doctor_lu", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_doctor_lu_condition_isOnFirstTask (player, npc))
	{
		doAnimationAction (npc, "greet");

		//-- NPC: Hiya. I am glad to see that you are not dead. So, did you see anything in the ruins that I would be interested in?
		string_id message = new string_id (c_stringFile, "s_60");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Nope, but I am planning on going back.
		boolean hasResponse0 = false;
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_62");

			utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 18);

			npcStartConversation (player, npc, "som_doctor_lu", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (som_doctor_lu_condition__defaultCondition (player, npc))
	{
		doAnimationAction (npc, "stop");

		//-- NPC: Don't even bother to try to go up there. Those stinking Blackguard will not let anyone near the ruins, except for Colonel Narl's crew, of course. You might as well just turn right around and head the other way.
		string_id message = new string_id (c_stringFile, "s_66");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Why would these...Blackguard try to stop me?
		boolean hasResponse0 = false;
		if (som_doctor_lu_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_68");

			utils.setScriptVar (player, "conversation.som_doctor_lu.branchId", 20);

			npcStartConversation (player, npc, "som_doctor_lu", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	chat.chat (npc, "Error:  All conditions for OnStartNpcConversation were false.");

	return SCRIPT_CONTINUE;
}

// ----------------------------------------------------------------------

trigger OnNpcConversationResponse (string conversationId, obj_id player, string_id response)
{
	if (conversationId != "som_doctor_lu")
		return SCRIPT_CONTINUE;

	obj_id npc = self;

	int branchId = utils.getIntScriptVar (player, "conversation.som_doctor_lu.branchId");

	if (branchId == 2 && som_doctor_lu_handleBranch2 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 3 && som_doctor_lu_handleBranch3 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 5 && som_doctor_lu_handleBranch5 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 7 && som_doctor_lu_handleBranch7 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 8 && som_doctor_lu_handleBranch8 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 10 && som_doctor_lu_handleBranch10 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 12 && som_doctor_lu_handleBranch12 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 13 && som_doctor_lu_handleBranch13 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 14 && som_doctor_lu_handleBranch14 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 15 && som_doctor_lu_handleBranch15 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 16 && som_doctor_lu_handleBranch16 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 18 && som_doctor_lu_handleBranch18 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 20 && som_doctor_lu_handleBranch20 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 21 && som_doctor_lu_handleBranch21 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 22 && som_doctor_lu_handleBranch22 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 23 && som_doctor_lu_handleBranch23 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 24 && som_doctor_lu_handleBranch24 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 25 && som_doctor_lu_handleBranch25 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 26 && som_doctor_lu_handleBranch26 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	chat.chat (npc, "Error:  Fell through all branches and responses for OnNpcConversationResponse.");

	utils.removeScriptVar (player, "conversation.som_doctor_lu.branchId");

	return SCRIPT_CONTINUE;
}

// ======================================================================

