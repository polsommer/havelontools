// ======================================================================
//
// padawan_old_musician_03.script
// Copyright 2003, Sony Online Entertainment
// All Rights Reserved.
//
// DO NOT EDIT THIS AUTO-GENERATED FILE.  PLEASE USE THE CONVERATION EDITOR!
//
// ======================================================================

// ======================================================================
// Library Includes
// ======================================================================

include library.ai_lib;
include library.chat;
include library.jedi_trials;

// ======================================================================
// Script Constants
// ======================================================================

string c_stringFile = "conversation/padawan_old_musician_03";

// ======================================================================
// Script Conditions
// ======================================================================

boolean padawan_old_musician_03_condition__defaultCondition (obj_id player, obj_id npc)
{
	return true;
}

// ----------------------------------------------------------------------

boolean padawan_old_musician_03_condition_isTrialPlayer (obj_id player, obj_id npc)
{
	string trialName = jedi_trials.getJediTrialName(player);
	
	if ( trialName != null && trialName.equals("old_musician") )
	{	
		return ( !hasObjVar(player, "jedi_trials.padawan_trials.temp.spokeToTarget_02") && hasObjVar(player, "jedi_trials.padawan_trials.temp.spokeToTarget_01") );
	}
	return false;
}

// ======================================================================
// Script Actions
// ======================================================================

void padawan_old_musician_03_action_sendBackToBeginning (obj_id player, obj_id npc)
{
	setObjVar(player, "jedi_trials.padawan_trials.temp.spokeToTarget_02", true);
	
	messageTo(player, "handleSetBeginLoc", null, 1, false);
}

// ======================================================================
// Script %TO Tokens
// ======================================================================

// ======================================================================
// Script %DI Tokens
// ======================================================================

// ======================================================================
// Script %DF Tokens
// ======================================================================

// ======================================================================
// User Script Triggers
// ======================================================================

trigger OnInitialize ()
{
	if ((!isMob (self)) || (isPlayer (self)))
		detachScript(self, "npc.conversation.padawan_old_musician_03");

	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnAttach ()
{
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnObjectMenuRequest (obj_id player, menu_info menuInfo)
{
	int menu = menuInfo.addRootMenu (menu_info_types.CONVERSE_START, null);
	menu_info_data menuInfoData = menuInfo.getMenuItemById (menu);
	menuInfoData.setServerNotify (false);
	setCondition (self, CONDITION_CONVERSABLE);

	return SCRIPT_CONTINUE;
}

trigger OnIncapacitated (obj_id killer)
{
	clearCondition (self, CONDITION_CONVERSABLE);
	detachScript (self, "npc.conversation.padawan_old_musician_03");

	return SCRIPT_CONTINUE;
}

// ======================================================================
// Script Triggers
// ======================================================================

//-- This function should move to base_class.java
boolean npcStartConversation(obj_id player, obj_id npc, string convoName, string_id greetingId, prose_package greetingProse, string_id[] responses)
{
	Object[] objects = new Object[responses.length];
	System.arraycopy(responses, 0, objects, 0, responses.length);
	return npcStartConversation(player, npc, convoName, greetingId, greetingProse, objects);
}

// ----------------------------------------------------------------------

trigger OnStartNpcConversation (obj_id player)
{
	if (ai_lib.isInCombat (self) || ai_lib.isInCombat (player))
		return SCRIPT_OVERRIDE;

	//-- [NOTE] 
	if (padawan_old_musician_03_condition_isTrialPlayer (player, self))
	{
		doAnimationAction (self, "wave2");

		//-- NPC: Hello friend.
		string_id message = new string_id (c_stringFile, "s_16e413e5");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I'm looking for an old friend of Grizzlo.
		boolean hasResponse0 = false;
		if (padawan_old_musician_03_condition__defaultCondition (player, self))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_a8d0cb35");

			setObjVar (player, "conversation.padawan_old_musician_03.branchId", 1);

			npcStartConversation (player, self, "padawan_old_musician_03", message, responses);
		}
		else
		{
			chat.chat (self, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (padawan_old_musician_03_condition__defaultCondition (player, self))
	{
		//-- NPC: I'm supposed to meet a friend, Branthon, and go see a theatrical performance tonight. If I don't go,  Branthon has promised to write an essay revealing the entire plot of the show. It will consist of at least 20 words!
		string_id message = new string_id (c_stringFile, "s_4ef8ad4d");
		chat.chat (self, message);

		return SCRIPT_CONTINUE;
	}

	chat.chat (self, "Error:  All conditions for OnStartNpcConversation were false.");

	return SCRIPT_CONTINUE;
}

// ----------------------------------------------------------------------

trigger OnNpcConversationResponse (string conversationId, obj_id player, string_id response)
{
	if (conversationId != "padawan_old_musician_03")
		return SCRIPT_CONTINUE;

	int branchId = getIntObjVar (player, "conversation.padawan_old_musician_03.branchId");

	//-- [BRANCH NOTE] 
	//-- NPC: Hello friend.
	//-- [RESPONSE NOTE] 
	//-- PLAYER: I'm looking for an old friend of Grizzlo.
	if (branchId == 1 && response == "s_a8d0cb35")
	{
		//-- [NOTE] 
		if (padawan_old_musician_03_condition__defaultCondition (player, self))
		{
			doAnimationAction (self, "nod_head_multiple");

			//-- NPC: No kidding?  Grizzy Two Tone?  It's been quite a few years since I've heard that name.  Samston, a member of Grizzy's band used to hang out in this here Cantina.  He used to sit in that chair right across from me.  We were good friends Samston and I. He had many a good stories of Grizzy and the rest of 'The Blue...' something... can't quite recall the bands name.  It was a sad day when Samston passed away. 
			string_id message = new string_id (c_stringFile, "s_8da4188a");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I'm sorry to hear that.  Grizzlo will be as well.
			boolean hasResponse0 = false;
			if (padawan_old_musician_03_condition__defaultCondition (player, self))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_cbc0ca2b");

				setObjVar (player, "conversation.padawan_old_musician_03.branchId", 2);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				removeObjVar (player, "conversation.padawan_old_musician_03.branchId");

				npcSpeak (player, message);
				npcEndConversation (player);
			}

			return SCRIPT_CONTINUE;
		}

		chat.chat (self, "Error:  All conditions for OnNpcConversationResponse for branch 'Hello friend.' were false.");

		return SCRIPT_CONTINUE;
	}

	//-- [BRANCH NOTE] 
	//-- NPC: No kidding?  Grizzy Two Tone?  It's been quite a few years since I've heard that name.  Samston, a member of Grizzy's band used to hang out in this here Cantina.  He used to sit in that chair right across from me.  We were good friends Samston and I. He had many a good stories of Grizzy and the rest of 'The Blue...' something... can't quite recall the bands name.  It was a sad day when Samston passed away. 
	//-- [RESPONSE NOTE] 
	//-- PLAYER: I'm sorry to hear that.  Grizzlo will be as well.
	if (branchId == 2 && response == "s_cbc0ca2b")
	{
		//-- [NOTE] 
		if (padawan_old_musician_03_condition__defaultCondition (player, self))
		{
			//-- NPC: It's been a good ten years since Samston passed away.  As far as I know he has never talked with Grizzy after the whole fiasco between the two of them over that Twi'lek dancer.
			string_id message = new string_id (c_stringFile, "s_a25995cf");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: What Twi'lek?
			boolean hasResponse0 = false;
			if (padawan_old_musician_03_condition__defaultCondition (player, self))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_6be6a4b5");

				setObjVar (player, "conversation.padawan_old_musician_03.branchId", 3);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				removeObjVar (player, "conversation.padawan_old_musician_03.branchId");

				npcSpeak (player, message);
				npcEndConversation (player);
			}

			return SCRIPT_CONTINUE;
		}

		chat.chat (self, "Error:  All conditions for OnNpcConversationResponse for branch 'No kidding?  Grizzy Two Tone?  It's been quite a few years since I've heard that name.  Samston, a member of Grizzy's band used to hang out in this here Cantina.  He used to sit in that chair right across from me.  We were good friends Samston and I. He had many a good stories of Grizzy and the rest of 'The Blue...' something... can't quite recall the bands name.  It was a sad day when Samston passed away. ' were false.");

		return SCRIPT_CONTINUE;
	}

	//-- [BRANCH NOTE] 
	//-- NPC: It's been a good ten years since Samston passed away.  As far as I know he has never talked with Grizzy after the whole fiasco between the two of them over that Twi'lek dancer.
	//-- [RESPONSE NOTE] 
	//-- PLAYER: What Twi'lek?
	if (branchId == 3 && response == "s_6be6a4b5")
	{
		//-- [NOTE] 
		if (padawan_old_musician_03_condition__defaultCondition (player, self))
		{
			//-- NPC: Oh just some girl the two of them fought over for quite some time.  
			string_id message = new string_id (c_stringFile, "s_8dc8e232");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Do you know where I might be able to find her?
			boolean hasResponse0 = false;
			if (padawan_old_musician_03_condition__defaultCondition (player, self))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_3585e154");

				setObjVar (player, "conversation.padawan_old_musician_03.branchId", 4);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				removeObjVar (player, "conversation.padawan_old_musician_03.branchId");

				npcSpeak (player, message);
				npcEndConversation (player);
			}

			return SCRIPT_CONTINUE;
		}

		chat.chat (self, "Error:  All conditions for OnNpcConversationResponse for branch 'It's been a good ten years since Samston passed away.  As far as I know he has never talked with Grizzy after the whole fiasco between the two of them over that Twi'lek dancer.' were false.");

		return SCRIPT_CONTINUE;
	}

	//-- [BRANCH NOTE] 
	//-- NPC: Oh just some girl the two of them fought over for quite some time.  
	//-- [RESPONSE NOTE] 
	//-- PLAYER: Do you know where I might be able to find her?
	if (branchId == 4 && response == "s_3585e154")
	{
		//-- [NOTE] 
		if (padawan_old_musician_03_condition__defaultCondition (player, self))
		{
			doAnimationAction (self, "shake_head_no");

			//-- NPC: You are going to need a shovel if you want to talk to her friend, and I'm afraid she isn't going to be saying much.  She passed a few years back herself.
			string_id message = new string_id (c_stringFile, "s_285ac110");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Thank you for your time.
			boolean hasResponse0 = false;
			if (padawan_old_musician_03_condition__defaultCondition (player, self))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_afbed875");

				setObjVar (player, "conversation.padawan_old_musician_03.branchId", 5);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				removeObjVar (player, "conversation.padawan_old_musician_03.branchId");

				npcSpeak (player, message);
				npcEndConversation (player);
			}

			return SCRIPT_CONTINUE;
		}

		chat.chat (self, "Error:  All conditions for OnNpcConversationResponse for branch 'Oh just some girl the two of them fought over for quite some time.  ' were false.");

		return SCRIPT_CONTINUE;
	}

	//-- [BRANCH NOTE] 
	//-- NPC: You are going to need a shovel if you want to talk to her friend, and I'm afraid she isn't going to be saying much.  She passed a few years back herself.
	//-- [RESPONSE NOTE] 
	//-- PLAYER: Thank you for your time.
	if (branchId == 5 && response == "s_afbed875")
	{
		//-- [NOTE] Player is given "Selstina's Ring", and a waypoint back to Grizzlo.
		if (padawan_old_musician_03_condition__defaultCondition (player, self))
		{
			doAnimationAction (self, "beckon");

			padawan_old_musician_03_action_sendBackToBeginning (player, self);

			//-- NPC: No problem friend.  Actually wait one second.  Samston gave me this here ring, it belonged to that Twi'lek I was talking about before. I don't have much need for it and I'm sure Grizzy Two Tone would love to have it himself. Tell him Samston always wanted him to have it; it wouldn't be far from the truth.
			string_id message = new string_id (c_stringFile, "s_77c9e846");
			removeObjVar (player, "conversation.padawan_old_musician_03.branchId");

			npcSpeak (player, message);
			npcEndConversation (player);

			return SCRIPT_CONTINUE;
		}

		chat.chat (self, "Error:  All conditions for OnNpcConversationResponse for branch 'You are going to need a shovel if you want to talk to her friend, and I'm afraid she isn't going to be saying much.  She passed a few years back herself.' were false.");

		return SCRIPT_CONTINUE;
	}

	chat.chat (self, "Error:  Fell through all branches and responses for OnNpcConversationResponse.");

	removeObjVar (player, "conversation.padawan_old_musician_03.branchId");

	return SCRIPT_CONTINUE;
}

// ======================================================================

