// ======================================================================
//
// story_arc_chapter_one_milo.script
// Copyright 2004, Sony Online Entertainment
// All Rights Reserved.
//
// Created with SwgConversationEditor 1.36 - DO NOT EDIT THIS AUTO-GENERATED FILE!
//
// ======================================================================

// ======================================================================
// Library Includes
// ======================================================================

include library.ai_lib;
include library.chat;
include library.groundquests;
include library.utils;

// ======================================================================
// Script Constants
// ======================================================================

string c_stringFile = "conversation/story_arc_chapter_one_milo";

// ======================================================================
// Script Conditions
// ======================================================================

boolean story_arc_chapter_one_milo_condition__defaultCondition (obj_id player, obj_id npc)
{
	return true;
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_hasCompletedPrelude (obj_id player, obj_id npc)
{
	return groundquests.hasCompletedQuest(player, "som_story_arc_prelude_03");
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_isOnFirstMission (obj_id player, obj_id npc)
{
	if( groundquests.isQuestActive(player, "som_story_arc_chapter_one_01") || groundquests.isQuestActive(player, "som_story_arc_chapter_one_02") || groundquests.isQuestActive(player, "som_story_arc_chapter_one_03"))
		return true;
	else
		return false;
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_isOnSecondMission (obj_id player, obj_id npc)
{
	return groundquests.isQuestActive(player, "som_story_arc_chapter_two_01");
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_hk47IsAlive (obj_id player, obj_id npc)
{
	if (groundquests.isTaskActive(player, "som_story_arc_chapter_two_01", "mustafar_factory_five") || groundquests.hasCompletedQuest(player, "som_story_arc_chapter_two_01"))
		return true;
	else
		return false;
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_isFightingDroids (obj_id player, obj_id npc)
{
	return groundquests.isQuestActive(player, "som_story_arc_chapter_three_01");
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_hasWonFactory (obj_id player, obj_id npc)
{
	if (groundquests.isTaskActive(player, "som_story_arc_chapter_three_01", "mustafar_milo_report") || groundquests.hasCompletedQuest(player, "som_story_arc_chapter_three_01"))
		return true;
	else
		return false;
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_hasWonStoryArc (obj_id player, obj_id npc)
{
	return groundquests.hasCompletedQuest(player, "som_story_arc_chapter_three_03");
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_isFightingHK (obj_id player, obj_id npc)
{
	return groundquests.isQuestActive(player, "som_story_arc_chapter_three_03");
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_hasDefeatedHK (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_story_arc_chapter_three_03", "volcano_arena_four");
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_messageWaiting (obj_id player, obj_id npc)
{
	return groundquests.isTaskActive(player, "som_story_arc_chapter_three_03", "volcano_arena_five");
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_hasCompletedFirstMission (obj_id player, obj_id npc)
{
	return groundquests.hasCompletedQuest(player, "som_story_arc_chapter_one_01");	
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_hasCompletedSecondMission (obj_id player, obj_id npc)
{
	return groundquests.hasCompletedQuest(player, "som_story_arc_chapter_one_02");
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_hasCompletedThirdMission (obj_id player, obj_id npc)
{
	return groundquests.hasCompletedQuest(player, "som_story_arc_chapter_one_03");
}

// ----------------------------------------------------------------------

boolean story_arc_chapter_one_milo_condition_hasCompletedFourthMission (obj_id player, obj_id npc)
{
	return groundquests.hasCompletedQuest(player, "som_story_arc_chapter_two_01");
}

// ======================================================================
// Script Actions
// ======================================================================

void story_arc_chapter_one_milo_action_grantFirstMission (obj_id player, obj_id npc)
{
	groundquests.grantQuest(player, "som_story_arc_chapter_one_01");
}

// ----------------------------------------------------------------------

void story_arc_chapter_one_milo_action_grantFinalChapter (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "mustafar_factory_finish");
	groundquests.grantQuest(player, "som_story_arc_chapter_three_01");
}

// ----------------------------------------------------------------------

void story_arc_chapter_one_milo_action_grantFinalReward (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "hk_story_arc_completed");
}

// ----------------------------------------------------------------------

void story_arc_chapter_one_milo_action_startVolcanoQuest (obj_id player, obj_id npc)
{
	groundquests.sendSignal(player, "mustafar_droidfactory_victory");
	groundquests.grantQuest(player, "som_story_arc_chapter_three_03");
}

// ----------------------------------------------------------------------

void story_arc_chapter_one_milo_action_checkForError (obj_id player, obj_id npc)
{
	if(groundquests.isQuestActive(player, "som_story_arc_chapter_one_01"))
	{
		groundquests.completeQuest(player, "som_story_arc_chapter_one_01");
	}
}

// ======================================================================
// Script %TO Tokens
// ======================================================================

// ======================================================================
// Script %DI Tokens
// ======================================================================

// ======================================================================
// Script %DF Tokens
// ======================================================================

// ======================================================================
// handleBranch<n> Functions 
// ======================================================================

int story_arc_chapter_one_milo_handleBranch3 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: The signal has stopped. You have saved us from that insane droid. That is one major problem off of our backs, but we still are not any closer to solving our Empire problem.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Don't be so certain. You now are the proud owner of a fully-stocked droid factory.
	if (response == "s_115")
	{
		doAnimationAction (player, "laugh_titter");

		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "point_forward");

			story_arc_chapter_one_milo_action_grantFinalReward (player, npc);

			//-- NPC: What! Of course, we can take the resources that are stockpiled there and sell them off to the Empire to fill or order. That is brilliant! We take care of the Empire and make sure that the factory can never be used again at the same time. You have done us a huge service. By the way, you have a message waiting for you. It was encoded for your eyes only, so I am not sure what it is about. You can use that terminal over there.
			string_id message = new string_id (c_stringFile, "s_116");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch6 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: The droid army is gone, but did you stop the problem at its source?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: The droid factory is offline, but HK-47 was nowhere to be seen.
	if (response == "s_97")
	{
		doAnimationAction (player, "explain");

		story_arc_chapter_one_milo_action_checkForError (player, npc);

		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "rub_chin_thoughtful");

			//-- NPC: That would explain the strange signals we have been monitoring from the volcano crater. We managed to decipher the signal, and it sounds like someone is trying to flag down a passing ship. It must be HK-47.
			string_id message = new string_id (c_stringFile, "s_98");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: And I suppose I must be the one to stop him.
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_99");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 7);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch7 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: That would explain the strange signals we have been monitoring from the volcano crater. We managed to decipher the signal, and it sounds like someone is trying to flag down a passing ship. It must be HK-47.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: And I suppose I must be the one to stop him.
	if (response == "s_99")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "nod");

			//-- NPC: There isn't anyone else who can do it. Please, we cannot let him escape. If he were to get away, he could come back at any time and turn that factory back on. We might not get another chance.
			string_id message = new string_id (c_stringFile, "s_100");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: And how am I suppose to get up there?
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_112");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 8);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch8 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: There isn't anyone else who can do it. Please, we cannot let him escape. If he were to get away, he could come back at any time and turn that factory back on. We might not get another chance.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: And how am I suppose to get up there?
	if (response == "s_112")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "point_away");

			story_arc_chapter_one_milo_action_startVolcanoQuest (player, npc);

			//-- NPC: You will need a pilot. And since you are flying into the crater of an active volcano, you are going to need a crazy pilot. With all of the off-world traffic we have had lately, there must be one around here somewhere. If they need to be paid, tell them to bill Mensix Corp.
			string_id message = new string_id (c_stringFile, "s_113");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch10 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I am still getting reports of heavy droid activity. You are the only one qualified to protect us. Please get out there and put an end to this menace.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I will do what I can.
	if (response == "s_95")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			//-- NPC: Thank you. And be careful. Those droids mean business.
			string_id message = new string_id (c_stringFile, "s_96");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch12 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Whew, I was worried that you wouldn't return. Have you discovered anything that will help us?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Not exactly. I think I might have made things worse.
	if (response == "s_81")
	{
		doAnimationAction (player, "embarrassed");

		story_arc_chapter_one_milo_action_checkForError (player, npc);

		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "huh");

			//-- NPC: What do you mean, worse? How could things get any worse than they already are?
			string_id message = new string_id (c_stringFile, "s_82");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I sort of woke up a psychotic robot and now he has control of a droid factory.
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_83");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 13);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch13 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: What do you mean, worse? How could things get any worse than they already are?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I sort of woke up a psychotic robot and now he has control of a droid factory.
	if (response == "s_83")
	{
		doAnimationAction (player, "explain");

		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "gesticulate_wildly");

			//-- NPC: What! That would explain the reports I have been getting from the field crews in the eastern sector. They said that a large group of unknown machines were seen heading this way. I figured it was just trilom sickness, but to be safe, I sent out a few scouts. What do you think this robot wants?
			string_id message = new string_id (c_stringFile, "s_84");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Well, the phrase 'kill all meatbags' did turn up.
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_85");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 14);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch14 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: What! That would explain the reports I have been getting from the field crews in the eastern sector. They said that a large group of unknown machines were seen heading this way. I figured it was just trilom sickness, but to be safe, I sent out a few scouts. What do you think this robot wants?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Well, the phrase 'kill all meatbags' did turn up.
	if (response == "s_85")
	{
		doAnimationAction (player, "shrug_hands");

		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "shakefist");

			//-- NPC: That is great! Just great! Not only do we have to worry about the Empire, we also need to worry about an army of robots coming and killing us all. Listen, you have to fix this. You have to stop that army of droids. We are miners, not soldiers. You are our only hope.
			string_id message = new string_id (c_stringFile, "s_86");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I made this mess. I will clean it up.
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I am sorry, but there is nothing I can do.
			boolean hasResponse1 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_87");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_88");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 15);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch15 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: That is great! Just great! Not only do we have to worry about the Empire, we also need to worry about an army of robots coming and killing us all. Listen, you have to fix this. You have to stop that army of droids. We are miners, not soldiers. You are our only hope.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I made this mess. I will clean it up.
	if (response == "s_87")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "point_away");

			story_arc_chapter_one_milo_action_grantFinalChapter (player, npc);

			//-- NPC: Thank you. The scouts that I sent out are to the southeast of here. If anything is coming from that factory, it will head right through a small valley in that direction. I will give you a tracking code to my best scout... If the droids are out there, he will have found them. Good luck.
			string_id message = new string_id (c_stringFile, "s_90");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I am sorry, but there is nothing I can do.
	if (response == "s_88")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "wave_on_dismissing");

			//-- NPC: So, you are just going to leave us to the mercy of a droid. Thanks for nothing.
			string_id message = new string_id (c_stringFile, "s_89");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch18 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Have you discovered anything yet?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I am working on it.
	if (response == "s_133")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			story_arc_chapter_one_milo_action_checkForError (player, npc);

			//-- NPC: Good to hear. Thank you.
			string_id message = new string_id (c_stringFile, "s_134");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch20 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Have you managed to discover how to increase the productivity of this station yet?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I have some leads that I am working on.
	if (response == "s_79")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			//-- NPC: That is great news. Keep up the good work.
			string_id message = new string_id (c_stringFile, "s_80");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch22 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: You should get back to work. We really don't have a whole lot of time.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: If you say so.
	if (response == "s_130")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			story_arc_chapter_one_milo_action_checkForError (player, npc);

			//-- NPC: Thank you.
			string_id message = new string_id (c_stringFile, "s_131");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch24 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Please just follow the leads you have and see what you can do about helping us.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Will do.
	if (response == "s_127")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			story_arc_chapter_one_milo_action_checkForError (player, npc);

			//-- NPC: Glad to hear it. Good luck to you.
			string_id message = new string_id (c_stringFile, "s_128");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch27 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: How is your search going? Have you managed to find anything that might help us out?

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Not so far. But I am still working on it.
	if (response == "s_77")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			//-- NPC: Thank you again for all the help you are giving to us.
			string_id message = new string_id (c_stringFile, "s_78");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch29 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Hello and welcome. I am Milo Mensix, head of this little operation here. Chivos has kept me informed about your good work for us. I was hoping that maybe I could persuade you to do some extra work for us...work that would require your obvious talents.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What sort of work are you talking about?
	if (response == "s_42")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "explain");

			//-- NPC: I am sure that you have noticed that we are experiencing many different problems here. It is of the utmost importance that we find a way to quickly upgrade this facility so that we can stay on schedule and meet our clients' demands.
			string_id message = new string_id (c_stringFile, "s_44");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: Why is this latest client so important that you would risk your entire facility?
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_46");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 30);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch30 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I am sure that you have noticed that we are experiencing many different problems here. It is of the utmost importance that we find a way to quickly upgrade this facility so that we can stay on schedule and meet our clients' demands.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Why is this latest client so important that you would risk your entire facility?
	if (response == "s_46")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "explain");

			//-- NPC: It goes well beyond the financial reward, I assure you. If this contract fails, the entire company fails. All of these people will be out of work and I am not so sure that anyone will come back to pick up the pieces like we did with Klegger.
			string_id message = new string_id (c_stringFile, "s_48");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: This doesn't sound right. Who are these clients?
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_50");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 31);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch31 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: It goes well beyond the financial reward, I assure you. If this contract fails, the entire company fails. All of these people will be out of work and I am not so sure that anyone will come back to pick up the pieces like we did with Klegger.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: This doesn't sound right. Who are these clients?
	if (response == "s_50")
	{
		doAnimationAction (player, "rub_chin_thoughtful");

		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "apologize");

			//-- NPC: I am going to be completely honest with you because I...we need your help in a most desperate way. The client we are working for is the Empire. They came to us with a very generous offer last year, but they keep altering the deal. Always demanding more...faster. We cannot keep up anymore.
			string_id message = new string_id (c_stringFile, "s_52");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: So, get out of the deal.
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_54");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 32);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch32 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I am going to be completely honest with you because I...we need your help in a most desperate way. The client we are working for is the Empire. They came to us with a very generous offer last year, but they keep altering the deal. Always demanding more...faster. We cannot keep up anymore.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: So, get out of the deal.
	if (response == "s_54")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "gesticulate_wildly");

			//-- NPC: Do you not think I have tried that? They said that if I fail to meet their expectations, they would take over the operation. They also made it pretty clear that if they had to take over, me and my men would no longer be needed. I can only guess by the presence of those Star Destroyers, they didn't mean we would be fired.
			string_id message = new string_id (c_stringFile, "s_56");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: So there is nothing you can do?
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: Maybe you should uphold your end of the bargain.
			boolean hasResponse1 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_58");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_119");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 33);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch33 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: Do you not think I have tried that? They said that if I fail to meet their expectations, they would take over the operation. They also made it pretty clear that if they had to take over, me and my men would no longer be needed. I can only guess by the presence of those Star Destroyers, they didn't mean we would be fired.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: So there is nothing you can do?
	if (response == "s_58")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "embarrassed");

			//-- NPC: We are working way over capacity now. I just received a message that they want to meet with me later this week. They only do that when they are planning on increasing the requirements yet again. I wish I had never made that deal, but there is nothing I can do about that now. I have to find some way to save my men. I was hoping you could help me.
			string_id message = new string_id (c_stringFile, "s_60");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: What can I do to help?
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I am sorry. But you got yourself into this mess...
			boolean hasResponse1 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_62");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_109");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 34);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: Maybe you should uphold your end of the bargain.
	if (response == "s_119")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			//-- NPC: It's impossible! We are already running way over capacity and they just keep upping the requirements. My men's lives are at stake, all because I thought I could trust the Empire. Listen, I know you have no reason to, but would you please help us? Not for me, but for my men. They don't even know why they are working so hard and now they might die because of it.
			string_id message = new string_id (c_stringFile, "s_121");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch34 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: We are working way over capacity now. I just received a message that they want to meet with me later this week. They only do that when they are planning on increasing the requirements yet again. I wish I had never made that deal, but there is nothing I can do about that now. I have to find some way to save my men. I was hoping you could help me.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What can I do to help?
	if (response == "s_62")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "small");

			//-- NPC: It is a pretty slim chance, but I was hoping that maybe some of that old technology could have an answer to our problems. Our engineers say that even though it is from so long ago, it is incredibly powerful. In many ways, more powerful than anything we have now.
			string_id message = new string_id (c_stringFile, "s_64");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: What old technology?
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_66");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 35);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I am sorry. But you got yourself into this mess...
	if (response == "s_109")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			//-- NPC: Yes. I got us into this mess and would gladly pay for my mistake. But it isn't right that all of my boys should pay as well.
			string_id message = new string_id (c_stringFile, "s_117");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch35 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: It is a pretty slim chance, but I was hoping that maybe some of that old technology could have an answer to our problems. Our engineers say that even though it is from so long ago, it is incredibly powerful. In many ways, more powerful than anything we have now.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What old technology?
	if (response == "s_66")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "explain");

			//-- NPC: It is said that Mustafar wasn't always like it is now. I don't know if that is true or not, but occasionally, we find things...old things that don't belong here. The surface of our world can shift violently, swallowing an entire building, and then years later, spit it back up. Like that cruiser you already visited...it just showed up one day about twenty years ago.
			string_id message = new string_id (c_stringFile, "s_68");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: What does this have to do with ancient technology?
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_70");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 36);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch36 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: It is said that Mustafar wasn't always like it is now. I don't know if that is true or not, but occasionally, we find things...old things that don't belong here. The surface of our world can shift violently, swallowing an entire building, and then years later, spit it back up. Like that cruiser you already visited...it just showed up one day about twenty years ago.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What does this have to do with ancient technology?
	if (response == "s_70")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "implore");

			//-- NPC: These things that show up are where we find it. Maybe you could go back to the crashed ship and search it for anything that will enable us to increase our power output or make our mining techniques faster. Anything that can help us.
			string_id message = new string_id (c_stringFile, "s_72");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: What makes you think I will even know what to look for?
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_74");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 37);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch37 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: These things that show up are where we find it. Maybe you could go back to the crashed ship and search it for anything that will enable us to increase our power output or make our mining techniques faster. Anything that can help us.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: What makes you think I will even know what to look for?
	if (response == "s_74")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "explain");

			//-- NPC: I have been thinking about that. Those ship's memory cores are almost completely destruction-proof. If you can get a terminal online, you should be able to access its memory and find the answers we need. Of course, that is, if there even are any answers to find. Please...help us. I promise you will be well-paid for your trouble.
			string_id message = new string_id (c_stringFile, "s_76");
			int numberOfResponses = 0;

			boolean hasResponse = false;

			//-- PLAYER: I will do my best to help you.
			boolean hasResponse0 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse0 = true;
			}

			//-- PLAYER: I am going to have to pass. I am sorry.
			boolean hasResponse1 = false;
			if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
			{
				++numberOfResponses;
				hasResponse = true;
				hasResponse1 = true;
			}

			if (hasResponse)
			{
				int responseIndex = 0;
				string_id responses [] = new string_id [numberOfResponses];

				if (hasResponse0)
					responses [responseIndex++] = new string_id (c_stringFile, "s_92");

				if (hasResponse1)
					responses [responseIndex++] = new string_id (c_stringFile, "s_105");

				utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 38);

				npcSpeak (player, message);
				npcSetConversationResponses (player, responses);
			}
			else
			{
				utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

				npcEndConversationWithMessage (player, message);
			}

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

int story_arc_chapter_one_milo_handleBranch38 (obj_id player, obj_id npc, string_id response)
{
	//-- [BRANCH NOTE] 
	//-- NPC: I have been thinking about that. Those ship's memory cores are almost completely destruction-proof. If you can get a terminal online, you should be able to access its memory and find the answers we need. Of course, that is, if there even are any answers to find. Please...help us. I promise you will be well-paid for your trouble.

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I will do my best to help you.
	if (response == "s_92")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			doAnimationAction (npc, "thank");

			story_arc_chapter_one_milo_action_grantFirstMission (player, npc);

			//-- NPC: Thank you. I promise you will not regret this.
			string_id message = new string_id (c_stringFile, "s_103");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	//-- [RESPONSE NOTE] 
	//-- PLAYER: I am going to have to pass. I am sorry.
	if (response == "s_105")
	{
		//-- [NOTE] 
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			//-- NPC: Very well. Well, thank you for listening to me. Good day.
			string_id message = new string_id (c_stringFile, "s_107");
			utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

			npcEndConversationWithMessage (player, message);

			return SCRIPT_CONTINUE;
		}

	}

	return SCRIPT_DEFAULT;
}

// ----------------------------------------------------------------------

// ======================================================================
// User Script Triggers
// ======================================================================

trigger OnInitialize ()
{
	if ((!isMob (self)) || (isPlayer (self)))
		detachScript(self, "conversation.story_arc_chapter_one_milo");

	setCondition (self, CONDITION_CONVERSABLE);
	setInvulnerable (self, true);
	setCondition( self, CONDITION_INTERESTING );
	setName (self, "Milo Mensix");

	return SCRIPT_CONTINUE;
}

trigger OnAttach ()
{
	setCondition (self, CONDITION_CONVERSABLE);
	setInvulnerable (self, true);
	setCondition( self, CONDITION_INTERESTING );
	setName (self, "Milo Mensix");

	return SCRIPT_CONTINUE;
}

trigger OnObjectMenuRequest (obj_id player, menu_info menuInfo)
{
	int menu = menuInfo.addRootMenu (menu_info_types.CONVERSE_START, null);
	menu_info_data menuInfoData = menuInfo.getMenuItemById (menu);
	menuInfoData.setServerNotify (false);
	setCondition (self, CONDITION_CONVERSABLE);
	faceTo(self, player);

	return SCRIPT_CONTINUE;
}

trigger OnIncapacitated (obj_id killer)
{
	clearCondition (self, CONDITION_CONVERSABLE);
	detachScript (self, "conversation.story_arc_chapter_one_milo");

	return SCRIPT_CONTINUE;
}

// ======================================================================
// Script Triggers
// ======================================================================

//-- This function should move to base_class.java
boolean npcStartConversation(obj_id player, obj_id npc, string convoName, string_id greetingId, prose_package greetingProse, string_id[] responses)
{
	Object[] objects = new Object[responses.length];
	System.arraycopy(responses, 0, objects, 0, responses.length);
	return npcStartConversation(player, npc, convoName, greetingId, greetingProse, objects);
}

// ----------------------------------------------------------------------

trigger OnStartNpcConversation (obj_id player)
{
	obj_id npc = self;

	if (ai_lib.isInCombat (npc) || ai_lib.isInCombat (player))
		return SCRIPT_OVERRIDE;

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_hasWonStoryArc (player, npc))
	{
		doAnimationAction (npc, "thank");

		//-- NPC: Thank you again for all your help. All my men will be safe because of you.
		string_id message = new string_id (c_stringFile, "s_101");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_messageWaiting (player, npc))
	{
		//-- NPC: Hello again. You still have that message stored for you. You can use the communication console in the back of the room to check it if you wish. Thanks again my friend.
		string_id message = new string_id (c_stringFile, "s_123");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_hasDefeatedHK (player, npc))
	{
		doAnimationAction (npc, "explain");

		//-- NPC: The signal has stopped. You have saved us from that insane droid. That is one major problem off of our backs, but we still are not any closer to solving our Empire problem.
		string_id message = new string_id (c_stringFile, "s_114");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Don't be so certain. You now are the proud owner of a fully-stocked droid factory.
		boolean hasResponse0 = false;
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_115");

			utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 3);

			npcStartConversation (player, npc, "story_arc_chapter_one_milo", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_isFightingHK (player, npc))
	{
		doAnimationAction (npc, "pound_fist_palm");

		//-- NPC: We are still getting those signals from the crater. HK-47 is still active. Get a pilot who will fly you there, and defeat him.
		string_id message = new string_id (c_stringFile, "s_111");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_hasWonFactory (player, npc))
	{
		doAnimationAction (npc, "beckon");

		//-- NPC: The droid army is gone, but did you stop the problem at its source?
		string_id message = new string_id (c_stringFile, "s_94");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: The droid factory is offline, but HK-47 was nowhere to be seen.
		boolean hasResponse0 = false;
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_97");

			utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 6);

			npcStartConversation (player, npc, "story_arc_chapter_one_milo", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_isFightingDroids (player, npc))
	{
		doAnimationAction (npc, "implore");

		//-- NPC: I am still getting reports of heavy droid activity. You are the only one qualified to protect us. Please get out there and put an end to this menace.
		string_id message = new string_id (c_stringFile, "s_93");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I will do what I can.
		boolean hasResponse0 = false;
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_95");

			utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 10);

			npcStartConversation (player, npc, "story_arc_chapter_one_milo", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_hk47IsAlive (player, npc))
	{
		doAnimationAction (npc, "sweat");

		story_arc_chapter_one_milo_action_checkForError (player, npc);

		//-- NPC: Whew, I was worried that you wouldn't return. Have you discovered anything that will help us?
		string_id message = new string_id (c_stringFile, "s_20");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Not exactly. I think I might have made things worse.
		boolean hasResponse0 = false;
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_81");

			utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 12);

			npcStartConversation (player, npc, "story_arc_chapter_one_milo", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_hasCompletedFourthMission (player, npc))
	{
		//-- NPC: Have you discovered anything yet?
		string_id message = new string_id (c_stringFile, "s_132");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I am working on it.
		boolean hasResponse0 = false;
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_133");

			utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 18);

			npcStartConversation (player, npc, "story_arc_chapter_one_milo", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_isOnSecondMission (player, npc))
	{
		doAnimationAction (npc, "beckon");

		//-- NPC: Have you managed to discover how to increase the productivity of this station yet?
		string_id message = new string_id (c_stringFile, "s_32");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: I have some leads that I am working on.
		boolean hasResponse0 = false;
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_79");

			utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 20);

			npcStartConversation (player, npc, "story_arc_chapter_one_milo", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_hasCompletedThirdMission (player, npc))
	{
		//-- NPC: You should get back to work. We really don't have a whole lot of time.
		string_id message = new string_id (c_stringFile, "s_129");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: If you say so.
		boolean hasResponse0 = false;
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_130");

			utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 22);

			npcStartConversation (player, npc, "story_arc_chapter_one_milo", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_hasCompletedSecondMission (player, npc))
	{
		//-- NPC: Please just follow the leads you have and see what you can do about helping us.
		string_id message = new string_id (c_stringFile, "s_126");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Will do.
		boolean hasResponse0 = false;
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_127");

			utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 24);

			npcStartConversation (player, npc, "story_arc_chapter_one_milo", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_hasCompletedFirstMission (player, npc))
	{
		//-- NPC: I don't know how I can be of any more help to you. You were supposed to look for something at the crash site that could help us out and follow through with your information there.
		string_id message = new string_id (c_stringFile, "s_125");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_isOnFirstMission (player, npc))
	{
		doAnimationAction (npc, "beckon");

		//-- NPC: How is your search going? Have you managed to find anything that might help us out?
		string_id message = new string_id (c_stringFile, "s_36");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: Not so far. But I am still working on it.
		boolean hasResponse0 = false;
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_77");

			utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 27);

			npcStartConversation (player, npc, "story_arc_chapter_one_milo", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition_hasCompletedPrelude (player, npc))
	{
		doAnimationAction (npc, "greet");

		//-- NPC: Hello and welcome. I am Milo Mensix, head of this little operation here. Chivos has kept me informed about your good work for us. I was hoping that maybe I could persuade you to do some extra work for us...work that would require your obvious talents.
		string_id message = new string_id (c_stringFile, "s_40");
		int numberOfResponses = 0;

		boolean hasResponse = false;

		//-- PLAYER: What sort of work are you talking about?
		boolean hasResponse0 = false;
		if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
		{
			++numberOfResponses;
			hasResponse = true;
			hasResponse0 = true;
		}

		if (hasResponse)
		{
			int responseIndex = 0;
			string_id responses [] = new string_id [numberOfResponses];

			if (hasResponse0)
				responses [responseIndex++] = new string_id (c_stringFile, "s_42");

			utils.setScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId", 29);

			npcStartConversation (player, npc, "story_arc_chapter_one_milo", message, responses);
		}
		else
		{
			chat.chat (npc, player, message);
		}

		return SCRIPT_CONTINUE;
	}

	//-- [NOTE] 
	if (story_arc_chapter_one_milo_condition__defaultCondition (player, npc))
	{
		doAnimationAction (npc, "shoo");

		//-- NPC: If you are interested in a job, perhaps Foreman Chivos has something for you. If you will excuse me...as you can see here, I have some very important matters that need my attention.
		string_id message = new string_id (c_stringFile, "s_124");
		chat.chat (npc, player, message);

		return SCRIPT_CONTINUE;
	}

	chat.chat (npc, "Error:  All conditions for OnStartNpcConversation were false.");

	return SCRIPT_CONTINUE;
}

// ----------------------------------------------------------------------

trigger OnNpcConversationResponse (string conversationId, obj_id player, string_id response)
{
	if (conversationId != "story_arc_chapter_one_milo")
		return SCRIPT_CONTINUE;

	obj_id npc = self;

	int branchId = utils.getIntScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

	if (branchId == 3 && story_arc_chapter_one_milo_handleBranch3 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 6 && story_arc_chapter_one_milo_handleBranch6 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 7 && story_arc_chapter_one_milo_handleBranch7 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 8 && story_arc_chapter_one_milo_handleBranch8 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 10 && story_arc_chapter_one_milo_handleBranch10 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 12 && story_arc_chapter_one_milo_handleBranch12 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 13 && story_arc_chapter_one_milo_handleBranch13 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 14 && story_arc_chapter_one_milo_handleBranch14 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 15 && story_arc_chapter_one_milo_handleBranch15 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 18 && story_arc_chapter_one_milo_handleBranch18 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 20 && story_arc_chapter_one_milo_handleBranch20 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 22 && story_arc_chapter_one_milo_handleBranch22 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 24 && story_arc_chapter_one_milo_handleBranch24 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 27 && story_arc_chapter_one_milo_handleBranch27 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 29 && story_arc_chapter_one_milo_handleBranch29 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 30 && story_arc_chapter_one_milo_handleBranch30 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 31 && story_arc_chapter_one_milo_handleBranch31 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 32 && story_arc_chapter_one_milo_handleBranch32 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 33 && story_arc_chapter_one_milo_handleBranch33 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 34 && story_arc_chapter_one_milo_handleBranch34 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 35 && story_arc_chapter_one_milo_handleBranch35 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 36 && story_arc_chapter_one_milo_handleBranch36 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 37 && story_arc_chapter_one_milo_handleBranch37 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	if (branchId == 38 && story_arc_chapter_one_milo_handleBranch38 (player, npc, response) == SCRIPT_CONTINUE)
		return SCRIPT_CONTINUE;

	chat.chat (npc, "Error:  Fell through all branches and responses for OnNpcConversationResponse.");

	utils.removeScriptVar (player, "conversation.story_arc_chapter_one_milo.branchId");

	return SCRIPT_CONTINUE;
}

// ======================================================================

